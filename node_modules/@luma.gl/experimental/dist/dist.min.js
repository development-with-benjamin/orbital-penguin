!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("luma"));else if("function"==typeof define&&define.amd)define(["luma"],e);else{var n="object"==typeof exports?e(require("luma")):e(t.luma);for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(window,(function(t){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(e,n){e.exports=t},function(t,e,n){t.exports=n(10)},function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";(function(t,r){n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}));var i=n(4),o={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},a=o.global||o.self||o.window,s="object"!==(void 0===r?"undefined":Object(i.a)(r))||"[object process]"!==String(r)||r.browser,u=void 0!==r&&r.version&&r.version.match(/v([0-9]*)/);u&&parseFloat(u[1])}).call(this,n(7),n(11))},,function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";function r(t,e,n){n=n||2;var r,s,u,c,l,p,v,y=e&&e.length,m=y?e[0]*n:t.length,x=i(t,0,m,n,!0),g=[];if(!x||x.next===x.prev)return g;if(y&&(x=function(t,e,n,r){var a,s,u,c,l,p=[];for(a=0,s=e.length;a<s;a++)u=e[a]*r,c=a<s-1?e[a+1]*r:t.length,(l=i(t,u,c,r,!1))===l.next&&(l.steiner=!0),p.push(d(l));for(p.sort(h),a=0;a<p.length;a++)f(p[a],n),n=o(n,n.next);return n}(t,e,x,n)),t.length>80*n){r=u=t[0],s=c=t[1];for(var b=n;b<m;b+=n)(l=t[b])<r&&(r=l),(p=t[b+1])<s&&(s=p),l>u&&(u=l),p>c&&(c=p);v=0!==(v=Math.max(u-r,c-s))?1/v:0}return a(x,g,n,r,s,v),g}function i(t,e,n,r,i){var o,a;if(i===O(t,e,n,r)>0)for(o=e;o<n;o+=r)a=E(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=E(o,t[o],t[o+1],a);return a&&g(a,a.next)&&(S(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==x(r.prev,r,r.next))r=r.next;else{if(S(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function a(t,e,n,r,i,h,f){if(t){!f&&h&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=v(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<c&&(s++,r=r.nextZ);e++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(t,r,i,h);for(var p,d,y=t;t.prev!==t.next;)if(p=t.prev,d=t.next,h?u(t,r,i,h):s(t))e.push(p.i/n),e.push(t.i/n),e.push(d.i/n),S(t),t=d.next,y=d.next;else if((t=d)===y){f?1===f?a(t=c(o(t),e,n),e,n,r,i,h,2):2===f&&l(t,e,n,r,i,h):a(o(t),e,n,r,i,h,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(x(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(y(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&x(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(t,e,n,r){var i=t.prev,o=t,a=t.next;if(x(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=v(s,u,e,n,r),f=v(c,l,e,n,r),p=t.prevZ,d=t.nextZ;p&&p.z>=h&&d&&d.z<=f;){if(p!==t.prev&&p!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&x(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,d!==t.prev&&d!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&x(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&x(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&x(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function c(t,e,n){var r=t;do{var i=r.prev,a=r.next.next;!g(i,a)&&b(i,r,r.next,a)&&T(i,a)&&T(a,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(a.i/n),S(r),S(r.next),r=t=a),r=r.next}while(r!==t);return o(r)}function l(t,e,n,r,i,s){var u=t;do{for(var c=u.next.next;c!==u.prev;){if(u.i!==c.i&&m(u,c)){var l=_(u,c);return u=o(u,u.next),l=o(l,l.next),a(u,e,n,r,i,s),void a(l,e,n,r,i,s)}c=c.next}u=u.next}while(u!==t)}function h(t,e){return t.x-e.x}function f(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,c=n,l=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&y(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),T(r,t)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&p(n,r)))&&(n=r,f=u)),r=r.next}while(r!==c);return n}(t,e)){var n=_(e,t);o(e,e.next),o(n,n.next)}}function p(t,e){return x(t.prev,t,e.prev)<0&&x(e.next,t,t.next)<0}function v(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function d(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function y(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(T(t,e)&&T(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(x(t.prev,t,e.prev)||x(t,e.prev,e))||g(t,e)&&x(t.prev,t,t.next)>0&&x(e.prev,e,e.next)>0)}function x(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){var i=k(x(t,e,n)),o=k(x(t,e,r)),a=k(x(n,r,t)),s=k(x(n,r,e));return i!==o&&a!==s||(!(0!==i||!w(t,n,e))||(!(0!==o||!w(t,r,e))||(!(0!==a||!w(n,t,r))||!(0!==s||!w(n,e,r)))))}function w(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function k(t){return t>0?1:t<0?-1:0}function T(t,e){return x(t.prev,t,t.next)<0?x(t,e,t.next)>=0&&x(t,t.prev,e)>=0:x(t,e,t.prev)<0||x(t,t.next,e)<0}function _(t,e){var n=new M(t.i,t.x,t.y),r=new M(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function E(t,e,n,r){var i=new M(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function M(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=r,t.exports.default=r,r.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(O(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var c=e[s]*n,l=s<u-1?e[s+1]*n:t.length;a-=Math.abs(O(t,c,l,n))}var h=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,v=r[s+2]*n;h+=Math.abs((t[f]-t[v])*(t[p+1]-t[f+1])-(t[f]-t[p])*(t[v+1]-t[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},function(t,e,n){(function(e){const r=n(12),i="undefined"==typeof window?e:window;i.luma=i.luma||{},t.exports=Object.assign(i.luma,r)}).call(this,n(7))},function(t,e,n){var r=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new T(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return E()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=c(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),o}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function h(){}function f(){}function p(){}var v={};v[i]=function(){return this};var d=Object.getPrototypeOf,y=d&&d(d(_([])));y&&y!==e&&n.call(y,i)&&(v=y);var m=p.prototype=h.prototype=Object.create(v);function x(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(i,o){function a(){return new e((function(r,a){!function r(i,o,a,s){var u=c(t[i],t,o);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==typeof h&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}(i,o,r,a)}))}return r=r?r.then(a,a):a()}}function b(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function _(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return f.prototype=m.constructor=p,p.constructor=f,f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},x(g.prototype),g.prototype[o]=function(){return this},t.AsyncIterator=g,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new g(u(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(m),s(m,a,"Generator"),m[i]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=_,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:_(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var u,c=[],l=!1,h=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&p())}function p(){if(!l){var t=s(f);l=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function v(t,e){this.fun=t,this.array=e}function d(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new v(t,e)),1!==c.length||l||s(p)},v.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=d,i.addListener=d,i.once=d,i.off=d,i.removeListener=d,i.removeAllListeners=d,i.emit=d,i.prependListener=d,i.prependOnceListener=d,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";n.r(e),n.d(e,"Display",(function(){return i})),n.d(e,"VRDisplay",(function(){return o})),n.d(e,"GLTFEnvironment",(function(){return Lt})),n.d(e,"createGLTFObjects",(function(){return bn})),n.d(e,"ScenegraphNode",(function(){return je})),n.d(e,"GroupNode",(function(){return Be})),n.d(e,"ModelNode",(function(){return vn})),n.d(e,"buildHistopyramidBaseLevel",(function(){return _n})),n.d(e,"getHistoPyramid",(function(){return En})),n.d(e,"histoPyramidGenerateIndices",(function(){return Sn})),n.d(e,"GPUPointInPolygon",(function(){return qn}));var r=n(0);class i{constructor(){this.animationLoop=null}getViews(t){const{width:e,height:n}=t;return[{params:{viewport:[0,0,e,n],scissor:[0,0,e,n],scissorTest:!0}}]}submitFrame(){return!0}requestAnimationFrame(t){return!1}delete(){}_renderFrame(t){const e=this.getViews(t);if(!e)return!1;const{gl:n}=this.animationLoop;for(const i of e)Object(r.withParameters)(n,i.params,()=>this.animationLoop.onRender({...t,...i}));return this.submitFrame(),!0}}class o extends i{static isSupported(){return"undefined"!=typeof navigator&&"getVRDisplays"in navigator&&"VRFrameData"in window}constructor(t){super(t),this._vrSupported=o.isSupported(),this._vrSupported&&(this.vrFrameData=new window.VRFrameData,this.vrPresenting=!1,this.vrFrame=!1,window.addEventListener("vrdisplaypresentchange",this._vrDisplayPresentChange.bind(this)))}delete(){super.delete(),this._removeVRButton()}getViews(t){if(this._vrSupported&&this._addVRButton(),this.vrPresenting&&this.vrFrame){this.vrDisplay.getFrameData(this.vrFrameData);const{leftProjectionMatrix:e,leftViewMatrix:n,rightProjectionMatrix:r,rightViewMatrix:i}=this.vrFrameData,{width:o,height:a}=t;return[{displayEye:"left",projectionMatrix:e,viewMatrix:n,params:{viewport:[0,0,.5*o,a],scissor:[0,0,.5*o,a],scissorTest:!0}},{displayEye:"right",projectionMatrix:r,viewMatrix:i,params:{viewport:[.5*o,0,.5*o,a],scissor:[.5*o,0,.5*o,a],scissorTest:!0}}]}return super.getViews(t)}submitFrame(){return!(!this.vrPresenting||!this.vrFrame)&&(this.vrDisplay.submitFrame(),!0)}requestAnimationFrame(t){return!!this.vrPresenting&&(this.vrDisplay.requestAnimationFrame(()=>{this.vrFrame=!0,t(),this.vrFrame=!1}),!0)}async _addVRButton(){if(this.vrButton)return;const t=this._getCanvas();if(!t)return;const e=await navigator.getVRDisplays();e&&e.length&&(r.log.info(2,"Found VR Displays",e)(),this.vrDisplay=e[0],this.vrButton=function({canvas:t,title:e}){const{top:n,left:r,width:i,height:o}=t.getBoundingClientRect(),a=document.createElement("div");a.style.position="absolute",a.style.top=n+"px",a.style.left=r+"px",a.style.width=i+"px",a.style.height=o+"px",a.style.pointerEvents="none",a.style.zIndex="999",document.body.appendChild(a);const s=document.createElement("button");return s.style.padding="16px",s.style.border="1px solid #fff",s.style.borderRadius="8px",s.style.background="rgba(0,0,0,0.5)",s.style.color="#fff",s.style.font="normal 20px sans-serif",s.style.cursor="pointer",s.style.margin="20px auto",s.style.display="block",s.style.pointerEvents="all",s.textContent=e,a.appendChild(s),s}({canvas:t,title:`Enter VR (${this.vrDisplay.displayName})`}),this.vrButton.onclick=()=>this._startDisplay())}_getCanvas(){return this.animationLoop.canvas||this.animationLoop.gl&&this.animationLoop.gl.canvas}_removeVRButton(){this.vrButton}_startDisplay(){this.vrDisplay.requestPresent([{source:this._getCanvas()}])}_vrDisplayPresentChange(){this.vrDisplay.isPresenting?(r.log.info(2,"Entering VR")(),this.vrPresenting=!0,this.vrButton.style.display="none"):(r.log.info(2,"Exiting VR")(),this.vrPresenting=!1,this.vrButton.style.display="block")}}var a=4,s=34963,u=5121,c=5123,l=5126,h=6407,f=9728,p=9729,v=9987,d=10240,y=10241,m=10242,x=10243,g=33071;function b(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var w=n(1),k=n.n(w);function T(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function _(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){T(o,r,i,a,s,"next",t)}function s(t){T(o,r,i,a,s,"throw",t)}a(void 0)}))}}function E(t,e){if(!t)throw new Error(e)}var S=n(5),M=S.a._parseImageNode,O="undefined"!=typeof Image,P="undefined"!=typeof ImageBitmap,A=Boolean(M),L=!!S.b||A;var R=n(4);function I(t){var e=j(t);if(!e)throw new Error("Not an image");return e}function N(t){switch(I(t)){case"data":return t;case"image":case"imagebitmap":var e=document.createElement("canvas"),n=e.getContext("2d");if(n)return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:return E(!1)}}function j(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"===Object(R.a)(t)&&t.data&&t.width&&t.height?"data":null}var B=/^data:image\/svg\+xml/,C=/\.svg((\?|#).*)?$/;function D(t){return t&&(B.test(t)||C.test(t))}function F(t,e){if(D(e)){var n=(new TextDecoder).decode(t);return"data:image/svg+xml;base64,".concat(btoa(n))}return z(t,e)}function z(t,e){if(D(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}function V(t,e,n){return U.apply(this,arguments)}function U(){return(U=_(k.a.mark((function t(e,n,r){var i,o,a;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=F(e,r),o=self.URL||self.webkitURL,a="string"!=typeof i&&o.createObjectURL(i),t.prev=3,t.next=6,q(a||i,n);case 6:return t.abrupt("return",t.sent);case 7:return t.prev=7,a&&o.revokeObjectURL(a),t.finish(7);case 10:case"end":return t.stop()}}),t,null,[[3,,7,10]])})))).apply(this,arguments)}function q(t,e){return G.apply(this,arguments)}function G(){return(G=_(k.a.mark((function t(e,n){var r;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=new Image).src=e,!(n.image&&n.image.decode&&r.decode)){t.next=6;break}return t.next=5,r.decode();case 5:return t.abrupt("return",r);case 6:return t.next=8,new Promise((function(t,n){try{r.onload=function(){return t(r)},r.onerror=function(t){return n(new Error("Could not load image ".concat(e,": ").concat(t)))}}catch(t){n(t)}}));case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Z={},X=!0;function H(t,e,n){return W.apply(this,arguments)}function W(){return(W=_(k.a.mark((function t(e,n,r){var i,o,a;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!D(r)){t.next=7;break}return t.next=3,V(e,n,r);case 3:o=t.sent,i=o,t.next=8;break;case 7:i=z(e,r);case 8:return a=n&&n.imagebitmap,t.next=11,K(i,a);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(t){return Y.apply(this,arguments)}function Y(){return(Y=_(k.a.mark((function t(e){var n,r=arguments;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!$(n=r.length>1&&void 0!==r[1]?r[1]:null)&&X||(n=null),!n){t.next=13;break}return t.prev=3,t.next=6,createImageBitmap(e,n);case 6:return t.abrupt("return",t.sent);case 9:t.prev=9,t.t0=t.catch(3),console.warn(t.t0),X=!1;case 13:return t.next=15,createImageBitmap(e);case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t,null,[[3,9]])})))).apply(this,arguments)}function $(t){for(var e in t||Z)return!1;return!0}function Q(t){var e=J(t);return function(t){var e=J(t);if(!(e.byteLength>=24&&2303741511===e.getUint32(0,!1)))return null;return{mimeType:"image/png",width:e.getUint32(16,!1),height:e.getUint32(20,!1)}}(e)||function(t){var e=J(t);if(!(e.byteLength>=3&&65496===e.getUint16(0,!1)&&255===e.getUint8(2)))return null;var n=function(){for(var t=new Set([65499,65476,65484,65501,65534]),e=65504;e<65520;++e)t.add(e);var n=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:n}}(),r=n.tableMarkers,i=n.sofMarkers,o=2;for(;o+9<e.byteLength;){var a=e.getUint16(o,!1);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(o+5,!1),width:e.getUint16(o+7,!1)};if(!r.has(a))return null;o+=2,o+=e.getUint16(o,!1)}return null}(e)||function(t){var e=J(t);if(!(e.byteLength>=10&&1195984440===e.getUint32(0,!1)))return null;return{mimeType:"image/gif",width:e.getUint16(6,!0),height:e.getUint16(8,!0)}}(e)||function(t){var e=J(t);if(!(e.byteLength>=14&&16973===e.getUint16(0,!1)&&e.getUint32(2,!0)===e.byteLength))return null;return{mimeType:"image/bmp",width:e.getUint32(18,!0),height:e.getUint32(22,!0)}}(e)}function J(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}function tt(t,e){var n=(Q(t)||{}).mimeType,r=S.a._parseImageNode;return E(r),r(t,n,e)}function et(t,e,n){return nt.apply(this,arguments)}function nt(){return(nt=_(k.a.mark((function t(e,n,r){var i,o,a,s,u;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=(n=n||{}).image||{},o=i.type||"auto",a=(r||{}).url,s=rt(o),t.t0=s,t.next="imagebitmap"===t.t0?8:"image"===t.t0?12:"data"===t.t0?16:20;break;case 8:return t.next=10,H(e,n,a);case 10:return u=t.sent,t.abrupt("break",21);case 12:return t.next=14,V(e,n,a);case 14:return u=t.sent,t.abrupt("break",21);case 16:return t.next=18,tt(e,n);case 18:return u=t.sent,t.abrupt("break",21);case 20:E(!1);case 21:return"data"===o&&(u=N(u)),t.abrupt("return",u);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function rt(t){switch(t){case"auto":case"data":return function(){if(P)return"imagebitmap";if(O)return"image";if(L)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return P||O||L;case"imagebitmap":return P;case"image":return O;case"data":return L;case"html":return O;case"ndarray":return L;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}(t),t}}var it="",ot={};function at(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function st(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?at(Object(n),!0).forEach((function(e){b(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):at(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ut(t,e,n){var r=t;"function"==typeof t&&(r=t(st(st({},e),n))),E("string"==typeof r);var i=e.baseUrl;return i&&(r="/"===i[i.length-1]?"".concat(i).concat(r):"".concat(i,"/").concat(r)),function(t){for(var e in ot)if(t.startsWith(e)){var n=ot[e];t=t.replace(e,n)}return t.startsWith("http://")||t.startsWith("https://")||(t="".concat(it).concat(t)),t}(r)}var ct=function(t){return t&&"object"===Object(R.a)(t)};function lt(t,e){return ht.apply(this,arguments)}function ht(){return(ht=_(k.a.mark((function t(e,n){var r,i=arguments;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:{},t.next=3,ft(e,n,r);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ft(t,e,n){return pt.apply(this,arguments)}function pt(){return(pt=_(k.a.mark((function t(e,n,r){var i;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Array.isArray(e)){t.next=4;break}return t.next=3,yt(e,n,r);case 3:return t.abrupt("return",t.sent);case 4:if(!ct(e)){t.next=8;break}return t.next=7,vt(e,n,r);case 7:return t.abrupt("return",t.sent);case 8:return i=e,t.next=11,n(i,r);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function vt(t,e,n){return dt.apply(this,arguments)}function dt(){return(dt=_(k.a.mark((function t(e,n,r){var i,o,a,s;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(s in i=[],o={},a=function(t){var a=ft(e[t],n,r).then((function(e){o[t]=e}));i.push(a)},e)a(s);return t.next=6,Promise.all(i);case 6:return t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function yt(t,e){return mt.apply(this,arguments)}function mt(){return(mt=_(k.a.mark((function t(e,n){var r,i,o=arguments;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:{},i=e.map((function(t){return ft(t,n,r)})),t.next=4,Promise.all(i);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xt(t,e,n){return gt.apply(this,arguments)}function gt(){return(gt=_(k.a.mark((function t(e,n,r){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,lt(e,(function(t){return bt(t,n,r)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function bt(t,e,n){return wt.apply(this,arguments)}function wt(){return(wt=_(k.a.mark((function t(e,n,r){var i,o;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,r.fetch);case 2:return i=t.sent,t.next=5,i.arrayBuffer();case 5:return o=t.sent,t.next=8,n(o,r);case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function kt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Tt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?kt(Object(n),!0).forEach((function(e){b(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function _t(t){return Et.apply(this,arguments)}function Et(){return(Et=_(k.a.mark((function t(e){var n,r,i=arguments;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},t.next=3,St(e,n);case 3:return r=t.sent,t.next=6,xt(r,et,n);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function St(t,e){return Mt.apply(this,arguments)}function Mt(){return(Mt=_(k.a.mark((function t(e,n){var r,i,o=arguments;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=o.length>2&&void 0!==o[2]?o[2]:{},0===(i=n&&n.image&&n.image.mipLevels||0)){t.next=8;break}return t.next=5,Ot(e,i,n,r);case 5:t.t0=t.sent,t.next=9;break;case 8:t.t0=ut(e,n,r);case 9:return t.abrupt("return",t.t0);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ot(t,e,n,r){return Pt.apply(this,arguments)}function Pt(){return(Pt=_(k.a.mark((function t(e,n,r,i){var o,a,s,u,c,l,h,f;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=[],"auto"!==n){t.next=9;break}return a=ut(e,r,Tt(Tt({},i),{},{lod:0})),t.next=5,bt(a,et,r);case 5:s=t.sent,u=N(s),c=u.width,l=u.height,n=At({width:c,height:l}),o.push(a);case 9:for(E(n>0),h=o.length;h<n;++h)f=ut(e,r,Tt(Tt({},i),{},{lod:h})),o.push(f);return t.abrupt("return",o);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function At(t){var e=t.width,n=t.height;return 1+Math.floor(Math.log2(Math.max(e,n)))}class Lt{constructor(t,{brdfLutUrl:e,getTexUrl:n,specularMipLevels:r=10}){this.gl=t,this.brdfLutUrl=e,this.getTexUrl=n,this.specularMipLevels=r}makeCube({id:t,getTextureForFace:e,parameters:n}){const i={};return r.TextureCube.FACES.forEach(t=>{i[t]=e(t)}),new r.TextureCube(this.gl,{id:t,mipmaps:!1,parameters:n,pixels:i})}getDiffuseEnvSampler(){return this._DiffuseEnvSampler||(this._DiffuseEnvSampler=this.makeCube({id:"DiffuseEnvSampler",getTextureForFace:t=>_t(this.getTexUrl("diffuse",t,0)),parameters:{[m]:g,[x]:g,[y]:p,[d]:p}})),this._DiffuseEnvSampler}getSpecularEnvSampler(){return this._SpecularEnvSampler||(this._SpecularEnvSampler=this.makeCube({id:"SpecularEnvSampler",getTextureForFace:t=>{const e=[];for(let n=0;n<=this.specularMipLevels-1;n++)e.push(_t(this.getTexUrl("specular",t,n)));return e},parameters:{[m]:g,[x]:g,[y]:v,[d]:p}})),this._SpecularEnvSampler}getBrdfTexture(){return this._BrdfTexture||(this._BrdfTexture=new r.Texture2D(this.gl,{id:"brdfLUT",parameters:{[m]:g,[x]:g,[y]:p,[d]:p},data:_t(this.brdfLutUrl)})),this._BrdfTexture}delete(){this._DiffuseEnvSampler&&(this._DiffuseEnvSampler.delete(),this._DiffuseEnvSampler=null),this._SpecularEnvSampler&&(this._SpecularEnvSampler.delete(),this._SpecularEnvSampler=null),this._BrdfTexture&&(this._BrdfTexture.delete(),this._BrdfTexture=null)}}function Rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function It(t,e){if(t){if("string"==typeof t)return Rt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rt(t,e):void 0}}function Nt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||It(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var jt=n(3),Bt=n(2);function Ct(t,e){return(Ct=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Dt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ct(t,e)}function Ft(t,e){return!e||"object"!==Object(R.a)(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function zt(t){return(zt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Ut(t,e,n){return(Ut=Vt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&Ct(i,n.prototype),i}).apply(null,arguments)}function qt(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}Math.PI,Math.PI;var Gt={};function Zt(t){return Math.round(t/Gt.EPSILON)*Gt.EPSILON}function Xt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.precision,r=void 0===n?Gt.precision||4:n;return t=Zt(t),"".concat(parseFloat(t.toPrecision(r)))}function Ht(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Wt(t,e,n){var r=Gt.EPSILON;n&&(Gt.EPSILON=n);try{if(t===e)return!0;if(Ht(t)&&Ht(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!Wt(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=Gt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{Gt.EPSILON=r}}function Kt(t,e){if(t.length!==e)return!1;for(var n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Yt(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function $t(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(Gt.debug&&!Kt(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}Gt.EPSILON=1e-12,Gt.debug=!1,Gt.precision=4,Gt.printTypes=!1,Gt.printDegrees=!1,Gt.printRowMajor=!0;var Qt={};function Jt(t,e){Qt[t]||(Qt[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}function te(t){var e="function"==typeof Map?new Map:void 0;return(te=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Ut(t,arguments,zt(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Ct(r,t)})(t)}function ee(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=zt(t);if(e){var i=zt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ft(this,n)}}var ne=function(t){Dt(n,t);var e=ee(n);function n(){return Object(jt.a)(this,n),e.apply(this,arguments)}return Object(Bt.a)(n,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}},{key:"to",value:function(t){return t===this?this:Ht(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(Gt)}},{key:"formatString",value:function(t){for(var e="",n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+Xt(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Wt(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,n){void 0===n&&(n=e,e=t,t=this);for(var r=0;r<this.ELEMENTS;++r){var i=t[r];this[r]=i+n*(e[r]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var o=i[r],a=0;a<this.ELEMENTS;++a)this[a]+=o[a];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var o=i[r],a=0;a<this.ELEMENTS;++a)this[a]-=o[a];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(Gt.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"ELEMENTS",get:function(){return qt(!1),0}},{key:"RANK",get:function(){return qt(!1),0}},{key:"elements",get:function(){return this}}]),n}(te(Array));function re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=zt(t);if(e){var i=zt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ft(this,n)}}var ie=function(t){Dt(n,t);var e=re(n);function n(){return Object(jt.a)(this,n),e.apply(this,arguments)}return Object(Bt.a)(n,[{key:"toString",value:function(){var t="[";if(Gt.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(var r=0;r<this.ELEMENTS;++r)t+=" ".concat(this[r])}return t+="]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,n){return this[e*this.RANK+t]=Yt(n),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),n=t*this.RANK,r=0;r<this.RANK;++r)e[r]=this[n+r];return e}},{key:"setColumn",value:function(t,e){for(var n=t*this.RANK,r=0;r<this.RANK;++r)this[n+r]=e[r];return this}}]),n}(ne);function oe(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o||1;return t[0]=(n[0]*r+n[4]*i+n[8]*o)/a,t[1]=(n[1]*r+n[5]*i+n[9]*o)/a,t[2]=(n[2]*r+n[6]*i+n[10]*o)/a,t}var ae=1e-6,se="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function ue(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],p=e[10],v=e[11],d=e[12],y=e[13],m=e[14],x=e[15],g=n[0],b=n[1],w=n[2],k=n[3];return t[0]=g*r+b*s+w*h+k*d,t[1]=g*i+b*u+w*f+k*y,t[2]=g*o+b*c+w*p+k*m,t[3]=g*a+b*l+w*v+k*x,g=n[4],b=n[5],w=n[6],k=n[7],t[4]=g*r+b*s+w*h+k*d,t[5]=g*i+b*u+w*f+k*y,t[6]=g*o+b*c+w*p+k*m,t[7]=g*a+b*l+w*v+k*x,g=n[8],b=n[9],w=n[10],k=n[11],t[8]=g*r+b*s+w*h+k*d,t[9]=g*i+b*u+w*f+k*y,t[10]=g*o+b*c+w*p+k*m,t[11]=g*a+b*l+w*v+k*x,g=n[12],b=n[13],w=n[14],k=n[15],t[12]=g*r+b*s+w*h+k*d,t[13]=g*i+b*u+w*f+k*y,t[14]=g*o+b*c+w*p+k*m,t[15]=g*a+b*l+w*v+k*x,t}function ce(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function le(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}function he(t,e,n,r){var i,o,a,s,u,c,l,h,f,p,v=e[0],d=e[1],y=e[2],m=r[0],x=r[1],g=r[2],b=n[0],w=n[1],k=n[2];return Math.abs(v-b)<ae&&Math.abs(d-w)<ae&&Math.abs(y-k)<ae?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(l=v-b,h=d-w,f=y-k,i=x*(f*=p=1/Math.hypot(l,h,f))-g*(h*=p),o=g*(l*=p)-m*f,a=m*h-x*l,(p=Math.hypot(i,o,a))?(i*=p=1/p,o*=p,a*=p):(i=0,o=0,a=0),s=h*a-f*o,u=f*i-l*a,c=l*o-h*i,(p=Math.hypot(s,u,c))?(s*=p=1/p,u*=p,c*=p):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=l,t[3]=0,t[4]=o,t[5]=u,t[6]=h,t[7]=0,t[8]=a,t[9]=c,t[10]=f,t[11]=0,t[12]=-(i*v+o*d+a*y),t[13]=-(s*v+u*d+c*y),t[14]=-(l*v+h*d+f*y),t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var fe,pe;fe=new se(2),se!=Float32Array&&(fe[0]=0,fe[1]=0),pe=fe;function ve(){var t=new se(3);return se!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function de(t,e,n){var r=new se(3);return r[0]=t,r[1]=e,r[2]=n,r}function ye(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function me(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function xe(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}var ge=function(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)};!function(){var t=ve()}();function be(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function we(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function ke(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2],c=n[3],l=c*r+s*o-u*i,h=c*i+u*r-a*o,f=c*o+a*i-s*r,p=-a*r-s*i-u*o;return t[0]=l*c+p*-a+h*-u-f*-s,t[1]=h*c+p*-s+f*-a-l*-u,t[2]=f*c+p*-u+l*-s-h*-a,t[3]=e[3],t}!function(){var t=function(){var t=new se(4);return se!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}()}();function Te(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=zt(t);if(e){var i=zt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ft(this,n)}}var _e=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ee=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Se=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),Me={},Oe=function(t){Dt(n,t);var e=Te(n);function n(t){var r;return Object(jt.a)(this,n),r=e.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?r.copy(t):r.identity(),r}return Object(Bt.a)(n,[{key:"INDICES",get:function(){return Se}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return Me.IDENTITY=Me.IDENTITY||Object.freeze(new n(_e)),Me.IDENTITY}},{key:"ZERO",get:function(){return Me.ZERO=Me.ZERO||Object.freeze(new n(Ee)),Me.ZERO}}]),Object(Bt.a)(n,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,n,r,i,o,a,s,u,c,l,h,f,p,v,d){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=s,this[8]=u,this[9]=c,this[10]=l,this[11]=h,this[12]=f,this[13]=p,this[14]=v,this[15]=d,this.check()}},{key:"setRowMajor",value:function(t,e,n,r,i,o,a,s,u,c,l,h,f,p,v,d){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=o,this[6]=c,this[7]=p,this[8]=n,this[9]=a,this[10]=l,this[11]=v,this[12]=r,this[13]=s,this[14]=h,this[15]=d,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(_e)}},{key:"fromQuaternion",value:function(t){return function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,c=n*a,l=r*a,h=r*s,f=i*a,p=i*s,v=i*u,d=o*a,y=o*s,m=o*u;t[0]=1-h-v,t[1]=l+m,t[2]=f-y,t[3]=0,t[4]=l-m,t[5]=1-c-v,t[6]=p+d,t[7]=0,t[8]=f+y,t[9]=p-d,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}},{key:"frustum",value:function(t){var e=t.left,r=t.right,i=t.bottom,o=t.top,a=t.near,s=t.far;return s===1/0?n._computeInfinitePerspectiveOffCenter(this,e,r,i,o,a):function(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),c=1/(o-a);t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0}(this,e,r,i,o,a,s),this.check()}},{key:"lookAt",value:function(t,e,n){if(1===arguments.length){var r=t;t=r.eye,e=r.center,n=r.up}return he(this,t,e=e||[0,0,0],n=n||[0,1,0]),this.check()}},{key:"ortho",value:function(t){var e=t.left,n=t.right,r=t.bottom,i=t.top,o=t.near,a=void 0===o?.1:o,s=t.far;return function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*c,t[15]=1}(this,e,n,r,i,a,void 0===s?500:s),this.check()}},{key:"orthographic",value:function(t){var e=t.fovy,r=void 0===e?45*Math.PI/180:e,i=t.aspect,o=void 0===i?1:i,a=t.focalDistance,s=void 0===a?1:a,u=t.near,c=void 0===u?.1:u,l=t.far,h=void 0===l?500:l;if(r>2*Math.PI)throw Error("radians");var f=r/2,p=s*Math.tan(f),v=p*o;return(new n).ortho({left:-v,right:v,bottom:-p,top:p,near:c,far:h})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,n=void 0===e?void 0:e,r=t.fov,i=void 0===r?45*Math.PI/180:r,o=t.aspect,a=void 0===o?1:o,s=t.near,u=void 0===s?.1:s,c=t.far,l=void 0===c?500:c;if((n=n||i)>2*Math.PI)throw Error("radians");return le(this,n,a,u,l),this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],h=t[10],f=t[11],p=t[12],v=t[13],d=t[14],y=t[15],(e*a-n*o)*(h*y-f*d)-(e*s-r*o)*(l*y-f*v)+(e*u-i*o)*(l*d-h*v)+(n*s-r*a)*(c*y-f*p)-(n*u-i*a)*(c*d-h*p)+(r*u-i*s)*(c*v-l*p);var t,e,n,r,i,o,a,s,u,c,l,h,f,p,v,d,y}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),r=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(e||[-0,-0,-0]),r=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*o,t}},{key:"transpose",value:function(){return function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],f=e[10],p=e[11],v=e[12],d=e[13],y=e[14],m=e[15],x=n*s-r*a,g=n*u-i*a,b=n*c-o*a,w=r*u-i*s,k=r*c-o*s,T=i*c-o*u,_=l*d-h*v,E=l*y-f*v,S=l*m-p*v,M=h*y-f*d,O=h*m-p*d,P=f*m-p*y,A=x*P-g*O+b*M+w*S-k*E+T*_;A&&(A=1/A,t[0]=(s*P-u*O+c*M)*A,t[1]=(i*O-r*P-o*M)*A,t[2]=(d*T-y*k+m*w)*A,t[3]=(f*k-h*T-p*w)*A,t[4]=(u*S-a*P-c*E)*A,t[5]=(n*P-i*S+o*E)*A,t[6]=(y*b-v*T-m*g)*A,t[7]=(l*T-f*b+p*g)*A,t[8]=(a*O-s*S+c*_)*A,t[9]=(r*S-n*O-o*_)*A,t[10]=(v*k-d*b+m*x)*A,t[11]=(h*b-l*k-p*x)*A,t[12]=(s*E-a*M-u*_)*A,t[13]=(n*M-r*E+i*_)*A,t[14]=(d*g-v*w-y*x)*A,t[15]=(l*w-h*g+f*x)*A)}(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return ue(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return ue(this,this,t),this.check()}},{key:"rotateX",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*r,t[5]=a*i+l*r,t[6]=s*i+h*r,t[7]=u*i+f*r,t[8]=c*i-o*r,t[9]=l*i-a*r,t[10]=h*i-s*r,t[11]=f*i-u*r}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[8],l=e[9],h=e[10],f=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*r,t[1]=a*i-l*r,t[2]=s*i-h*r,t[3]=u*i-f*r,t[8]=o*r+c*i,t[9]=a*r+l*i,t[10]=s*r+h*i,t[11]=u*r+f*i}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],h=e[6],f=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*r,t[1]=a*i+l*r,t[2]=s*i+h*r,t[3]=u*i+f*r,t[4]=c*i-o*r,t[5]=l*i-a*r,t[6]=h*i-s*r,t[7]=f*i-u*r}(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=Nt(t,3),n=e[0],r=e[1],i=e[2];return this.rotateX(n).rotateY(r).rotateZ(i)}},{key:"rotateAxis",value:function(t,e){return function(t,e,n,r){var i,o,a,s,u,c,l,h,f,p,v,d,y,m,x,g,b,w,k,T,_,E,S,M,O=r[0],P=r[1],A=r[2],L=Math.hypot(O,P,A);L<ae||(O*=L=1/L,P*=L,A*=L,i=Math.sin(n),a=1-(o=Math.cos(n)),s=e[0],u=e[1],c=e[2],l=e[3],h=e[4],f=e[5],p=e[6],v=e[7],d=e[8],y=e[9],m=e[10],x=e[11],g=O*O*a+o,b=P*O*a+A*i,w=A*O*a-P*i,k=O*P*a-A*i,T=P*P*a+o,_=A*P*a+O*i,E=O*A*a+P*i,S=P*A*a-O*i,M=A*A*a+o,t[0]=s*g+h*b+d*w,t[1]=u*g+f*b+y*w,t[2]=c*g+p*b+m*w,t[3]=l*g+v*b+x*w,t[4]=s*k+h*T+d*_,t[5]=u*k+f*T+y*_,t[6]=c*k+p*T+m*_,t[7]=l*k+v*T+x*_,t[8]=s*E+h*S+d*M,t[9]=u*E+f*S+y*M,t[10]=c*E+p*S+m*M,t[11]=l*E+v*S+x*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?ce(this,this,t):ce(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return function(t,e,n){var r,i,o,a,s,u,c,l,h,f,p,v,d=n[0],y=n[1],m=n[2];e===t?(t[12]=e[0]*d+e[4]*y+e[8]*m+e[12],t[13]=e[1]*d+e[5]*y+e[9]*m+e[13],t[14]=e[2]*d+e[6]*y+e[10]*m+e[14],t[15]=e[3]*d+e[7]*y+e[11]*m+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],p=e[10],v=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=h,t[9]=f,t[10]=p,t[11]=v,t[12]=r*d+s*y+h*m+e[12],t[13]=i*d+u*y+f*m+e[13],t[14]=o*d+c*y+p*m+e[14],t[15]=a*d+l*y+v*m+e[15])}(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?($t(e=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(e||[-0,-0],t,this);break;case 3:e=xe(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return $t(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=function(t,e,n){var r=e[0],i=e[1],o=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/o,t[1]=(n[1]*r+n[5]*i)/o,t}(e||[-0,-0],t,this);break;case 3:e=oe(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return $t(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,n){return this.identity().translate([t,e,n])}},{key:"transformPoint",value:function(t,e){return Jt("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return Jt("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return Jt("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,n,r,i,o){var a=2*o/(n-e),s=2*o/(i-r),u=(n+e)/(n-e),c=(i+r)/(i-r),l=-2*o;return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=l,t[15]=0,t}}]),n}(ie);function Pe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=zt(t);if(e){var i=zt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ft(this,n)}}var Ae=function(t){Dt(n,t);var e=Pe(n);function n(){return Object(jt.a)(this,n),e.apply(this,arguments)}return Object(Bt.a)(n,[{key:"copy",value:function(t){return qt(!1),this}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n){var r=this[n]-t[n];e+=r*r}return Yt(e)}},{key:"dot",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return Yt(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var o=i[r],a=0;a<this.ELEMENTS;++a)this[a]*=o[a];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)for(var o=i[r],a=0;a<this.ELEMENTS;++a)this[a]/=o[a];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return qt(t>=0&&t<this.ELEMENTS,"index is out of range"),Yt(this[t])}},{key:"setComponent",value:function(t,e){return qt(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=Yt(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=Yt(t)}}]),n}(ne);function Le(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=zt(t);if(e){var i=zt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ft(this,n)}}var Re=[0,0,0],Ie={},Ne=function(t){Dt(n,t);var e=Le(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(jt.a)(this,n),t=e.call(this,-0,-0,-0),1===arguments.length&&Ht(r)?t.copy(r):(Gt.debug&&(Yt(r),Yt(i),Yt(o)),t[0]=r,t[1]=i,t[2]=o),t}return Object(Bt.a)(n,null,[{key:"ZERO",get:function(){return Ie.ZERO=Ie.ZERO||Object.freeze(new n(0,0,0,0))}}]),Object(Bt.a)(n,[{key:"set",value:function(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return Gt.debug&&(Yt(t.x),Yt(t.y),Yt(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return n=t,r=(e=this)[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2],c=Math.sqrt(r*r+i*i+o*o)*Math.sqrt(a*a+s*s+u*u),l=c&&ye(e,n)/c,Math.acos(Math.min(Math.max(l,-1),1));var e,n,r,i,o,a,s,u,c,l}},{key:"cross",value:function(t){return me(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,n=t.origin;return function(t,e,n,r){var i=[],o=[];i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2]}(this,this,void 0===n?Re:n,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,n=t.origin;return function(t,e,n,r){var i=[],o=[];i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2]}(this,this,void 0===n?Re:n,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,n=t.origin;return function(t,e,n,r){var i=[],o=[];i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2]}(this,this,void 0===n?Re:n,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return xe(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return oe(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return function(t,e,n){var r=e[0],i=e[1],o=e[2];t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8]}(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,n){var r=e[0],i=e[1];t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return function(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],l=i*c-o*u,h=o*s-r*c,f=r*u-i*s,p=i*f-o*h,v=o*l-r*f,d=r*h-i*l,y=2*a;l*=y,h*=y,f*=y,p*=2,v*=2,d*=2,t[0]=s+l+p,t[1]=u+h+v,t[2]=c+f+d}(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=Yt(t)}}]),n}(Ae);class je{constructor(t={}){const{id:e}=t;this.id=e||Object(r.uid)(this.constructor.name),this.display=!0,this.position=new Ne,this.rotation=new Ne,this.scale=new Ne(1,1,1),this.matrix=new Oe,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(t){return Object(r.assert)(3===t.length,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return Object(r.assert)(3===t.length,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return Object(r.assert)(3===t.length,"setScale requires vector argument"),this.scale=t,this}setMatrix(t,e=!0){e?this.matrix.copy(t):this.matrix=t}setMatrixComponents({position:t,rotation:e,scale:n,update:r=!0}){return t&&this.setPosition(t),e&&this.setRotation(e),n&&this.setScale(n),r&&this.updateMatrix(),this}updateMatrix(){const t=this.position,e=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(n),this}update(t={}){const{position:e,rotation:n,scale:r}=t;return e&&this.setPosition(e),n&&this.setRotation(n),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(t,e){Object(r.assert)(t),e=e||this.matrix;const n=new Oe(t).multiplyRight(e),i=n.invert(),o=i.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class Be extends je{constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:e=[]}=t;r.log.assert(e.every(t=>t instanceof je),"every child must an instance of ScenegraphNode"),super(t),this.children=e}add(...t){for(const e of t)Array.isArray(e)?this.add(...e):this.children.push(e);return this}remove(t){const e=this.children,n=e.indexOf(t);return n>-1&&e.splice(n,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(t=>t.delete()),this.removeAll(),super.delete()}traverse(t,{worldMatrix:e=new Oe}={}){const n=new Oe(e).multiplyRight(this.matrix);for(const e of this.children)e instanceof Be?e.traverse(t,{worldMatrix:n}):t(e,{worldMatrix:n})}}function Ce(){var t=new se(4);return se!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function De(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Fe(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],c=n[2],l=n[3];return t[0]=r*l+a*s+i*c-o*u,t[1]=i*l+a*u+o*s-r*c,t[2]=o*l+a*c+r*u-i*s,t[3]=a*l-r*s-i*u-o*c,t}function ze(t,e,n,r){var i,o,a,s,u,c=e[0],l=e[1],h=e[2],f=e[3],p=n[0],v=n[1],d=n[2],y=n[3];return(o=c*p+l*v+h*d+f*y)<0&&(o=-o,p=-p,v=-v,d=-d,y=-y),1-o>ae?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r),t[0]=s*c+u*p,t[1]=s*l+u*v,t[2]=s*h+u*d,t[3]=s*f+u*y,t}function Ve(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t}var Ue,qe,Ge,Ze,Xe,He,We=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Ke=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Ye=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},$e=function(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t},Qe=be,Je=we,tn=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t},en=(Ue=ve(),qe=de(1,0,0),Ge=de(0,1,0),function(t,e,n){var r=ye(e,n);return r<-.999999?(me(Ue,qe,e),ge(Ue)<1e-6&&me(Ue,Ge,e),function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o}(Ue,Ue),De(t,Ue,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(me(Ue,e,n),t[0]=Ue[0],t[1]=Ue[1],t[2]=Ue[2],t[3]=1+r,tn(t,t))});Ze=Ce(),Xe=Ce(),He=function(){var t=new se(9);return se!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}();function nn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=zt(t);if(e){var i=zt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ft(this,n)}}var rn=[0,0,0,1],on=function(t){Dt(n,t);var e=nn(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(jt.a)(this,n),t=e.call(this,-0,-0,-0,-0),Array.isArray(r)&&1===arguments.length?t.copy(r):t.set(r,i,o,a),t}return Object(Bt.a)(n,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"set",value:function(t,e,n,r){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this.check()}},{key:"fromMatrix3",value:function(t){return Ve(this,t),this.check()}},{key:"identity",value:function(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}},{key:"fromAxisRotation",value:function(t,e){return De(this,t,e),this.check()}},{key:"setAxisAngle",value:function(t,e){return this.fromAxisRotation(t,e)}},{key:"len",value:function(){return Qe(this)}},{key:"lengthSquared",value:function(){return Je(this)}},{key:"dot",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return Ye(this,t)}},{key:"rotationTo",value:function(t,e){return en(this,t,e),this.check()}},{key:"add",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return We(this,this,t),this.check()}},{key:"calculateW",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2];t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i))}(this,this),this.check()}},{key:"conjugate",value:function(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s}(this,this),this.check()}},{key:"lerp",value:function(t,e,n){return $e(this,t,e,n),this.check()}},{key:"multiplyRight",value:function(t,e){return qt(!e),Fe(this,this,t),this.check()}},{key:"multiplyLeft",value:function(t,e){return qt(!e),Fe(this,t,this),this.check()}},{key:"normalize",value:function(){var t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}},{key:"rotateX",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);t[0]=r*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-r*s}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);t[0]=r*u-o*s,t[1]=i*u+a*s,t[2]=o*u+r*s,t[3]=a*u-i*s}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=o*u+a*s,t[3]=a*u-o*s}(this,this,t),this.check()}},{key:"scale",value:function(t){return Ke(this,this,t),this.check()}},{key:"slerp",value:function(t,e,n){switch(arguments.length){case 1:var r=arguments[0],i=r.start;t=void 0===i?rn:i,e=r.target,n=r.ratio;break;case 2:var o=Array.prototype.slice.call(arguments);e=o[0],n=o[1],t=this}return ze(this,t,e,n),this.check()}},{key:"transformVector4",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return ke(e,t,this),$t(e,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(t,e){return this.setAxisAngle(t,e)}},{key:"premultiply",value:function(t,e){return this.multiplyLeft(t,e)}},{key:"multiply",value:function(t,e){return this.multiplyRight(t,e)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=Yt(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=Yt(t)}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=Yt(t)}},{key:"w",get:function(){return this[3]},set:function(t){this[3]=Yt(t)}}]),n}(ne);const an={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},sn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function un(t){if(!t._animation){const e=sn[t.componentType],n=an[t.type],r=n*t.count,{buffer:i,byteOffset:o}=t.bufferView.data,a=new e(i,o+(t.byteOffset||0),r);if(1===n)t._animation=Array.from(a);else{const e=[];for(let t=0;t<a.length;t+=n)e.push(Array.from(a.slice(t,t+n)));t._animation=e}}return t._animation}const cn=new Oe;const ln=new on;function hn(t,{input:e,interpolation:n,output:i},o,a){const s=t%e[e.length-1],u=e.findIndex(t=>t>=s),c=Math.max(0,u-1);if(!Array.isArray(o[a]))switch(a){case"translation":o[a]=[0,0,0];break;case"rotation":o[a]=[0,0,0,1];break;case"scale":o[a]=[1,1,1];break;default:r.log.warn("Bad animation path "+a)()}Object(r.assert)(o[a].length===i[c].length);const l=e[c],h=e[u];switch(n){case"STEP":!function(t,e,n){for(let r=0;r<n.length;r++)t[e][r]=n[r]}(o,a,i[c]);break;case"LINEAR":if(h>l){const t=(s-l)/(h-l);!function(t,e,n,r,i){if("rotation"===e){ln.slerp({start:n,target:r,ratio:i});for(let n=0;n<ln.length;n++)t[e][n]=ln[n]}else for(let o=0;o<n.length;o++)t[e][o]=i*r[o]+(1-i)*n[o]}(o,a,i[c],i[u],t)}break;case"CUBICSPLINE":if(h>l){const t=(s-l)/(h-l),e=h-l;!function(t,e,{p0:n,outTangent0:r,inTangent1:i,p1:o,tDiff:a,ratio:s}){for(let u=0;u<t[e].length;u++){const c=r[u]*a,l=i[u]*a;t[e][u]=(2*Math.pow(s,3)-3*Math.pow(s,2)+1)*n[u]+(Math.pow(s,3)-2*Math.pow(s,2)+s)*c+(-2*Math.pow(s,3)+3*Math.pow(s,2))*o[u]+(Math.pow(s,3)-Math.pow(s,2))*l}}(o,a,{p0:i[3*c+1],outTangent0:i[3*c+2],inTangent1:i[3*u+0],p1:i[3*u+1],tDiff:e,ratio:t})}break;default:r.log.warn(`Interpolation ${n} not supported`)()}}class fn{constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const e=(t/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:t,target:n,path:r})=>{hn(e,t,n,r),function(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=cn.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}(n,n._node)})}}class pn{constructor(t){this.animations=t.animations.map((e,n)=>{const r=e.name||"Animation-"+n,i=e.samplers.map(({input:e,interpolation:n="LINEAR",output:r})=>({input:un(t.accessors[e]),interpolation:n,output:un(t.accessors[r])})),o=e.channels.map(({sampler:e,target:n})=>({sampler:i[e],target:t.nodes[n.node],path:n.path}));return new fn({name:r,channels:o})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(e=>e.animate(t))}getAnimations(){return this.animations}}class vn extends je{constructor(t,e={}){super(e),this.onBeforeRender=null,this.AfterRender=null,t instanceof r.Model?(this.model=t,this._setModelNodeProps(e)):this.model=new r.Model(t,e),this.managedResources=e.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(t=>t.delete()),this.managedResources=[]}draw(...t){return this.model.draw(...t)}setUniforms(...t){return this.model.setUniforms(...t),this}setAttributes(...t){return this.model.setAttributes(...t),this}updateModuleSettings(...t){return this.model.updateModuleSettings(...t),this}_setModelNodeProps(t){this.model.setProps(t)}}class dn{constructor(t,{attributes:e,material:n,pbrDebug:i,imageBasedLightingEnvironment:o,lights:a,useTangents:s}){this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Object(r.hasFeature)(t,r.FEATURES.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],o&&(this.uniforms.u_DiffuseEnvSampler=o.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=o.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=o.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),i&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(e.NORMAL,"HAS_NORMALS"),this.defineIfPresent(e.TANGENT&&s,"HAS_TANGENTS"),this.defineIfPresent(e.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(o,"USE_IBL"),this.defineIfPresent(a,"USE_LIGHTS"),this.defineIfPresent(i,"PBR_DEBUG"),n&&this.parseMaterial(n)}defineIfPresent(t,e){t&&(this.defines[e]=1)}parseTexture(t,e,n=null){const i=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},o=new r.Texture2D(this.gl,{id:t.name||t.id,parameters:i,pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},data:t.texture.source.image});this.uniforms[e]=o,this.defineIfPresent(n,n),this.generatedTextures.push(o)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:e=1,roughnessFactor:n=1}=t;this.uniforms.u_MetallicRoughnessValues=[e,n]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=Boolean(t.unlit),t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:e=1}=t.normalTexture;this.uniforms.u_NormalScale=e}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:e=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=e}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),"MASK"===t.alphaMode){const{alphaCutoff:e=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=e}else"BLEND"===t.alphaMode&&(r.log.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}}function yn(t,e){return Object(r.isWebGL2)(t)?"#version 300 es\n"+e:e}const mn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xn={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class gn{constructor(t,e={}){this.gl=t,this.options=Object.assign({},xn,e)}instantiate(t){this.gltf=t;return(t.scenes||[]).map(t=>this.createScene(t))}createAnimator(){return Array.isArray(this.gltf.animations)?new pn(this.gltf):null}createScene(t){const e=(t.nodes||[]).map(t=>this.createNode(t));return new Be({id:t.name||t.id,children:e})}createNode(t){if(!t._node){const e=(t.children||[]).map(t=>this.createNode(t));t.mesh&&e.push(this.createMesh(t.mesh));const n=new Be({id:t.name||t.id,children:e});if(t.matrix)n.setMatrix(t.matrix);else{if(n.matrix.identity(),t.translation&&n.matrix.translate(t.translation),t.rotation){const e=(new Oe).fromQuaternion(t.rotation);n.matrix.multiplyRight(e)}t.scale&&n.matrix.scale(t.scale)}t._node=n}return t._node}createMesh(t){if(!t._mesh){const e=(t.primitives||[]).map((e,n)=>this.createPrimitive(e,n,t)),n=new Be({id:t.name||t.id,children:e});t._mesh=n}return t._mesh}getVertexCount(t){r.log.warn("getVertexCount() not found")()}createPrimitive(t,e,n){return function(t,e){const{id:n,drawMode:i,vertexCount:o,attributes:a,modelOptions:s}=e,u=new dn(t,e);r.log.info(4,"createGLTFModel defines: ",u.defines)();const c=[];c.push(...u.generatedTextures),c.push(...Object.values(a).map(t=>t.buffer));const l=new vn(t,Object.assign({id:n,drawMode:i,vertexCount:o,modules:[r.pbr],defines:u.defines,parameters:u.parameters,vs:yn(t,"\n#if (__VERSION__ < 300)\n  #define _attr attribute\n#else\n  #define _attr in\n#endif\n\n  _attr vec4 POSITION;\n\n  #ifdef HAS_NORMALS\n    _attr vec4 NORMAL;\n  #endif\n\n  #ifdef HAS_TANGENTS\n    _attr vec4 TANGENT;\n  #endif\n\n  #ifdef HAS_UV\n    _attr vec2 TEXCOORD_0;\n  #endif\n\n  void main(void) {\n    vec4 _NORMAL = vec4(0.);\n    vec4 _TANGENT = vec4(0.);\n    vec2 _TEXCOORD_0 = vec2(0.);\n\n    #ifdef HAS_NORMALS\n      _NORMAL = NORMAL;\n    #endif\n\n    #ifdef HAS_TANGENTS\n      _TANGENT = TANGENT;\n    #endif\n\n    #ifdef HAS_UV\n      _TEXCOORD_0 = TEXCOORD_0;\n    #endif\n\n    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);\n    gl_Position = u_MVPMatrix * POSITION;\n  }\n"),fs:yn(t,"\n#if (__VERSION__ < 300)\n  #define fragmentColor gl_FragColor\n#else\n  out vec4 fragmentColor;\n#endif\n\n  void main(void) {\n    fragmentColor = pbr_filterColor(vec4(0));\n  }\n"),managedResources:c},s));return l.setProps({attributes:a}),l.setUniforms(u.uniforms),l}(this.gl,Object.assign({id:t.name||`${n.name||n.id}-primitive-${e}`,drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options))}createAttributes(t,e){const n={};return Object.keys(t).forEach(e=>{n[e]=this.createAccessor(t[e],this.createBuffer(t[e],this.gl.ARRAY_BUFFER))}),e&&(n.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),r.log.info(4,"glTF Attributes",{attributes:t,indices:e,generated:n})(),n}createBuffer(t,e){t.bufferView||(t.bufferView={});const{bufferView:n}=t;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[e]||(n.lumaBuffers[e]=new r.Buffer(this.gl,{id:"from-"+n.id,data:n.data||t.value,target:e})),n.lumaBuffers[e]}createAccessor(t,e){return new r.Accessor({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:mn[t.type]})}createSampler(t){return t}needsPOT(){return!1}}function bn(t,e,n){const r=new gn(t,n);return{scenes:r.instantiate(e),animator:r.createAnimator()}}const wn="// Get current pixel indices for a given size\nvec2 histoPyramid_getPixelIndices(vec2 size) {\n  vec2 pixelOffset = transform_getPixelSizeHalf(size);\n  vec2 pixelIndices = transform_getPixelIndices(size, pixelOffset);\n  return pixelIndices;\n}\n\n// returns the top left texture coordiante corresponding to 2X2 block in higher level texture.\n// size: lower level texture size\n// scale: usually (2, 2)\n// offset: offset with-in 2X2 block of higher level texture\nvec2 histoPyramid_getTexCoord(vec2 size, vec2 scale, vec2 offset) {\n  // use actual (scaled) texture size to calcualte offset (multiplied by scale)\n  vec2 scaledSize = size * scale;\n\n  // use minified texture size to find corresponding pixel index in out texture\n  vec2 pixelIndices = histoPyramid_getPixelIndices(size);\n\n  // now scale the indices to point to correct 2X2 block\n  pixelIndices = pixelIndices * scale;\n\n  // generate tex coordinate using actual size\n  vec2 texCoord = pixelIndices / scaledSize;\n  vec2 inPixelOffset = transform_getPixelSizeHalf(scaledSize);\n\n  return texCoord + (offset / scaledSize) + inPixelOffset;\n}\n\n// returns pixel value from higher level texture based on scale and offset\n// texSampler: higher level texture sampler\n// size: lower level texture size\n// scale: usually (2, 2)\n// offset: offset with-in 2X2 block of higher level texture\nvec4 histoPyramid_getInput(sampler2D texSampler, vec2 size, vec2 scale, vec2 offset) {\n  vec2 texCoord = histoPyramid_getTexCoord(size, scale, offset);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n";function kn(t){const e=Math.ceil(Math.log2(t));return Math.pow(2,e)}const Tn={r:0,x:0,g:1,y:1,b:2,z:2,a:3,w:3};function _n(t,e){const{texture:n,channel:i="r",_readData:o=!1}=e;let{width:a,height:s}=n;a=kn(a),s=kn(s);const u=(a>s?a:s)/2,c=Object(r.cloneTextureFrom)(n,{width:u,height:u}),l=new r.Transform(t,{_sourceTextures:{inTexture:n},_targetTexture:c,_targetTextureVarying:"outTexture",vs:wn+"attribute vec4 inTexture;\nvarying vec4 outTexture;\nuniform int channel;\nuniform vec4 padingPixelValue;\n\nvoid main()\n{\n  vec2 size = transform_uSize_outTexture;\n  // vec2 scale = vec2(2., 2.);\n  vec2 scale = transform_uSize_inTexture / transform_uSize_outTexture;\n\n  // Verify if reference to a input texture pixel is out of bounds, if so treat the pixel as (0, 0)\n  vec2 pixelIndices = histoPyramid_getPixelIndices(size);\n  // now scale the indices padded size to point to correct 2X2 block\n  pixelIndices = pixelIndices * vec2(2, 2);\n\n  vec2 baseLevelSize = transform_uSize_inTexture;\n\n  // For all pixels outside of original texture size, return paddingPixelValue\n  bool xInside = pixelIndices.x < baseLevelSize.x;\n  bool yInside = pixelIndices.y < baseLevelSize.y;\n  bool xPlusOneInside = pixelIndices.x + 1. < baseLevelSize.x;\n  bool yPlusOneInside = pixelIndices.y + 1. < baseLevelSize.y;\n\n  vec4 pixel = (xInside && yInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 0))\n    : padingPixelValue;\n\n  vec4 rightPixel = (xPlusOneInside && yInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 0))\n    : padingPixelValue;\n\n  vec4 topPixel = (xInside && yPlusOneInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 1))\n    : padingPixelValue;\n\n  vec4 rightTopPixel = (xPlusOneInside && yPlusOneInside)\n    ? histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 1))\n    : padingPixelValue;\n\n  if (channel == 0) {\n    outTexture = vec4(pixel.r, rightPixel.r, topPixel.r, rightTopPixel.r);\n  }\n  if (channel == 1) {\n    outTexture = vec4(pixel.g, rightPixel.g, topPixel.g, rightTopPixel.g);\n  }\n  if (channel == 2) {\n    outTexture = vec4(pixel.b, rightPixel.b, topPixel.b, rightTopPixel.b);\n  }\n  if (channel == 3) {\n    outTexture = vec4(pixel.a, rightPixel.a, topPixel.a, rightTopPixel.a);\n  }\n}\n",elementCount:c.width*c.height});let h;l.run({uniforms:{channel:Tn[i]||0,padingPixelValue:[0,0,0,0]}}),(o||1===u)&&(h=l.getData({packed:!0}));const p=2*u,v=Object(r.cloneTextureFrom)(n,{width:p,height:p,parameters:{[d]:f,[y]:f}}),m=l.getFramebuffer();return Object(r.copyToTexture)(m,v,{targetX:0,width:u,height:u}),{textureData:h,baseTexture:c,flatPyramidTexture:v}}function En(t,e){const{textureData:n,baseTexture:i,flatPyramidTexture:o}=_n(t,e),{width:a}=i,s=Math.log2(a)+1,u=[i];let c=n;if(s>1){for(let t=1;t<s;t++){const e=a/Math.pow(2,t);u.push(Object(r.cloneTextureFrom)(i,{width:e,height:e}))}const e=new r.Transform(t,{_sourceTextures:{inTexture:u[0]},_targetTexture:u[1],_targetTextureVarying:"outTexture",vs:wn+"attribute vec4 inTexture;\nvarying vec4 outTexture;\n\nvoid main()\n{\n  vec2 size = transform_uSize_outTexture;\n  vec2 scale = vec2(2., 2.);\n  vec4 pixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 0));\n  vec4 rightPixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 0));\n  vec4 bottomPixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(0, 1));\n  vec4 rightBottomPixel = histoPyramid_getInput(transform_uSampler_inTexture, size, scale, vec2(1, 1));\n  // outTexture = pixel + rightPixel + bottomPixel + rightBottomPixel;\n  outTexture = vec4(\n    pixel.r + pixel.g + pixel.b + pixel.a,\n    rightPixel.r + rightPixel.g + rightPixel.b + rightPixel.a,\n    bottomPixel.r + bottomPixel.g + bottomPixel.b + bottomPixel.a,\n    rightBottomPixel.r + rightBottomPixel.g + rightBottomPixel.b + rightBottomPixel.a\n  );\n}\n",elementCount:u[1].width*u[1].height});let n=a;for(let t=1;t<s;t++){const i=[u[t].width,u[t].height];e.update({_sourceTextures:{inTexture:u[t-1]},_targetTexture:u[t],elementCount:u[t].width*u[t].height}),e.run();const a=e.getFramebuffer();Object(r.copyToTexture)(a,o,{targetX:n,width:i[0],height:i[1]}),n+=i[0]}c=e.getData()}return{pyramidTextures:u,flatPyramidTexture:o,levelCount:s,topLevelData:c}}function Sn(t,e){const{flatPyramidTexture:n,levelCount:i,topLevelData:o}=En(t,e),a=o[0]+o[1]+o[2]+o[3],s=new r.Buffer(t,new Float32Array(a).map((t,e)=>e)),u=new r.Buffer(t,4*a*4);return new r.Transform(t,{sourceBuffers:{keyIndex:s},_sourceTextures:{flatPyramidTexture:n},feedbackBuffers:{locationAndIndex:u},varyings:["locationAndIndex"],vs:"// Check 2X2 texture block to find relative index the given key index falls into\n// 2X2 block is represented by a single RGBA weight\nint histopyramid_traversal_findRangeIndex(float currentKey, vec4 weights, out float lowerBound) {\n  lowerBound = 0.;\n  float higherBound = 0.;\n  int relativeIndex = 0;\n  for (int i = 0; i < 4; i++) {\n    higherBound = lowerBound + weights[i];\n    relativeIndex = i;\n    if (currentKey >= lowerBound && currentKey < higherBound) {\n      break;\n    }\n    lowerBound = higherBound;\n  }\n  return relativeIndex;\n}\n\n// Maps index in 2X2 block to texture coordiante\n// Assumes the traversal order of lower-left -> lower->right -> upper-left -> upper->right\nvec2 histopyramid_traversal_mapIndexToCoord(int index) {\n  // relativeIndex ->  relativeCoordiante\n  // 0 -> (0, 0)\n  // 1 -> (1, 0)\n  // 2 -> (0, 1)\n  // 3 -> (1, 1)\n  float relativeX = mod(float(index), 2.);\n  float relativeY = (index > 1) ? 1. : 0.;\n  return vec2(relativeX, relativeY);\n}\n\n// Reads weight value from flat histopyramid\nvec4 histopyramid_traversal_getWeight(sampler2D flatPyramid, vec2 size, int level, int numLevels, vec2 offset) {\n  // horizontal offset in flat pyramid for current level\n  float xOffset = pow(2., float(numLevels)) - pow(2., float(numLevels - level));\n  vec2 lowerLeft = vec2(xOffset, 0.);\n  vec2 pixelIndices = lowerLeft + offset;\n\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 coord = pixelIndices / size + pixelSizeHalf;\n\n  return texture2D(flatPyramid, coord);\n}\nattribute float keyIndex;\nattribute vec4 flatPyramidTexture;\nvarying vec4 locationAndIndex;\nconst int MAX_LEVELS = 12; // assuming max texture size of 4K\n\nuniform int numLevels;\n\nvoid main()\n{\n  vec2 p = vec2(0., 0.);\n  float currentKey = keyIndex;\n  // for(int level = numLevels - 1; level <= 0; level--) {\n  for(int i = 1; i <= MAX_LEVELS; i++) {\n    int level = numLevels - i;\n    // #1. Get the current pixel values based on current level and current p\n    vec4 weights = histopyramid_traversal_getWeight(transform_uSampler_flatPyramidTexture, transform_uSize_flatPyramidTexture, level, numLevels, p);\n\n    // #2. Check the all weights in current 2X2 (4 values in RGBA channels) and determine the relative coordinate\n    float lowerBound = 0.;\n    int relativeIndex = histopyramid_traversal_findRangeIndex(currentKey, weights, lowerBound);\n    vec2 relativeCoord = histopyramid_traversal_mapIndexToCoord(relativeIndex);\n\n    //#3. Update P and key-index\n    p = 2.0 * p + relativeCoord;\n    currentKey -= lowerBound;\n    if (level == 0) { break; } // Work around for const expression restriction on for loops\n  }\n  locationAndIndex = vec4(p, currentKey, keyIndex);\n}\n",elementCount:a}).run({uniforms:{numLevels:i}}),{locationAndIndexBuffer:u}}var Mn={name:"texture-filter",vs:"\nuniform vec4 textureFilter_uBoundingBox; //[xMin, yMin, xSize, ySize]\nuniform sampler2D textureFilter_uTexture;\nvec2 textureFilter_filter(vec2 position) {\n  vec2 filterValueIndex;\n  // Transfrom 'pos' to texture coordinate\n  vec2 pos = position - textureFilter_uBoundingBox.xy;\n  pos = pos / textureFilter_uBoundingBox.zw;\n  filterValueIndex.y = float(gl_VertexID);\n  if (pos.x < 0. || pos.x > 1. || pos.y < 0. || pos.y > 1.) {\n    filterValueIndex.x = -1.;\n  } else {\n    // Red channel is ID, Green channel inside/outside polygon\n    vec4 color = texture(textureFilter_uTexture, pos.xy);\n    filterValueIndex.x = color.g > 0. ? color.r : -1.;\n  }\n  return filterValueIndex;\n}\n",getUniforms:function(t={}){const e={};if(t.boundingBox){const[n,r,i,o]=t.boundingBox;e.textureFilter_uBoundingBox=[n,r,i-n,o-r]}return t.texture&&(e.textureFilter_uTexture=t.texture),e}};var On=n(8),Pn=n.n(On);const An=Math.PI/4,Ln=Math.PI/360;function Rn(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function In(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function Nn(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function jn(t,e,n,r){for(let i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function Bn(t,e,n,r){let i=e;const o=n.length;for(let e=0;e<o;e++)for(let o=0;o<r;o++)t[i++]=n[e][o]||0;if(!Nn(n))for(let e=0;e<r;e++)t[i++]=n[0][e]||0;return i}function Cn(t,e,n,r,i=0,o){const a=(o=o||n.length)-i;if(a<=0)return e;let s=e;for(let e=0;e<a;e++)t[s++]=n[i+e];if(!jn(n,r,i,o))for(let e=0;e<r;e++)t[s++]=n[i+e];return s}function Dn(t){return(Nn(t)?0:1)+t.length}function Fn(t,e,n=0,r){return n>=(r=r||t.length)?0:(jn(t,e,n,r)?0:1)+(r-n)/e}function zn(t,e,n=!0){if(!n)return(t=t.positions||t).length/e;if(Rn(t),t.positions){const{positions:n,holeIndices:r}=t;if(r){let n=0;for(let i=0;i<=r.length;i++)n+=Fn(t.positions,e,r[i-1],r[i]);return n}t=n}if(Number.isFinite(t[0]))return Fn(t,e);if(!In(t)){let e=0;for(const n of t)e+=Dn(n);return e}return Dn(t)}function Vn(t,e,n){Rn(t),n=n||zn(t,e);const r=new Float64Array(n*e),i=[];if(t.positions){const{positions:n,holeIndices:o}=t;if(o){let t=0;for(let a=0;a<=o.length;a++)t=Cn(r,t,n,e,o[a-1],o[a]),i.push(t);return i.pop(),{positions:r,holeIndices:i}}t=n}if(Number.isFinite(t[0]))return Cn(r,0,t,e),r;if(!In(t)){let n=0;for(const o of t)n=Bn(r,n,o,e),i.push(n);return i.pop(),{positions:r,holeIndices:i}}return Bn(r,0,t,e),r}function Un(t,e,n){let r=null;t.holeIndices&&(r=t.holeIndices.map(t=>t/e));let i=t.positions||t;if(n){const t=i.length;i=i.slice();for(let n=0;n<t;n+=e){const t=i[n+1];i[n+1]=Math.log(Math.tan(An+t*Ln))}}return Pn()(i,r,e)}class qn{constructor(t,e={}){this.gl=t,Object(r.assert)(Object(r.isWebGL2)(t)),this.textureSize=512,this._setupResources(),this.update(e)}update({polygons:t,textureSize:e}={}){if(e&&(this.textureSize=e),!t||0===t.length)return;const{vertices:n,indices:i,vertexCount:o,ids:a}=function(t){const e=[],n=[],i=[];let o=0,a=0;for(let r=0;r<t.length;r++){const s=Vn(t[r],2),u=s.positions||s,c=u.length/2,l=new Array(c).fill(a);e.push(...u),i.push(...l);const h=Un(s,2),f=h.length;for(let t=0;t<f;t++)h[t]+=o;o+=c,n.push(...h),a++}Object(r.assert)(o<65536);const s=zn(e,2);return{vertices:e,indices:n,ids:i,vertexCount:s}}(t);this._updateResources(n,i,a,o)}filter({positionBuffer:t,filterValueIndexBuffer:e,count:n}){this.filterTransform.update({sourceBuffers:{a_position:t},feedbackBuffers:{filterValueIndex:e},elementCount:n});const{polygonTexture:r,boundingBox:i}=this;this.filterTransform.run({moduleSettings:{boundingBox:i,texture:r}})}_setupResources(){const{gl:t}=this;this.polygonTexture=new r.Texture2D(t,{format:h,type:u,dataFormat:h,border:0,mipmaps:!1,parameters:{[d]:f,[y]:f,[m]:t.CLAMP_TO_EDGE,[x]:t.CLAMP_TO_EDGE}}),this.positionBuffer=new r.Buffer(t,{accessor:{type:l,size:2}}),this.idBuffer=new r.Buffer(t,{accessor:{type:l,size:1}}),this.indexBuffer=new r.Buffer(t,{target:s,accessor:{type:c}}),this.polyTextureTransform=new r.Transform(t,{id:"polygon-texture-creation-transform",elementCount:0,_targetTexture:this.polygonTexture,_targetTextureVarying:"v_polygonColor",vs:"uniform vec4 boundingBoxOriginSize; //[xMin, yMin, xSize, ySize]\nattribute vec2 a_position;\nattribute float a_polygonID;\nvarying vec4 v_polygonColor;\nvoid main()\n{\n    // translate from bbox to NDC\n    vec2 pos = a_position - boundingBoxOriginSize.xy;\n    pos = pos / boundingBoxOriginSize.zw;\n    pos = pos * 2.0 - vec2(1.0);\n    gl_Position = vec4(pos, 0.0, 1.0);\n    v_polygonColor = vec4(a_polygonID, 1.0, 1.0, 1.0);\n}\n",drawMode:a,isIndexed:!0,sourceBuffers:{a_position:this.positionBuffer,a_polygonID:this.idBuffer,indices:this.indexBuffer}}),this.filterTransform=new r.Transform(t,{id:"filter transform",vs:"#version 300 es\nin vec2 a_position;\nout vec2 filterValueIndex; //[x: 0 (outside polygon)/1 (inside), y: position index]\nvoid main()\n{\n  filterValueIndex = textureFilter_filter(a_position);\n}\n",modules:[Mn],varyings:["filterValueIndex"]})}_updateResources(t,e,n,r){const i=function(t,e){let n,r,i=1/0,o=-1/0,a=1/0,s=-1/0;for(let u=0;u<e;u++)r=t[2*u],n=t[2*u+1],i=n<i?n:i,o=n>o?n:o,a=r<a?r:a,s=r>s?r:s;return[a,i,s,o]}(t,r),[o,a,s,u]=i,c=s-o,l=u-a,h=c/l,{textureSize:f}=this;let p=f,v=f;h>1?v=p/h:p=v*h,this.boundingBox=i,this.polygonTexture.resize({width:p,height:v,mipmaps:!1}),this.positionBuffer.setData(new Float32Array(t)),this.idBuffer.setData(new Float32Array(n)),this.indexBuffer.setData(new Uint16Array(e)),this.polyTextureTransform.update({elementCount:e.length,_targetTexture:this.polygonTexture}),this.polyTextureTransform.run({uniforms:{boundingBoxOriginSize:[o,a,c,l]}})}}}])}));