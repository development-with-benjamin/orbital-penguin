!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=31)}([function(e,t,r){"use strict";t.a={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}},function(e,t,r){"use strict";r.d(t,"d",(function(){return i})),r.d(t,"e",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return u}));var n=r(4);function i(e){return"undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext||("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&Number.isFinite(e._version)))}function s(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}function a(e){return s(e)?e:null}function o(e){return Object(n.a)(i(e),"Invalid WebGLRenderingContext"),e}function u(e){return Object(n.a)(s(e),"Requires WebGL2"),e}},function(e,t,r){e.exports=r(34)},,function(e,t,r){"use strict";function n(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}r.d(t,"a",(function(){return n}))},,function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.d(t,"a",(function(){return n}))},function(e,t,r){"use strict";(function(e,n){r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return o}));var i=r(6),s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document,process:"object"===(void 0===n?"undefined":Object(i.a)(n))&&n},a=s.window||s.self||s.global,o=s.process||{};console}).call(this,r(14),r(11))},function(e,t,r){"use strict";r.d(t,"c",(function(){return s})),r.d(t,"e",(function(){return l})),r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return _})),r.d(t,"d",(function(){return d}));var n=r(0),i=r(1);const s={[n.a.BLEND]:!1,[n.a.BLEND_COLOR]:new Float32Array([0,0,0,0]),[n.a.BLEND_EQUATION_RGB]:n.a.FUNC_ADD,[n.a.BLEND_EQUATION_ALPHA]:n.a.FUNC_ADD,[n.a.BLEND_SRC_RGB]:n.a.ONE,[n.a.BLEND_DST_RGB]:n.a.ZERO,[n.a.BLEND_SRC_ALPHA]:n.a.ONE,[n.a.BLEND_DST_ALPHA]:n.a.ZERO,[n.a.COLOR_CLEAR_VALUE]:new Float32Array([0,0,0,0]),[n.a.COLOR_WRITEMASK]:[!0,!0,!0,!0],[n.a.CULL_FACE]:!1,[n.a.CULL_FACE_MODE]:n.a.BACK,[n.a.DEPTH_TEST]:!1,[n.a.DEPTH_CLEAR_VALUE]:1,[n.a.DEPTH_FUNC]:n.a.LESS,[n.a.DEPTH_RANGE]:new Float32Array([0,1]),[n.a.DEPTH_WRITEMASK]:!0,[n.a.DITHER]:!0,[n.a.FRAMEBUFFER_BINDING]:null,[n.a.FRONT_FACE]:n.a.CCW,[n.a.GENERATE_MIPMAP_HINT]:n.a.DONT_CARE,[n.a.LINE_WIDTH]:1,[n.a.POLYGON_OFFSET_FILL]:!1,[n.a.POLYGON_OFFSET_FACTOR]:0,[n.a.POLYGON_OFFSET_UNITS]:0,[n.a.SAMPLE_COVERAGE_VALUE]:1,[n.a.SAMPLE_COVERAGE_INVERT]:!1,[n.a.SCISSOR_TEST]:!1,[n.a.SCISSOR_BOX]:new Int32Array([0,0,1024,1024]),[n.a.STENCIL_TEST]:!1,[n.a.STENCIL_CLEAR_VALUE]:0,[n.a.STENCIL_WRITEMASK]:4294967295,[n.a.STENCIL_BACK_WRITEMASK]:4294967295,[n.a.STENCIL_FUNC]:n.a.ALWAYS,[n.a.STENCIL_REF]:0,[n.a.STENCIL_VALUE_MASK]:4294967295,[n.a.STENCIL_BACK_FUNC]:n.a.ALWAYS,[n.a.STENCIL_BACK_REF]:0,[n.a.STENCIL_BACK_VALUE_MASK]:4294967295,[n.a.STENCIL_FAIL]:n.a.KEEP,[n.a.STENCIL_PASS_DEPTH_FAIL]:n.a.KEEP,[n.a.STENCIL_PASS_DEPTH_PASS]:n.a.KEEP,[n.a.STENCIL_BACK_FAIL]:n.a.KEEP,[n.a.STENCIL_BACK_PASS_DEPTH_FAIL]:n.a.KEEP,[n.a.STENCIL_BACK_PASS_DEPTH_PASS]:n.a.KEEP,[n.a.VIEWPORT]:[0,0,1024,1024],[n.a.PACK_ALIGNMENT]:4,[n.a.UNPACK_ALIGNMENT]:4,[n.a.UNPACK_FLIP_Y_WEBGL]:!1,[n.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:!1,[n.a.UNPACK_COLORSPACE_CONVERSION_WEBGL]:n.a.BROWSER_DEFAULT_WEBGL,[n.a.FRAGMENT_SHADER_DERIVATIVE_HINT]:n.a.DONT_CARE,[n.a.READ_FRAMEBUFFER_BINDING]:null,[n.a.RASTERIZER_DISCARD]:!1,[n.a.PACK_ROW_LENGTH]:0,[n.a.PACK_SKIP_PIXELS]:0,[n.a.PACK_SKIP_ROWS]:0,[n.a.UNPACK_ROW_LENGTH]:0,[n.a.UNPACK_IMAGE_HEIGHT]:0,[n.a.UNPACK_SKIP_PIXELS]:0,[n.a.UNPACK_SKIP_ROWS]:0,[n.a.UNPACK_SKIP_IMAGES]:0},a=(e,t,r)=>t?e.enable(r):e.disable(r),o=(e,t,r)=>e.hint(r,t),u=(e,t,r)=>e.pixelStorei(r,t);function c(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const l={[n.a.BLEND]:a,[n.a.BLEND_COLOR]:(e,t)=>e.blendColor(...t),[n.a.BLEND_EQUATION_RGB]:"blendEquation",[n.a.BLEND_EQUATION_ALPHA]:"blendEquation",[n.a.BLEND_SRC_RGB]:"blendFunc",[n.a.BLEND_DST_RGB]:"blendFunc",[n.a.BLEND_SRC_ALPHA]:"blendFunc",[n.a.BLEND_DST_ALPHA]:"blendFunc",[n.a.COLOR_CLEAR_VALUE]:(e,t)=>e.clearColor(...t),[n.a.COLOR_WRITEMASK]:(e,t)=>e.colorMask(...t),[n.a.CULL_FACE]:a,[n.a.CULL_FACE_MODE]:(e,t)=>e.cullFace(t),[n.a.DEPTH_TEST]:a,[n.a.DEPTH_CLEAR_VALUE]:(e,t)=>e.clearDepth(t),[n.a.DEPTH_FUNC]:(e,t)=>e.depthFunc(t),[n.a.DEPTH_RANGE]:(e,t)=>e.depthRange(...t),[n.a.DEPTH_WRITEMASK]:(e,t)=>e.depthMask(t),[n.a.DITHER]:a,[n.a.FRAGMENT_SHADER_DERIVATIVE_HINT]:o,[n.a.FRAMEBUFFER_BINDING]:(e,t)=>{const r=Object(i.e)(e)?n.a.DRAW_FRAMEBUFFER:n.a.FRAMEBUFFER;return e.bindFramebuffer(r,t)},[n.a.FRONT_FACE]:(e,t)=>e.frontFace(t),[n.a.GENERATE_MIPMAP_HINT]:o,[n.a.LINE_WIDTH]:(e,t)=>e.lineWidth(t),[n.a.POLYGON_OFFSET_FILL]:a,[n.a.POLYGON_OFFSET_FACTOR]:"polygonOffset",[n.a.POLYGON_OFFSET_UNITS]:"polygonOffset",[n.a.RASTERIZER_DISCARD]:a,[n.a.SAMPLE_COVERAGE_VALUE]:"sampleCoverage",[n.a.SAMPLE_COVERAGE_INVERT]:"sampleCoverage",[n.a.SCISSOR_TEST]:a,[n.a.SCISSOR_BOX]:(e,t)=>e.scissor(...t),[n.a.STENCIL_TEST]:a,[n.a.STENCIL_CLEAR_VALUE]:(e,t)=>e.clearStencil(t),[n.a.STENCIL_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(n.a.FRONT,t),[n.a.STENCIL_BACK_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(n.a.BACK,t),[n.a.STENCIL_FUNC]:"stencilFuncFront",[n.a.STENCIL_REF]:"stencilFuncFront",[n.a.STENCIL_VALUE_MASK]:"stencilFuncFront",[n.a.STENCIL_BACK_FUNC]:"stencilFuncBack",[n.a.STENCIL_BACK_REF]:"stencilFuncBack",[n.a.STENCIL_BACK_VALUE_MASK]:"stencilFuncBack",[n.a.STENCIL_FAIL]:"stencilOpFront",[n.a.STENCIL_PASS_DEPTH_FAIL]:"stencilOpFront",[n.a.STENCIL_PASS_DEPTH_PASS]:"stencilOpFront",[n.a.STENCIL_BACK_FAIL]:"stencilOpBack",[n.a.STENCIL_BACK_PASS_DEPTH_FAIL]:"stencilOpBack",[n.a.STENCIL_BACK_PASS_DEPTH_PASS]:"stencilOpBack",[n.a.VIEWPORT]:(e,t)=>e.viewport(...t),[n.a.PACK_ALIGNMENT]:u,[n.a.UNPACK_ALIGNMENT]:u,[n.a.UNPACK_FLIP_Y_WEBGL]:u,[n.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:u,[n.a.UNPACK_COLORSPACE_CONVERSION_WEBGL]:u,[n.a.PACK_ROW_LENGTH]:u,[n.a.PACK_SKIP_PIXELS]:u,[n.a.PACK_SKIP_ROWS]:u,[n.a.READ_FRAMEBUFFER_BINDING]:(e,t)=>e.bindFramebuffer(n.a.READ_FRAMEBUFFER,t),[n.a.UNPACK_ROW_LENGTH]:u,[n.a.UNPACK_IMAGE_HEIGHT]:u,[n.a.UNPACK_SKIP_PIXELS]:u,[n.a.UNPACK_SKIP_ROWS]:u,[n.a.UNPACK_SKIP_IMAGES]:u,framebuffer:(e,t)=>{const r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(n.a.FRAMEBUFFER,r)},blend:(e,t)=>t?e.enable(n.a.BLEND):e.disable(n.a.BLEND),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{t=c(t)?t:[t,t],e.blendEquationSeparate(...t)},blendFunc:(e,t)=>{t=c(t)&&2===t.length?[...t,...t]:t,e.blendFuncSeparate(...t)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(n.a.CULL_FACE):e.disable(n.a.CULL_FACE),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(n.a.DEPTH_TEST):e.disable(n.a.DEPTH_TEST),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(n.a.DITHER):e.disable(n.a.DITHER),derivativeHint:(e,t)=>{e.hint(n.a.FRAGMENT_SHADER_DERIVATIVE_HINT,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(n.a.GENERATE_MIPMAP_HINT,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(n.a.POLYGON_OFFSET_FILL):e.disable(n.a.POLYGON_OFFSET_FILL),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(n.a.SCISSOR_TEST):e.disable(n.a.SCISSOR_TEST),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(n.a.STENCIL_TEST):e.disable(n.a.STENCIL_TEST),stencilMask:(e,t)=>{t=c(t)?t:[t,t];const[r,i]=t;e.stencilMaskSeparate(n.a.FRONT,r),e.stencilMaskSeparate(n.a.BACK,i)},stencilFunc:(e,t)=>{t=c(t)&&3===t.length?[...t,...t]:t;const[r,i,s,a,o,u]=t;e.stencilFuncSeparate(n.a.FRONT,r,i,s),e.stencilFuncSeparate(n.a.BACK,a,o,u)},stencilOp:(e,t)=>{t=c(t)&&3===t.length?[...t,...t]:t;const[r,i,s,a,o,u]=t;e.stencilOpSeparate(n.a.FRONT,r,i,s),e.stencilOpSeparate(n.a.BACK,a,o,u)},viewport:(e,t)=>e.viewport(...t)};function h(e,t,r){return void 0!==t[e]?t[e]:r[e]}const f={blendEquation:(e,t,r)=>e.blendEquationSeparate(h(n.a.BLEND_EQUATION_RGB,t,r),h(n.a.BLEND_EQUATION_ALPHA,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(h(n.a.BLEND_SRC_RGB,t,r),h(n.a.BLEND_DST_RGB,t,r),h(n.a.BLEND_SRC_ALPHA,t,r),h(n.a.BLEND_DST_ALPHA,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(h(n.a.POLYGON_OFFSET_FACTOR,t,r),h(n.a.POLYGON_OFFSET_UNITS,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(h(n.a.SAMPLE_COVERAGE_VALUE,t,r),h(n.a.SAMPLE_COVERAGE_INVERT,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(n.a.FRONT,h(n.a.STENCIL_FUNC,t,r),h(n.a.STENCIL_REF,t,r),h(n.a.STENCIL_VALUE_MASK,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(n.a.BACK,h(n.a.STENCIL_BACK_FUNC,t,r),h(n.a.STENCIL_BACK_REF,t,r),h(n.a.STENCIL_BACK_VALUE_MASK,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(n.a.FRONT,h(n.a.STENCIL_FAIL,t,r),h(n.a.STENCIL_PASS_DEPTH_FAIL,t,r),h(n.a.STENCIL_PASS_DEPTH_PASS,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(n.a.BACK,h(n.a.STENCIL_BACK_FAIL,t,r),h(n.a.STENCIL_BACK_PASS_DEPTH_FAIL,t,r),h(n.a.STENCIL_BACK_PASS_DEPTH_PASS,t,r))},_={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),bindFramebuffer:(e,t,r)=>{switch(t){case n.a.FRAMEBUFFER:return e({[n.a.DRAW_FRAMEBUFFER_BINDING]:r,[n.a.READ_FRAMEBUFFER_BINDING]:r});case n.a.DRAW_FRAMEBUFFER:return e({[n.a.DRAW_FRAMEBUFFER_BINDING]:r});case n.a.READ_FRAMEBUFFER:return e({[n.a.READ_FRAMEBUFFER_BINDING]:r});default:return null}},blendColor:(e,t,r,i,s)=>e({[n.a.BLEND_COLOR]:new Float32Array([t,r,i,s])}),blendEquation:(e,t)=>e({[n.a.BLEND_EQUATION_RGB]:t,[n.a.BLEND_EQUATION_ALPHA]:t}),blendEquationSeparate:(e,t,r)=>e({[n.a.BLEND_EQUATION_RGB]:t,[n.a.BLEND_EQUATION_ALPHA]:r}),blendFunc:(e,t,r)=>e({[n.a.BLEND_SRC_RGB]:t,[n.a.BLEND_DST_RGB]:r,[n.a.BLEND_SRC_ALPHA]:t,[n.a.BLEND_DST_ALPHA]:r}),blendFuncSeparate:(e,t,r,i,s)=>e({[n.a.BLEND_SRC_RGB]:t,[n.a.BLEND_DST_RGB]:r,[n.a.BLEND_SRC_ALPHA]:i,[n.a.BLEND_DST_ALPHA]:s}),clearColor:(e,t,r,i,s)=>e({[n.a.COLOR_CLEAR_VALUE]:new Float32Array([t,r,i,s])}),clearDepth:(e,t)=>e({[n.a.DEPTH_CLEAR_VALUE]:t}),clearStencil:(e,t)=>e({[n.a.STENCIL_CLEAR_VALUE]:t}),colorMask:(e,t,r,i,s)=>e({[n.a.COLOR_WRITEMASK]:[t,r,i,s]}),cullFace:(e,t)=>e({[n.a.CULL_FACE_MODE]:t}),depthFunc:(e,t)=>e({[n.a.DEPTH_FUNC]:t}),depthRange:(e,t,r)=>e({[n.a.DEPTH_RANGE]:new Float32Array([t,r])}),depthMask:(e,t)=>e({[n.a.DEPTH_WRITEMASK]:t}),frontFace:(e,t)=>e({[n.a.FRONT_FACE]:t}),lineWidth:(e,t)=>e({[n.a.LINE_WIDTH]:t}),polygonOffset:(e,t,r)=>e({[n.a.POLYGON_OFFSET_FACTOR]:t,[n.a.POLYGON_OFFSET_UNITS]:r}),sampleCoverage:(e,t,r)=>e({[n.a.SAMPLE_COVERAGE_VALUE]:t,[n.a.SAMPLE_COVERAGE_INVERT]:r}),scissor:(e,t,r,i,s)=>e({[n.a.SCISSOR_BOX]:new Int32Array([t,r,i,s])}),stencilMask:(e,t)=>e({[n.a.STENCIL_WRITEMASK]:t,[n.a.STENCIL_BACK_WRITEMASK]:t}),stencilMaskSeparate:(e,t,r)=>e({[t===n.a.FRONT?n.a.STENCIL_WRITEMASK:n.a.STENCIL_BACK_WRITEMASK]:r}),stencilFunc:(e,t,r,i)=>e({[n.a.STENCIL_FUNC]:t,[n.a.STENCIL_REF]:r,[n.a.STENCIL_VALUE_MASK]:i,[n.a.STENCIL_BACK_FUNC]:t,[n.a.STENCIL_BACK_REF]:r,[n.a.STENCIL_BACK_VALUE_MASK]:i}),stencilFuncSeparate:(e,t,r,i,s)=>e({[t===n.a.FRONT?n.a.STENCIL_FUNC:n.a.STENCIL_BACK_FUNC]:r,[t===n.a.FRONT?n.a.STENCIL_REF:n.a.STENCIL_BACK_REF]:i,[t===n.a.FRONT?n.a.STENCIL_VALUE_MASK:n.a.STENCIL_BACK_VALUE_MASK]:s}),stencilOp:(e,t,r,i)=>e({[n.a.STENCIL_FAIL]:t,[n.a.STENCIL_PASS_DEPTH_FAIL]:r,[n.a.STENCIL_PASS_DEPTH_PASS]:i,[n.a.STENCIL_BACK_FAIL]:t,[n.a.STENCIL_BACK_PASS_DEPTH_FAIL]:r,[n.a.STENCIL_BACK_PASS_DEPTH_PASS]:i}),stencilOpSeparate:(e,t,r,i,s)=>e({[t===n.a.FRONT?n.a.STENCIL_FAIL:n.a.STENCIL_BACK_FAIL]:r,[t===n.a.FRONT?n.a.STENCIL_PASS_DEPTH_FAIL:n.a.STENCIL_BACK_PASS_DEPTH_FAIL]:i,[t===n.a.FRONT?n.a.STENCIL_PASS_DEPTH_PASS:n.a.STENCIL_BACK_PASS_DEPTH_PASS]:s}),viewport:(e,t,r,i,s)=>e({[n.a.VIEWPORT]:[t,r,i,s]})},E=(e,t)=>e.isEnabled(t),d={[n.a.BLEND]:E,[n.a.CULL_FACE]:E,[n.a.DEPTH_TEST]:E,[n.a.DITHER]:E,[n.a.POLYGON_OFFSET_FILL]:E,[n.a.SAMPLE_ALPHA_TO_COVERAGE]:E,[n.a.SAMPLE_COVERAGE]:E,[n.a.SCISSOR_TEST]:E,[n.a.STENCIL_TEST]:E,[n.a.RASTERIZER_DISCARD]:E}},function(e,t,r){"use strict";(function(e){r.d(t,"c",(function(){return l})),r.d(t,"b",(function(){return h})),r.d(t,"a",(function(){return f}));var n=r(8),i=r(10),s=r(4),a=r(18);function o(e,t){const r=e[t].bind(e);e[t]=function(...t){const n=t[0];return n in e.state.cache||(e.state.cache[n]=r(...t)),e.state.enable?e.state.cache[n]:r(...t)},Object.defineProperty(e[t],"name",{value:t+"-from-cache",configurable:!1})}function u(e,t,r){const n=e[t].bind(e);e[t]=function(...t){const{valueChanged:i,oldValue:s}=r(e.state._updateCache,...t);return i&&n(...t),s},Object.defineProperty(e[t],"name",{value:t+"-to-cache",configurable:!1})}class c{constructor(e,{copyState:t=!1,log:r=(()=>{})}={}){this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?Object(i.a)(e):Object.assign({},n.c),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){Object(s.a)(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Object(i.c)(this.gl,e),this.stateStack.pop()}_updateCache(e){let t,r=!1;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const i in e){Object(s.a)(void 0!==i);const o=e[i],u=this.cache[i];Object(a.a)(o,u)||(r=!0,t=u,n&&!(i in n)&&(n[i]=u),this.cache[i]=o)}return{valueChanged:r,oldValue:t}}}function l(t,r={}){const{enable:i=!0,copyState:a}=r;if(Object(s.a)(void 0!==a),!t.state){const r=void 0!==e?e:window,{polyfillContext:i}=r;i&&i(t),t.state=new c(t,{copyState:a}),function(e){const t=e.useProgram.bind(e);e.useProgram=function(r){e.state.program!==r&&(t(r),e.state.program=r)}}(t);for(const e in n.b){u(t,e,n.b[e])}o(t,"getParameter"),o(t,"isEnabled")}return t.state.enable=i,t}function h(e){e.state||l(e,{copyState:!1}),e.state.push()}function f(e){Object(s.a)(e.state),e.state.pop()}}).call(this,r(14))},function(e,t,r){"use strict";r.d(t,"c",(function(){return u})),r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l})),r.d(t,"d",(function(){return h}));var n=r(8),i=r(9),s=r(4),a=r(1),o=r(18);function u(e,t){if(Object(s.a)(Object(a.d)(e),"setParameters requires a WebGL context"),Object(o.b)(t))return;const r={};for(const i in t){const s=Number(i),a=n.e[i];a&&("string"==typeof a?r[a]=!0:a(e,t[i],s))}const i=e.state&&e.state.cache;if(i)for(const s in r){(0,n.a[s])(e,t,i)}}function c(e,t){if("number"==typeof(t=t||n.c)){const r=t,i=n.d[r];return i?i(e,r):e.getParameter(r)}const r=Array.isArray(t)?t:Object.keys(t),i={};for(const t of r){const r=n.d[t];i[t]=r?r(e,Number(t)):e.getParameter(Number(t))}return i}function l(e){u(e,n.c)}function h(e,t,r){if(Object(o.b)(t))return r(e);const{nocatch:n=!0}=t;let s;if(Object(i.b)(e),u(e,t),n)s=r(e),Object(i.a)(e);else try{s=r(e)}finally{Object(i.a)(e)}return s}},function(e,t){var r,n,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,c=[],l=!1,h=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&_())}function _(){if(!l){var e=o(f);l=!0;for(var t=c.length;t;){for(u=c,c=[];++h<t;)u&&u[h].run();h=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function E(e,t){this.fun=e,this.array=t}function d(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new E(e,t)),1!==c.length||l||o(_)},E.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=d,i.addListener=d,i.once=d,i.off=d,i.removeListener=d,i.removeAllListeners=d,i.emit=d,i.prependListener=d,i.prependOnceListener=d,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},,function(e,t,r){"use strict";r.d(t,"b",(function(){return u})),r.d(t,"a",(function(){return c}));var n=r(0),i=r(4),s=r(1);const a=e=>Object(s.e)(e)?void 0:0,o={[n.a.READ_BUFFER]:e=>Object(s.e)(e)?void 0:n.a.COLOR_ATTACHMENT0,35723:e=>Object(s.e)(e)?void 0:4352,[n.a.RASTERIZER_DISCARD]:a,[n.a.SAMPLES]:a,36795:(e,t)=>{const r=Object(s.e)(e)?e.getExtension("EXT_disjoint_timer_query_webgl2"):e.getExtension("EXT_disjoint_timer_query");return r&&r.GPU_DISJOINT_EXT?t(r.GPU_DISJOINT_EXT):0},37445:(e,t)=>{const r=e.getExtension("WEBGL_debug_renderer_info");return t(r&&r.UNMASKED_VENDOR_WEBGL||n.a.VENDOR)},37446:(e,t)=>{const r=e.getExtension("WEBGL_debug_renderer_info");return t(r&&r.UNMASKED_RENDERER_WEBGL||n.a.RENDERER)},34047:(e,t)=>{const r=e.luma.extensions.EXT_texture_filter_anisotropic;return r?t(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[n.a.MAX_3D_TEXTURE_SIZE]:a,[n.a.MAX_ARRAY_TEXTURE_LAYERS]:a,[n.a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]:a,[n.a.MAX_COLOR_ATTACHMENTS]:(e,t)=>{if(!Object(s.e)(e)){const r=e.getExtension("WEBGL_draw_buffers");return r?t(r.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[n.a.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]:a,[n.a.MAX_COMBINED_UNIFORM_BLOCKS]:a,[n.a.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]:a,[n.a.MAX_DRAW_BUFFERS]:e=>{if(!Object(s.e)(e)){const t=e.getExtension("WEBGL_draw_buffers");return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},[n.a.MAX_ELEMENT_INDEX]:e=>e.getExtension("OES_element_index")?2147483647:65535,[n.a.MAX_ELEMENTS_INDICES]:e=>e.getExtension("OES_element_index")?16777216:65535,[n.a.MAX_ELEMENTS_VERTICES]:e=>16777216,[n.a.MAX_FRAGMENT_INPUT_COMPONENTS]:a,[n.a.MAX_FRAGMENT_UNIFORM_BLOCKS]:a,[n.a.MAX_FRAGMENT_UNIFORM_COMPONENTS]:a,[n.a.MAX_SAMPLES]:a,[n.a.MAX_SERVER_WAIT_TIMEOUT]:a,[n.a.MAX_TEXTURE_LOD_BIAS]:a,[n.a.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]:a,[n.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]:a,[n.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]:a,[n.a.MAX_UNIFORM_BLOCK_SIZE]:a,[n.a.MAX_UNIFORM_BUFFER_BINDINGS]:a,[n.a.MAX_VARYING_COMPONENTS]:a,[n.a.MAX_VERTEX_OUTPUT_COMPONENTS]:a,[n.a.MAX_VERTEX_UNIFORM_BLOCKS]:a,[n.a.MAX_VERTEX_UNIFORM_COMPONENTS]:a,[n.a.MIN_PROGRAM_TEXEL_OFFSET]:a,[n.a.MAX_PROGRAM_TEXEL_OFFSET]:a,[n.a.UNIFORM_BUFFER_OFFSET_ALIGNMENT]:a};const u={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{Object(i.a)(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},ANGLE_instanced_arrays:{meta:{suffix:"ANGLE"},vertexAttribDivisor(e,t){Object(i.a)(0===t,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Object(i.a)(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{Object(i.a)(!1)},deleteQuery:()=>{Object(i.a)(!1)},beginQuery:()=>{Object(i.a)(!1)},endQuery:()=>{},getQuery(e,t){return this.getQueryObject(e,t)},getQueryParameter(e,t){return this.getQueryObject(e,t)},getQueryObject:()=>{}}},c={readBuffer:(e,t,r)=>{Object(s.e)(e)&&t(r)},getVertexAttrib:(e,t,r,i)=>{const{webgl2:a,ext:o}=function(e,t){return{webgl2:Object(s.e)(e),ext:e.getExtension(t)}}(e,"ANGLE_instanced_arrays");let u;switch(i){case n.a.VERTEX_ATTRIB_ARRAY_INTEGER:u=!!a&&void 0;break;case n.a.VERTEX_ATTRIB_ARRAY_DIVISOR:u=a||o?void 0:0}return void 0!==u?u:t(r,i)},getProgramParameter:(e,t,r,i)=>{if(!Object(s.e)(e))switch(i){case n.a.TRANSFORM_FEEDBACK_BUFFER_MODE:return n.a.SEPARATE_ATTRIBS;case n.a.TRANSFORM_FEEDBACK_VARYINGS:case n.a.ACTIVE_UNIFORM_BLOCKS:return 0}return t(r,i)},getInternalformatParameter:(e,t,r,i,a)=>{if(!Object(s.e)(e))switch(a){case n.a.SAMPLES:return new Int32Array([0])}return e.getInternalformatParameter(r,i,a)},getTexParameter(e,t,r,i){switch(i){case n.a.TEXTURE_MAX_ANISOTROPY_EXT:const{extensions:t}=e.luma,r=t.EXT_texture_filter_anisotropic;i=r&&r.TEXTURE_MAX_ANISOTROPY_EXT||n.a.TEXTURE_MAX_ANISOTROPY_EXT}return t(r,i)},getParameter:function(e,t,r){const n=o[r],i="function"==typeof n?n(e,t,r):n;return void 0!==i?i:t(r)},hint:(e,t,r,n)=>t(r,n)}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";(function(e){function n(){var t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if(void 0!==e&&e.hrtime){var r=e.hrtime();t=1e3*r[0]+r[1]/1e6}else t=Date.now();return t}r.d(t,"a",(function(){return n}))}).call(this,r(11))},function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,"a",(function(){return n}))},function(e,t,r){"use strict";function n(e){for(const t in e)return!1;return!0}function i(e,t){if(e===t)return!0;const r=Array.isArray(e)||ArrayBuffer.isView(e),n=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&n&&e.length===t.length){for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}return!1}r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return i}))},,function(e,t){function r(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=r=function(e){return typeof e}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(t)}e.exports=r},function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return s}));var n=r(6),i=r(22);function s(){return!("object"===(void 0===e?"undefined":Object(n.a)(e))&&"[object process]"===String(e)&&!e.browser)||Object(i.a)()}}).call(this,r(11))},function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return i}));var n=r(6);function i(t){if("undefined"!=typeof window&&"object"===Object(n.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==e&&"object"===Object(n.a)(e.versions)&&Boolean(e.versions.electron))return!0;var r="object"===("undefined"==typeof navigator?"undefined":Object(n.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,i=t||r;return!!(i&&i.indexOf("Electron")>=0)}}).call(this,r(11))},,function(e,t,r){"use strict";(function(e){var n=r(15);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){if("undefined"!=typeof window&&"object"===(0,i.default)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==e&&"object"===(0,i.default)(e.versions)&&Boolean(e.versions.electron))return!0;var r="object"===("undefined"==typeof navigator?"undefined":(0,i.default)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=t||r;if(n&&n.indexOf("Electron")>=0)return!0;return!1};var i=n(r(20))}).call(this,r(11))},,function(e,t,r){"use strict";(function(e){var t=r(30),n=r(4),i=r(13);function s(e,{extension:t,target:r,target2:s}){const a=i.b[t];Object(n.a)(a);const{meta:o={}}=a,{suffix:u=""}=o,c=e.getExtension(t);for(const t of Object.keys(a)){const n=`${t}${u}`;let i=null;"meta"===t||"function"==typeof e[t]||(c&&"function"==typeof c[n]?i=(...e)=>c[n](...e):"function"==typeof a[t]&&(i=a[t].bind(r))),i&&(r[t]=i,s[t]=i)}}(void 0!==e?e:window).polyfillContext=function(e){e.luma=e.luma||{};const{luma:r}=e;return r.polyfilled||(Object(t.a)(e),function(e){e.luma.extensions={};const t=e.getSupportedExtensions()||[];for(const r of t)e.luma[r]=e.getExtension(r)}(e),function(e,t){for(const r of Object.getOwnPropertyNames(t))"overrides"!==r&&s(e,{extension:r,target:e.luma,target2:e})}(e,i.b),function(e,{target:t,target2:r}){Object.keys(i.a).forEach(n=>{if("function"==typeof i.a[n]){const s=e[n]?e[n].bind(e):()=>{},a=i.a[n].bind(null,e,s);t[n]=a,r[n]=a}})}(e,{target:r,target2:e}),r.polyfilled=!0),e}}).call(this,r(14))},function(e,t,r){"use strict";(function(e,n){var i=r(15);Object.defineProperty(t,"__esModule",{value:!0}),t.console=t.process=t.document=t.global=t.window=t.self=void 0;var s=i(r(20)),a={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document,process:"object"===(void 0===n?"undefined":(0,s.default)(n))&&n},o=a.self||a.window||a.global;t.self=o;var u=a.window||a.self||a.global;t.window=u;var c=a.global||a.self||a.window;t.global=c;var l=a.document||{};t.document=l;var h=a.process||{};t.process=h;var f=console;t.console=f}).call(this,r(14),r(11))},function(e,t,r){"use strict";(function(e){var n=r(15);Object.defineProperty(t,"__esModule",{value:!0}),t.default=a,t.isBrowserMainThread=function(){return a()&&"undefined"!=typeof document};var i=n(r(20)),s=n(r(24));function a(){return!("object"===(void 0===e?"undefined":(0,i.default)(e))&&"[object process]"===String(e)&&!e.browser)||(0,s.default)()}}).call(this,r(11))},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(17);function i(e,t){if(e){if("string"==typeof e)return Object(n.a)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Object(n.a)(e,t):void 0}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n=r(2);const i={};function s(e,t){var r;i[e]=!0,void 0!==t&&(r=t,n.global.console&&n.global.console.error&&n.global.console.error(r))}const a=function e(t){const r=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let t=0;t<this.attribs.length;t++){const n=new e.VertexAttrib(r);this.attribs[t]=n}this.maxAttrib=0};(a.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=e.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const o=function(e){const t=this;this.gl=e,function(e){const t=e.getError;e.getError=function(){let r;do{r=t.apply(e),r!==e.NO_ERROR&&(i[r]=!0)}while(r!==e.NO_ERROR);for(r in i)if(i[r])return delete i[r],parseInt(r,10);return e.NO_ERROR}}(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(e){return e===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(e){const n=t.currentVertexArrayObject;n.maxAttrib=Math.max(n.maxAttrib,e);const i=n.attribs[e];return i.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(e){const n=t.currentVertexArrayObject;n.maxAttrib=Math.max(n.maxAttrib,e);const i=n.attribs[e];return i.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(n,i){switch(n){case e.ARRAY_BUFFER:t.currentArrayBuffer=i;break;case e.ELEMENT_ARRAY_BUFFER:t.currentVertexArrayObject.elementArrayBuffer=i}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(n,i){const s=t.currentVertexArrayObject,a=s.attribs[n];switch(i){case e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return a.buffer;case e.VERTEX_ATTRIB_ARRAY_ENABLED:return a.enabled;case e.VERTEX_ATTRIB_ARRAY_SIZE:return a.size;case e.VERTEX_ATTRIB_ARRAY_STRIDE:return a.stride;case e.VERTEX_ATTRIB_ARRAY_TYPE:return a.type;case e.VERTEX_ATTRIB_ARRAY_NORMALIZED:return a.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(e,n,i,s,a,o){const u=t.currentVertexArrayObject;u.maxAttrib=Math.max(u.maxAttrib,e);const c=u.attribs[e];return c.buffer=t.currentArrayBuffer,c.size=n,c.type=i,c.normalized=s,c.stride=a,c.offset=o,c.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{var e;e="OESVertexArrayObject emulation library context restored",n.global.console&&n.global.console.log&&n.global.console.log(e),t.reset_()},!0),this.reset_()};function u(e){if("function"==typeof e.createVertexArray)return;const t=e.getSupportedExtensions;e.getSupportedExtensions=function(){const e=t.call(this)||[];return e.indexOf("OES_vertex_array_object")<0&&e.push("OES_vertex_array_object"),e};const r=e.getExtension;e.getExtension=function(t){const n=r.call(this,t);return n||("OES_vertex_array_object"!==t?null:(e.__OESVertexArrayObject||(this.__OESVertexArrayObject=new o(this)),this.__OESVertexArrayObject))}}o.prototype.VERTEX_ARRAY_BINDING_OES=34229,o.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new a(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},o.prototype.createVertexArrayOES=function(){const e=new a(this);return this.vertexArrayObjects.push(e),e},o.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},o.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof a&&e.hasBeenBound&&e.ext===this)},o.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive)return void s(t.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject");const r=this.original,n=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const i=this.currentVertexArrayObject;if(n===i)return;n&&i.elementArrayBuffer===n.elementArrayBuffer||r.bindBuffer.call(t,t.ELEMENT_ARRAY_BUFFER,i.elementArrayBuffer);let a=this.currentArrayBuffer;const o=Math.max(n?n.maxAttrib:0,i.maxAttrib);for(let e=0;e<=o;e++){const s=i.attribs[e],o=n?n.attribs[e]:null;if(n&&s.enabled===o.enabled||(s.enabled?r.enableVertexAttribArray.call(t,e):r.disableVertexAttribArray.call(t,e)),s.enabled){let i=!1;n&&s.buffer===o.buffer||(a!==s.buffer&&(r.bindBuffer.call(t,t.ARRAY_BUFFER,s.buffer),a=s.buffer),i=!0),(i||s.cached!==o.cached)&&r.vertexAttribPointer.call(t,e,s.size,s.type,s.normalized,s.stride,s.offset)}}this.currentArrayBuffer!==a&&r.bindBuffer.call(t,t.ARRAY_BUFFER,this.currentArrayBuffer)}},function(e,t,r){(function(t){const n=r(37),i="undefined"==typeof window?t:window;i.luma=i.luma||{},e.exports=Object.assign(i.luma,n)}).call(this,r(14))},,function(e,t){},function(e,t,r){"use strict";var n=r(15),i=r(35);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"self",{enumerable:!0,get:function(){return s.self}}),Object.defineProperty(t,"window",{enumerable:!0,get:function(){return s.window}}),Object.defineProperty(t,"global",{enumerable:!0,get:function(){return s.global}}),Object.defineProperty(t,"document",{enumerable:!0,get:function(){return s.document}}),Object.defineProperty(t,"process",{enumerable:!0,get:function(){return s.process}}),Object.defineProperty(t,"console",{enumerable:!0,get:function(){return s.console}}),Object.defineProperty(t,"isBrowser",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"isBrowserMainThread",{enumerable:!0,get:function(){return a.isBrowserMainThread}}),Object.defineProperty(t,"getBrowser",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"isMobile",{enumerable:!0,get:function(){return o.isMobile}}),Object.defineProperty(t,"isElectron",{enumerable:!0,get:function(){return u.default}});var s=r(27),a=i(r(28)),o=i(r(36)),u=n(r(24))},function(e,t,r){var n=r(20);function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}e.exports=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,t&&t.set(e,r),r}},function(e,t,r){"use strict";var n=r(15);Object.defineProperty(t,"__esModule",{value:!0}),t.isMobile=function(){return void 0!==i.window.orientation},t.default=function(e){if(!e&&!(0,s.default)())return"Node";if((0,a.default)(e))return"Electron";var t="undefined"!=typeof navigator?navigator:{},r=e||t.userAgent||"";if(r.indexOf("Edge")>-1)return"Edge";var n=-1!==r.indexOf("MSIE "),o=-1!==r.indexOf("Trident/");if(n||o)return"IE";if(i.window.chrome)return"Chrome";if(i.window.safari)return"Safari";if(i.window.mozInnerScreenX)return"Firefox";return"Unknown"};var i=r(27),s=n(r(28)),a=n(r(24))},function(e,t,r){"use strict";r.r(t),r.d(t,"AnimationLoop",(function(){return Ke})),r.d(t,"Model",(function(){return Sr})),r.d(t,"ProgramManager",(function(){return ir})),r.d(t,"Transform",(function(){return Pr})),r.d(t,"Geometry",(function(){return Ur})),r.d(t,"ConeGeometry",(function(){return Gr})),r.d(t,"CubeGeometry",(function(){return Wr})),r.d(t,"CylinderGeometry",(function(){return zr})),r.d(t,"IcoSphereGeometry",(function(){return bn})),r.d(t,"PlaneGeometry",(function(){return pn})),r.d(t,"SphereGeometry",(function(){return Nn})),r.d(t,"TruncatedConeGeometry",(function(){return wr})),r.d(t,"Timeline",(function(){return In})),r.d(t,"KeyFrames",(function(){return Fn})),r.d(t,"ClipSpace",(function(){return Ln}));var n=r(6),i=r(17);var s=r(29);function a(e){return function(e){if(Array.isArray(e))return Object(i.a)(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(s.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}var l=r(21),h=Object(l.a)();function f(e){try{var t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch(e){return null}}var _=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";o(this,e),this.storage=f(n),this.id=t,this.config={},Object.assign(this.config,r),this._loadConfiguration()}return c(e,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}]),e}();function E(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,i=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>n&&(r=Math.min(r,n/e.width));var s=e.width*r,a=e.height*r,o=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),o]}var d={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function A(e){return"string"==typeof e?d[e.toUpperCase()]||d.WHITE:e}function T(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return g(e,t)}(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw i}}}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],n=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(n),s=T(i);try{var a=function(){var n=t.value;"function"==typeof e[n]&&(r.find((function(e){return n===e}))||(e[n]=e[n].bind(e)))};for(s.s();!(t=s.n()).done;)a()}catch(e){s.e(e)}finally{s.f()}}function R(e,t){if(!e)throw new Error(t||"Assertion failed")}var b=r(7);function p(){var e;if(h&&b.b.performance)e=b.b.performance.now();else if(b.a.hrtime){var t=b.a.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}var N={debug:h&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},S={enabled:!0,level:0};function O(){}var I={},F={once:!0};function y(e){for(var t in e)for(var r in e[t])return r||"untitled";return"empty"}var L=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.id;o(this,e),this.id=r,this.VERSION="8.4.3",this._startTs=p(),this._deltaTs=p(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new _("__probe-".concat(this.id,"__"),S),this.userData={},this.timeStamp("".concat(this.id," started")),m(this),Object.seal(this)}return c(e,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((p()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((p()-this._deltaTs).toPrecision(10))}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({level:e}),this}},{key:"assert",value:function(e,t){R(e,t)}},{key:"warn",value:function(e){return this._getLogFunction(0,e,N.warn,arguments,F)}},{key:"error",value:function(e){return this._getLogFunction(0,e,N.error,arguments)}},{key:"deprecated",value:function(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}},{key:"removed",value:function(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}},{key:"probe",value:function(e,t){return this._getLogFunction(e,t,N.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,t){return this._getLogFunction(e,t,N.debug,arguments)}},{key:"info",value:function(e,t){return this._getLogFunction(e,t,console.info,arguments)}},{key:"once",value:function(e,t){return this._getLogFunction(e,t,N.debug||N.info,arguments,F)}},{key:"table",value:function(e,t,r){return t?this._getLogFunction(e,t,console.table||O,r&&[r],{tag:y(t)}):O}},{key:"image",value:function(e){var t=e.logLevel,n=e.priority,i=e.image,s=e.message,o=void 0===s?"":s,u=e.scale,c=void 0===u?1:u;return this._shouldLog(t||n)?h?function(e){var t=e.image,r=e.message,n=void 0===r?"":r,i=e.scale,s=void 0===i?1:i;if("string"==typeof t){var o=new Image;return o.onload=function(){var e,t=E(o,n,s);(e=console).log.apply(e,a(t))},o.src=t,O}var u=t.nodeName||"";if("img"===u.toLowerCase()){var c;return(c=console).log.apply(c,a(E(t,n,s))),O}if("canvas"===u.toLowerCase()){var l=new Image;return l.onload=function(){var e;return(e=console).log.apply(e,a(E(l,n,s)))},l.src=t.toDataURL(),O}return O}({image:i,message:o,scale:c}):function(e){var t=e.image,n=(e.message,e.scale),i=void 0===n?1:n,s=null;try{s=r(33)}catch(e){}if(s)return function(){return s(t,{fit:"box",width:"".concat(Math.round(80*i),"%")}).then((function(e){return console.log(e)}))};return O}({image:i,message:o,scale:c}):O}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,t){this._storage.updateConfiguration(function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},e,t))}},{key:"time",value:function(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,t){return this._getLogFunction(e,t,console.timeStamp||O)}},{key:"group",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},n=r=M({logLevel:e,message:t,opts:r}),i=n.collapsed;return r.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}},{key:"groupCollapsed",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||O)}},{key:"withGroup",value:function(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=C(e)}},{key:"_getLogFunction",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4?arguments[4]:void 0;if(this._shouldLog(e)){var s;i=M({logLevel:e,message:t,args:n,opts:i}),R(r=r||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=p();var o=i.tag||i.message;if(i.once){if(I[o])return O;I[o]=p()}return t=v(this.id,i.message,i),(s=r).bind.apply(s,[console,t].concat(a(i.args)))}return O}},{key:"level",set:function(e){this.setLevel(e)},get:function(){return this.getLevel()}},{key:"priority",set:function(e){this.level=e},get:function(){return this.level}}]),e}();function C(e){if(!e)return 0;var t;switch(Object(n.a)(e)){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return R(Number.isFinite(t)&&t>=0),t}function M(e){var t=e.logLevel,r=e.message;e.logLevel=C(t);for(var i=e.args?Array.from(e.args):[];i.length&&i.shift()!==r;);switch(e.args=i,Object(n.a)(t)){case"string":case"function":void 0!==r&&i.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var s=Object(n.a)(e.message);return R("string"===s||"object"===s),Object.assign(e,e.opts)}function v(e,t,r){if("string"==typeof t){var n=r.time?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=Math.max(t-e.length,0);return"".concat(" ".repeat(r)).concat(e)}((o=r.total)<10?"".concat(o.toFixed(2),"ms"):o<100?"".concat(o.toFixed(1),"ms"):o<1e3?"".concat(o.toFixed(0),"ms"):"".concat((o/1e3).toFixed(2),"s")):"";t=r.time?"".concat(e,": ").concat(n,"  ").concat(t):"".concat(e,": ").concat(t),i=t,s=r.color,a=r.background,h||"string"!=typeof i||(s&&(s=A(s),i="[".concat(s,"m").concat(i,"[39m")),a&&(s=A(a),i="[".concat(a+10,"m").concat(i,"[49m"))),t=i}var i,s,a,o;return t}L.VERSION="8.4.3";const B=new L({id:"luma.gl"});var P=r(1),D=(r(26),r(10)),U=r(9),x=r(0),w=r(2),G=r(4);const H=Object(w.isBrowser)(),V=H&&"undefined"!=typeof document,k={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function j(e={}){Object(G.a)(H,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils"),e=Object.assign({},k,e);const{width:t,height:r}=e;function n(t){if(e.throwOnError)throw new Error(t);return console.error(t),null}let i;e.onError=n;const{canvas:s}=e;return i=function(e,t){const{onError:r}=t;let n=null;const i=e=>n=e.statusMessage||n;e.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:s=!0,webgl2:a=!0}=t;let o=null;a&&(o=o||e.getContext("webgl2",t),o=o||e.getContext("experimental-webgl2",t));s&&(o=o||e.getContext("webgl",t),o=o||e.getContext("experimental-webgl",t));if(e.removeEventListener("webglcontextcreationerror",i,!1),!o)return r(`Failed to create ${a&&!s?"WebGL2":"WebGL"} context: ${n||"Unknown error"}`);t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost,!1);t.onContextRestored&&e.addEventListener("webglcontextrestored",t.onContextRestored,!1);return o}(function({canvas:e,width:t=800,height:r=600,onError:n}){let i;if("string"==typeof e){V&&"complete"===document.readyState||n(`createGLContext called on canvas '${e}' before page was loaded`),i=document.getElementById(e)}else e?i=e:(i=document.createElement("canvas"),i.id="lumagl-canvas",i.style.width=Number.isFinite(t)?t+"px":"100%",i.style.height=Number.isFinite(r)?r+"px":"100%",document.body.insertBefore(i,document.body.firstChild));return i}({canvas:s,width:t,height:r,onError:n}),e),i?(i=X(i,e),function(e){const t=Object(P.e)(e)?"WebGL2":"WebGL1",r=function(e){const t=e.getParameter(x.a.VENDOR),r=e.getParameter(x.a.RENDERER),n=e.getExtension("WEBGL_debug_renderer_info"),i=n&&e.getParameter(n.UNMASKED_VENDOR_WEBGL||x.a.VENDOR),s=n&&e.getParameter(n.UNMASKED_RENDERER_WEBGL||x.a.RENDERER);return{vendor:i||t,renderer:s||r,vendorMasked:t,rendererMasked:r,version:e.getParameter(x.a.VERSION),shadingLanguageVersion:e.getParameter(x.a.SHADING_LANGUAGE_VERSION)}}(e),n=r?`(${r.vendor},${r.renderer})`:"",i=e.debug?" debug":"";B.info(1,`${t}${i} context ${n}`)()}(i),i):null}function X(e,t={}){if(!e||e._instrumented)return e;e._version=e._version||function(e){if("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return 2;return 1}(e),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{},t=Object.assign({},k,t);const{manageState:r,debug:n}=t;return r&&Object(U.c)(e,{copyState:!1,log:(...e)=>B.log(1,...e)()}),H&&n&&(w.global.makeDebugContext?(e=w.global.makeDebugContext(e,t),B.level=Math.max(B.level,1)):B.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),e._instrumented=!0,e}function W(e,t={}){if(e.canvas){return void function(e,t,r){let n="width"in r?r.width:e.canvas.clientWidth,i="height"in r?r.height:e.canvas.clientHeight;n&&i||(B.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=e.canvas.width||1,i=e.canvas.height||1);e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};const s=e.luma.canvasSizeInfo;if(s.clientWidth!==n||s.clientHeight!==i||s.devicePixelRatio!==t){let r=t;const s=Math.floor(n*r),a=Math.floor(i*r);e.canvas.width=s,e.canvas.height=a,e.drawingBufferWidth===s&&e.drawingBufferHeight===a||(B.warn("Device pixel ratio clamped")(),r=Math.min(e.drawingBufferWidth/n,e.drawingBufferHeight/i),e.canvas.width=Math.floor(n*r),e.canvas.height=Math.floor(i*r)),Object.assign(e.luma.canvasSizeInfo,{clientWidth:n,clientHeight:i,devicePixelRatio:t})}}(e,function(e){const t="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(e)?e<=0?1:e:e?t:1}(t.useDevicePixels),t)}const r=e.getExtension("STACKGL_resize_drawingbuffer");r&&"width"in t&&"height"in t&&r.resize(t.width,t.height)}var z=r(16),K=function(){function e(t,r){o(this,e),this.name=t,this.type=r,this.sampleSize=1,this.reset()}return c(e,[{key:"setSampleSize",value:function(e){return this.sampleSize=e,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(e){return this._count+=e,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(e){return this._count-=e,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Object(z.a)(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Object(z.a)()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),e}(),Y=function(){function e(t){var r=t.id,n=t.stats;o(this,e),this.id=r,this.stats={},this._initializeStats(n),Object.seal(this)}return c(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}},{key:"reset",value:function(){for(var e in this.stats)this.stats[e].reset();return this}},{key:"forEach",value:function(e){for(var t in this.stats)e(this.stats[t])}},{key:"getTable",value:function(){var e={};return this.forEach((function(t){e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}})),e}},{key:"_initializeStats",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach((function(t){return e._getOrCreate(t)}))}},{key:"_getOrCreate",value:function(e){if(!e||!e.name)return null;var t=e.name,r=e.type;return this.stats[t]||(this.stats[t]=e instanceof K?e:new K(t,r)),this.stats[t]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),e}();const $=new class{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Y({id:e})),this.stats.get(e)}};if(w.global.luma&&"8.4.3"!==w.global.luma.VERSION)throw new Error(`luma.gl - multiple VERSIONs detected: ${w.global.luma.VERSION} vs 8.4.3`);w.global.luma||(Object(w.isBrowser)()&&B.log(1,"luma.gl 8.4.3 - set luma.log.level=1 (or higher) to trace rendering")(),w.global.luma=w.global.luma||{VERSION:"8.4.3",version:"8.4.3",log:B,stats:$,globals:{modules:{},nodeIO:{}}});w.global.luma;function Z(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}function q(e,t){if("string"!=typeof t)return t;const r=Number(t);if(!isNaN(r))return r;const n=e[t=t.replace(/^.*\./,"")];return Z(void 0!==n,"Accessing undefined constant GL."+t),n}function Q(e,t){t=Number(t);for(const r in e)if(e[r]===t)return"GL."+r;return String(t)}const J={};function ee(e="id"){J[e]=J[e]||1;return`${e}-${J[e]++}`}function te(e){return Z("number"==typeof e,"Input must be a number"),e&&0==(e&e-1)}function re(e){let t=!0;for(const r in e){t=!1;break}return t}function ne(e,t,r,n){const i=`See luma.gl ${r} Upgrade Guide at https://luma.gl/docs/upgrade-guide`,s=Object.getPrototypeOf(e);n.forEach(e=>{s.methodName||(s[e]=()=>{throw B.removed(`Calling removed method ${t}.${e}: `,i)(),new Error(e)})})}const ie="Resource subclass must define virtual methods";class se{constructor(e,t={}){Object(P.b)(e);const{id:r,userData:n={}}=t;this.gl=e,this.gl2=e,this.id=r||ee(this.constructor.name),this.userData=n,this._bound=!1,this._handle=t.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return`${this.constructor.name}(${this.id})`}get handle(){return this._handle}delete({deleteChildren:e=!1}={}){const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(e=>e.delete()),this}bind(e=this.handle){if("function"!=typeof e)return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e,t={}){Z(e=q(this.gl,e));const r=(this.constructor.PARAMETERS||{})[e];if(r){const e=Object(P.e)(this.gl);if(!((!("webgl2"in r)||e)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const t=r.webgl1,n="webgl2"in r?r.webgl2:r.webgl1;return e?n:t}}return this._getParameter(e,t)}getParameters(e={}){const{parameters:t,keys:r}=e,n=this.constructor.PARAMETERS||{},i=Object(P.e)(this.gl),s={},a=t||Object.keys(n);for(const t of a){const a=n[t];if(a&&(!("webgl2"in a)||i)&&(!("extension"in a)||this.gl.getExtension(a.extension))){const n=r?Q(this.gl,t):t;s[n]=this.getParameter(t,e),r&&"GLenum"===a.type&&(s[n]=Q(this.gl,s[n]))}}return s}setParameter(e,t){Z(e=q(this.gl,e));const r=(this.constructor.PARAMETERS||{})[e];if(r){const e=Object(P.e)(this.gl);if(!((!("webgl2"in r)||e)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");"GLenum"===r.type&&(t=q(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return ne(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(ie)}_deleteHandle(){throw new Error(ie)}_bindHandle(e){throw new Error(ie)}_getOptsFromHandle(){throw new Error(ie)}_getParameter(e,t){throw new Error(ie)}_setParameter(e,t){throw new Error(ie)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this.constructor.name,t=$.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get(e+"s Created").incrementCount(),t.get(e+"s Active").incrementCount()}_removeStats(){const e=this.constructor.name;$.get("Resource Counts").get(e+"s Active").decrementCount()}_trackAllocatedMemory(e,t=this.constructor.name){const r=$.get("Memory Usage");r.get("GPU Memory").addCount(e),r.get(t+" Memory").addCount(e),this.byteLength=e}_trackDeallocatedMemory(e=this.constructor.name){const t=$.get("Memory Usage");t.get("GPU Memory").subtractCount(this.byteLength),t.get(e+" Memory").subtractCount(this.byteLength),this.byteLength=0}}function ae(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return x.a.FLOAT;case Uint16Array:return x.a.UNSIGNED_SHORT;case Uint32Array:return x.a.UNSIGNED_INT;case Uint8Array:case Uint8ClampedArray:return x.a.UNSIGNED_BYTE;case Int8Array:return x.a.BYTE;case Int16Array:return x.a.SHORT;case Int32Array:return x.a.INT;default:throw new Error("Failed to deduce GL constant from typed array")}}function oe(e,{clamped:t=!0}={}){switch(e){case x.a.FLOAT:return Float32Array;case x.a.UNSIGNED_SHORT:case x.a.UNSIGNED_SHORT_5_6_5:case x.a.UNSIGNED_SHORT_4_4_4_4:case x.a.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case x.a.UNSIGNED_INT:return Uint32Array;case x.a.UNSIGNED_BYTE:return t?Uint8ClampedArray:Uint8Array;case x.a.BYTE:return Int8Array;case x.a.SHORT:return Int16Array;case x.a.INT:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function ue({data:e,width:t,height:r}){const n=Math.round(t/2),i=Math.round(r/2),s=new Uint8Array(n*i*4);for(let r=0;r<i;r++)for(let i=0;i<n;i++)for(let a=0;a<4;a++)s[4*(r*n+i)+a]=e[4*(2*r*t+2*i)+a];return{data:s,width:n,height:i}}function ce(e,t,r){const{removedProps:n={},deprecatedProps:i={},replacedProps:s={}}=r;for(const r in n)if(r in t){const t=n[r]?`${e}.${n[r]}`:"N/A";B.removed(`${e}.${r}`,t)()}for(const r in i)if(r in t){const t=i[r];B.deprecated(`${e}.${r}`,`${e}.${t}`)()}let a=null;for(const r in s)if(r in t){const n=s[r];B.deprecated(`${e}.${r}`,`${e}.${n}`)(),a=a||Object.assign({},t),a[n]=t[r],delete a[r]}return a||t}const le={offset:0,stride:0,type:x.a.FLOAT,size:1,divisor:0,normalized:!1,integer:!1},he={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class fe{static getBytesPerElement(e){return oe(e.type||x.a.FLOAT).BYTES_PER_ELEMENT}static getBytesPerVertex(e){Z(e.size);return oe(e.type||x.a.FLOAT).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new fe(...[le,...e])}constructor(...e){e.forEach(e=>this._assign(e)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return fe.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return fe.getBytesPerVertex(this)}_assign(e={}){return void 0!==(e=ce("Accessor",e,he)).type&&(this.type=e.type,e.type!==x.a.INT&&e.type!==x.a.UNSIGNED_INT||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof e.index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),this}}const _e={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Ee={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:_e},de={removedProps:_e};class Ae extends se{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?x.a.COPY_READ_BUFFER:x.a.ARRAY_BUFFER),this.initialize(t),Object.seal(this)}getElementCount(e=this.accessor){return Math.round(this.byteLength/fe.getBytesPerElement(e))}getVertexCount(e=this.accessor){return Math.round(this.byteLength/fe.getBytesPerVertex(e))}initialize(e={}){return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=ce("Buffer",e,Ee),this.usage=e.usage||x.a.STATIC_DRAW,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return"accessor"in(e=ce("Buffer",e,de))&&this.setAccessor(e.accessor),this}setAccessor(e){return delete(e=Object.assign({},e)).buffer,this.accessor=new fe(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:n=0}=e,i=e.byteLength||e.length;Z(t);const s=this.gl.webgl2?x.a.COPY_WRITE_BUFFER:this.target;return this.gl.bindBuffer(s,this.handle),0!==n||void 0!==i?(Object(P.a)(this.gl),this.gl.bufferSubData(this.target,r,t,n,i)):this.gl.bufferSubData(s,r,t),this.gl.bindBuffer(s,null),this.debugData=null,this._inferType(t),this}copyData({sourceBuffer:e,readOffset:t=0,writeOffset:r=0,size:n}){const{gl:i}=this;return Object(P.a)(i),i.bindBuffer(x.a.COPY_READ_BUFFER,e.handle),i.bindBuffer(x.a.COPY_WRITE_BUFFER,this.handle),i.copyBufferSubData(x.a.COPY_READ_BUFFER,x.a.COPY_WRITE_BUFFER,t,r,n),i.bindBuffer(x.a.COPY_READ_BUFFER,null),i.bindBuffer(x.a.COPY_WRITE_BUFFER,null),this.debugData=null,this}getData({dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:n=0}={}){Object(P.a)(this.gl);const i=oe(this.accessor.type||x.a.FLOAT,{clamped:!1}),s=this._getAvailableElementCount(t),a=r;let o,u;e?(u=e.length,o=u-a):(o=Math.min(s,n||s),u=a+o);const c=Math.min(s,o);return Z((n=n||c)<=c),e=e||new i(u),this.gl.bindBuffer(x.a.COPY_READ_BUFFER,this.handle),this.gl.getBufferSubData(x.a.COPY_READ_BUFFER,t,e,r,n),this.gl.bindBuffer(x.a.COPY_READ_BUFFER,null),e}bind({target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:n}={}){return e===x.a.UNIFORM_BUFFER||e===x.a.TRANSFORM_FEEDBACK_BUFFER?void 0!==n?this.gl.bindBufferRange(e,t,this.handle,r,n):(Z(0===r),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind({target:e=this.target,index:t=this.accessor&&this.accessor.index}={}){return e===x.a.UNIFORM_BUFFER||e===x.a.TRANSFORM_FEEDBACK_BUFFER?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(10,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e,t=0,r=e.byteLength+t){Z(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.usage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.debugData=e.slice(0,10),this.bytesUsed=r,this._trackAllocatedMemory(r);const i=ae(e);return Z(i),this.setAccessor(new fe(this.accessor,{type:i})),this}_setByteLength(e,t=this.usage){Z(e>=0),this._trackDeallocatedMemory();let r=e;0===e&&(r=new Float32Array(0));const n=this._getTarget();return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,t),this.gl.bindBuffer(n,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?x.a.COPY_WRITE_BUFFER:this.target}_getAvailableElementCount(e){const t=e/oe(this.accessor.type||x.a.FLOAT,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-t}_inferType(e){this.accessor.type||this.setAccessor(new fe(this.accessor,{type:ae(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return B.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return B.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return B.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return B.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new fe(this.accessor,e),this}}const Te={[x.a.RGB]:{dataFormat:x.a.RGB,types:[x.a.UNSIGNED_BYTE,x.a.UNSIGNED_SHORT_5_6_5]},[x.a.RGBA]:{dataFormat:x.a.RGBA,types:[x.a.UNSIGNED_BYTE,x.a.UNSIGNED_SHORT_4_4_4_4,x.a.UNSIGNED_SHORT_5_5_5_1]},[x.a.ALPHA]:{dataFormat:x.a.ALPHA,types:[x.a.UNSIGNED_BYTE]},[x.a.LUMINANCE]:{dataFormat:x.a.LUMINANCE,types:[x.a.UNSIGNED_BYTE]},[x.a.LUMINANCE_ALPHA]:{dataFormat:x.a.LUMINANCE_ALPHA,types:[x.a.UNSIGNED_BYTE]},[x.a.R32F]:{dataFormat:x.a.RED,types:[x.a.FLOAT],gl2:!0},[x.a.RG32F]:{dataFormat:x.a.RG,types:[x.a.FLOAT],gl2:!0},[x.a.RGB32F]:{dataFormat:x.a.RGB,types:[x.a.FLOAT],gl2:!0},[x.a.RGBA32F]:{dataFormat:x.a.RGBA,types:[x.a.FLOAT],gl2:!0}},ge={[x.a.RED]:1,[x.a.RED_INTEGER]:1,[x.a.RG]:2,[x.a.RG_INTEGER]:2,[x.a.RGB]:3,[x.a.RGB_INTEGER]:3,[x.a.RGBA]:4,[x.a.RGBA_INTEGER]:4,[x.a.DEPTH_COMPONENT]:1,[x.a.DEPTH_STENCIL]:1,[x.a.ALPHA]:1,[x.a.LUMINANCE]:1,[x.a.LUMINANCE_ALPHA]:2},me={[x.a.FLOAT]:4,[x.a.UNSIGNED_INT]:4,[x.a.INT]:4,[x.a.UNSIGNED_SHORT]:2,[x.a.SHORT]:2,[x.a.HALF_FLOAT]:2,[x.a.BYTE]:1,[x.a.UNSIGNED_BYTE]:1};const Re=[x.a.LINEAR,x.a.NEAREST],be=w.global.WebGLBuffer||function(){};class pe extends se{static isSupported(e,t={}){const{format:r,linearFiltering:n}=t;let i=!0;return r&&(i=i&&function(e,t){const r=Te[t];if(!r)return!1;if(void 0===r.gl1&&void 0===r.gl2)return!0;const n=Object(P.e)(e)&&r.gl2||r.gl1;return"string"==typeof n?e.getExtension(n):n}(e,r),i=i&&(!n||function(e,t){const r=Te[t];switch(r&&r.types[0]){case x.a.FLOAT:return e.getExtension("OES_texture_float_linear");case x.a.HALF_FLOAT:return e.getExtension("OES_texture_half_float_linear");default:return!0}}(e,r))),i}constructor(e,t){const{id:r=ee("texture"),handle:n,target:i}=t;super(e,{id:r,handle:n}),this.target=i,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return`Texture(${this.id},${this.width}x${this.height})`}initialize(e={}){let t=e.data;if(t instanceof Promise)return t.then(t=>this.initialize(Object.assign({},e,{pixels:t,data:t}))),this;const r="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement;if(r&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:n=null,format:i=x.a.RGBA,border:s=0,recreate:a=!1,parameters:o={},pixelStore:u={},textureUnit:c}=e;t||(t=n);let{width:l,height:h,dataFormat:f,type:_,compressed:E=!1,mipmaps:d=!0}=e;const{depth:A=0}=e;return({width:l,height:h,compressed:E,dataFormat:f,type:_}=this._deduceParameters({format:i,type:_,dataFormat:f,compressed:E,data:t,width:l,height:h})),this.width=l,this.height=h,this.depth=A,this.format=i,this.type=_,this.dataFormat=f,this.border=s,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(x.a.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),d&&this._isNPOT()&&(B.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),d=!1,this._updateForNPOT(o)),this.mipmaps=d,this.setImageData({data:t,width:l,height:h,depth:A,format:i,type:_,dataFormat:f,border:s,mipmaps:d,parameters:u,compressed:E}),d&&this.generateMipmap(),this.setParameters(o),a&&(this.data=t),r&&(this._video={video:t,parameters:o,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize({height:e,width:t,mipmaps:r=!1}){return t!==this.width||e!==this.height?this.initialize({width:t,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(e={}){return this._isNPOT()?(B.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Object(D.d)(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:r=null,level:n=0,format:i=this.format,border:s=this.border,offset:a=0,parameters:o={}}=e;let{data:u=null,type:c=this.type,width:l=this.width,height:h=this.height,dataFormat:f=this.dataFormat,compressed:_=!1}=e;u||(u=r),({type:c,dataFormat:f,compressed:_,width:l,height:h}=this._deduceParameters({format:i,type:c,dataFormat:f,compressed:_,data:u,width:l,height:h}));const{gl:E}=this;E.bindTexture(this.target,this.handle);let d,A=null;if(({data:u,dataType:A}=this._getDataType({data:u,compressed:_})),Object(D.d)(this.gl,o,()=>{switch(A){case"null":E.texImage2D(t,n,i,l,h,s,f,c,u);break;case"typed-array":E.texImage2D(t,n,i,l,h,s,f,c,u,a);break;case"buffer":d=Object(P.a)(E),d.bindBuffer(x.a.PIXEL_UNPACK_BUFFER,u.handle||u),d.texImage2D(t,n,i,l,h,s,f,c,a),d.bindBuffer(x.a.PIXEL_UNPACK_BUFFER,null);break;case"browser-object":Object(P.e)(E)?E.texImage2D(t,n,i,l,h,s,f,c,u):E.texImage2D(t,n,i,f,c,u);break;case"compressed":for(const[e,r]of u.entries())E.compressedTexImage2D(t,e,r.format,r.width,r.height,s,r.data);break;default:Z(!1,"Unknown image data type")}}),u&&u.byteLength)this._trackAllocatedMemory(u.byteLength,"Texture");else{const e=ge[this.dataFormat]||4,t=me[this.type]||1;this._trackAllocatedMemory(this.width*this.height*e*t,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:t=null,data:r=null,x:n=0,y:i=0,width:s=this.width,height:a=this.height,level:o=0,format:u=this.format,type:c=this.type,dataFormat:l=this.dataFormat,compressed:h=!1,offset:f=0,border:_=this.border,parameters:E={}}){if(({type:c,dataFormat:l,compressed:h,width:s,height:a}=this._deduceParameters({format:u,type:c,dataFormat:l,compressed:h,data:r,width:s,height:a})),Z(0===this.depth,"texSubImage not supported for 3D textures"),r||(r=t),r&&r.data){const e=r;r=e.data,s=e.shape[0],a=e.shape[1]}r instanceof Ae&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),Object(D.d)(this.gl,E,()=>{if(h)this.gl.compressedTexSubImage2D(e,o,n,i,s,a,u,r);else if(null===r)this.gl.texSubImage2D(e,o,n,i,s,a,l,c,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(e,o,n,i,s,a,l,c,r,f);else if(r instanceof be){const t=Object(P.a)(this.gl);t.bindBuffer(x.a.PIXEL_UNPACK_BUFFER,r),t.texSubImage2D(e,o,n,i,s,a,l,c,f),t.bindBuffer(x.a.PIXEL_UNPACK_BUFFER,null)}else if(Object(P.e)(this.gl)){Object(P.a)(this.gl).texSubImage2D(e,o,n,i,s,a,l,c,r)}else this.gl.texSubImage2D(e,o,n,i,l,c,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return B.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(x.a.ACTIVE_TEXTURE)-x.a.TEXTURE0}bind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,null),e}_getDataType({data:e,compressed:t=!1}){return t?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Ae?{data:e.handle,dataType:"buffer"}:e instanceof be?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:r}=e;let{width:n,height:i,dataFormat:s,type:a,compressed:o}=e;const u=Te[t];return s=s||u&&u.dataFormat,a=a||u&&u.types[0],o=o||u&&u.compressed,({width:n,height:i}=this._deduceImageSize(r,n,i)),{dataFormat:s,type:a,compressed:o,width:n,height:i,format:t,data:r}}_deduceImageSize(e,t,r){let n;return n="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:r}:{width:t>=0?t:1,height:r>=0?r:1},Z(n,"Could not deduced texture size"),Z(void 0===t||n.width===t,"Deduced texture width does not match supplied width"),Z(void 0===r||n.height===r,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case x.a.TEXTURE_WIDTH:return this.width;case x.a.TEXTURE_HEIGHT:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case x.a.TEXTURE_MIN_LOD:case x.a.TEXTURE_MAX_LOD:this.gl.texParameterf(this.handle,e,t);break;case x.a.TEXTURE_WIDTH:case x.a.TEXTURE_HEIGHT:Z(!1);break;default:this.gl.texParameteri(this.target,e,t)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!Object(P.e)(this.gl)&&(!(!this.width||!this.height)&&(!te(this.width)||!te(this.height)))}_updateForNPOT(e){void 0===e[this.gl.TEXTURE_MIN_FILTER]&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===e[this.gl.TEXTURE_WRAP_S]&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===e[this.gl.TEXTURE_WRAP_T]&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case x.a.TEXTURE_MIN_FILTER:-1===Re.indexOf(t)&&(t=x.a.LINEAR);break;case x.a.TEXTURE_WRAP_S:case x.a.TEXTURE_WRAP_T:t!==x.a.CLAMP_TO_EDGE&&(t=x.a.CLAMP_TO_EDGE)}return t}}let Ne="";class Se extends pe{static isSupported(e,t){return pe.isSupported(e,t)}constructor(e,t={}){var r,n;Object(P.b)(e),(t instanceof Promise||"string"==typeof t)&&(t={data:t}),"string"==typeof t.data&&(t=Object.assign({},t,{data:(r=t.data,Z("string"==typeof r),r=Ne+r,new Promise((e,t)=>{try{const i=new Image;i.onload=()=>e(i),i.onerror=()=>t(new Error(`Could not load image ${r}.`)),i.crossOrigin=n&&n.crossOrigin||"anonymous",i.src=r}catch(e){t(e)}}))})),super(e,Object.assign({},t,{target:x.a.TEXTURE_2D})),this.initialize(t),Object.seal(this)}}const Oe="EXT_color_buffer_float";var Ie={[x.a.DEPTH_COMPONENT16]:{bpp:2},[x.a.DEPTH_COMPONENT24]:{gl2:!0,bpp:3},[x.a.DEPTH_COMPONENT32F]:{gl2:!0,bpp:4},[x.a.STENCIL_INDEX8]:{bpp:1},[x.a.DEPTH_STENCIL]:{bpp:4},[x.a.DEPTH24_STENCIL8]:{gl2:!0,bpp:4},[x.a.DEPTH32F_STENCIL8]:{gl2:!0,bpp:5},[x.a.RGBA4]:{bpp:2},[x.a.RGB565]:{bpp:2},[x.a.RGB5_A1]:{bpp:2},[x.a.R8]:{gl2:!0,bpp:1},[x.a.R8UI]:{gl2:!0,bpp:1},[x.a.R8I]:{gl2:!0,bpp:1},[x.a.R16UI]:{gl2:!0,bpp:2},[x.a.R16I]:{gl2:!0,bpp:2},[x.a.R32UI]:{gl2:!0,bpp:4},[x.a.R32I]:{gl2:!0,bpp:4},[x.a.RG8]:{gl2:!0,bpp:2},[x.a.RG8UI]:{gl2:!0,bpp:2},[x.a.RG8I]:{gl2:!0,bpp:2},[x.a.RG16UI]:{gl2:!0,bpp:4},[x.a.RG16I]:{gl2:!0,bpp:4},[x.a.RG32UI]:{gl2:!0,bpp:8},[x.a.RG32I]:{gl2:!0,bpp:8},[x.a.RGB8]:{gl2:!0,bpp:3},[x.a.RGBA8]:{gl2:!0,bpp:4},[x.a.RGB10_A2]:{gl2:!0,bpp:4},[x.a.RGBA8UI]:{gl2:!0,bpp:4},[x.a.RGBA8I]:{gl2:!0,bpp:4},[x.a.RGB10_A2UI]:{gl2:!0,bpp:4},[x.a.RGBA16UI]:{gl2:!0,bpp:8},[x.a.RGBA16I]:{gl2:!0,bpp:8},[x.a.RGBA32I]:{gl2:!0,bpp:16},[x.a.RGBA32UI]:{gl2:!0,bpp:16},[x.a.R16F]:{gl2:Oe,bpp:2},[x.a.RG16F]:{gl2:Oe,bpp:4},[x.a.RGBA16F]:{gl2:Oe,bpp:8},[x.a.R32F]:{gl2:Oe,bpp:4},[x.a.RG32F]:{gl2:Oe,bpp:8},[x.a.RGBA32F]:{gl2:Oe,bpp:16},[x.a.R11F_G11F_B10F]:{gl2:Oe,bpp:4}};class Fe extends se{static isSupported(e,{format:t}={format:null}){return!t||function(e,t,r){const n=r[t];if(!n)return!1;const i=Object(P.e)(e)&&n.gl2||n.gl1;return"string"==typeof i?e.getExtension(i):i}(e,t,Ie)}static getSamplesForFormat(e,{format:t}){return e.getInternalformatParameter(x.a.RENDERBUFFER,t,x.a.SAMPLES)}constructor(e,t={}){super(e,t),this.initialize(t),Object.seal(this)}initialize({format:e,width:t=1,height:r=1,samples:n=0}){return Z(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(x.a.RENDERBUFFER,this.handle),0!==n&&Object(P.e)(this.gl)?this.gl.renderbufferStorageMultisample(x.a.RENDERBUFFER,n,e,t,r):this.gl.renderbufferStorage(x.a.RENDERBUFFER,e,t,r),this.format=e,this.width=t,this.height=r,this.samples=n,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Ie[this.format].bpp),this}resize({width:e,height:t}){return e!==this.width||t!==this.height?this.initialize({width:e,height:t,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(x.a.RENDERBUFFER,e)}_syncHandle(e){this.format=this.getParameter(x.a.RENDERBUFFER_INTERNAL_FORMAT),this.width=this.getParameter(x.a.RENDERBUFFER_WIDTH),this.height=this.getParameter(x.a.RENDERBUFFER_HEIGHT),this.samples=this.getParameter(x.a.RENDERBUFFER_SAMPLES)}_getParameter(e){this.gl.bindRenderbuffer(x.a.RENDERBUFFER,this.handle);return this.gl.getRenderbufferParameter(x.a.RENDERBUFFER,e)}}function ye(e,{framebuffer:t=null,color:r=null,depth:n=null,stencil:i=null}={}){const s={};t&&(s.framebuffer=t);let a=0;r&&(a|=16384,!0!==r&&(s.clearColor=r)),n&&(a|=256,!0!==n&&(s.clearDepth=n)),i&&(a|=1024,!0!==n&&(s.clearStencil=n)),Z(0!==a,"clear: bad arguments"),Object(D.d)(e,s,()=>{e.clear(a)})}function Le(e){switch(e){case x.a.ALPHA:case x.a.R32F:case x.a.RED:return 1;case x.a.RG32F:case x.a.RG:return 2;case x.a.RGB:case x.a.RGB32F:return 3;case x.a.RGBA:case x.a.RGBA32F:return 4;default:return Z(!1),0}}const Ce=[x.a.TEXTURE_CUBE_MAP_POSITIVE_X,x.a.TEXTURE_CUBE_MAP_NEGATIVE_X,x.a.TEXTURE_CUBE_MAP_POSITIVE_Y,x.a.TEXTURE_CUBE_MAP_NEGATIVE_Y,x.a.TEXTURE_CUBE_MAP_POSITIVE_Z,x.a.TEXTURE_CUBE_MAP_NEGATIVE_Z];class Me extends pe{constructor(e,t={}){Object(P.b)(e),super(e,Object.assign({},t,{target:x.a.TEXTURE_CUBE_MAP})),this.initialize(t),Object.seal(this)}initialize(e={}){const{mipmaps:t=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(r)}),this}subImage({face:e,data:t,x:r=0,y:n=0,mipmapLevel:i=0}){return this._subImage({target:e,data:t,x:r,y:n,mipmapLevel:i})}async setCubeMapImageData({width:e,height:t,pixels:r,data:n,border:i=0,format:s=x.a.RGBA,type:a=x.a.UNSIGNED_BYTE}){const{gl:o}=this,u=r||n,c=await Promise.all(Ce.map(e=>{const t=u[e];return Promise.all(Array.isArray(t)?t:[t])}));this.bind(),Ce.forEach((r,n)=>{c[n].length>1&&!1!==this.opts.mipmaps&&B.warn(this.id+" has mipmap and multiple LODs.")(),c[n].forEach((n,u)=>{e&&t?o.texImage2D(r,u,s,e,t,i,s,a,n):o.texImage2D(r,u,s,s,a,n)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:r,height:n,pixels:i,data:s,border:a=0,format:o=x.a.RGBA,type:u=x.a.UNSIGNED_BYTE}=e,{gl:c}=this,l=i||s;return this.bind(),l instanceof Promise?l.then(r=>this.setImageDataForFace(Object.assign({},e,{face:t,data:r,pixels:r}))):this.width||this.height?c.texImage2D(t,0,o,r,n,a,o,u,l):c.texImage2D(t,0,o,o,u,l),this}}Me.FACES=Ce;class ve extends pe{static isSupported(e){return Object(P.e)(e)}constructor(e,t={}){Object(P.a)(e),super(e,t=Object.assign({depth:1},t,{target:x.a.TEXTURE_3D,unpackFlipY:!1})),this.initialize(t),Object.seal(this)}setImageData({level:e=0,dataFormat:t=x.a.RGBA,width:r,height:n,depth:i=1,border:s=0,format:a,type:o=x.a.UNSIGNED_BYTE,offset:u=0,data:c,parameters:l={}}){if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Object(D.d)(this.gl,l,()=>{ArrayBuffer.isView(c)&&this.gl.texImage3D(this.target,e,t,r,n,i,s,a,o,c),c instanceof Ae&&(this.gl.bindBuffer(x.a.PIXEL_UNPACK_BUFFER,c.handle),this.gl.texImage3D(this.target,e,t,r,n,i,s,a,o,u))}),c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const e=ge[this.dataFormat]||4,t=me[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*e*t,"Texture")}return this.loaded=!0,this}}function Be(e,t){const{gl:r,width:n,height:i,id:s}=e;return new xe(r,Object.assign({},t,{id:"framebuffer-for-"+s,width:n,height:i,attachments:{[x.a.COLOR_ATTACHMENT0]:e}}))}function Pe(e,t={}){const{sourceX:r=0,sourceY:n=0,sourceFormat:i=x.a.RGBA}=t;let{sourceAttachment:s=x.a.COLOR_ATTACHMENT0,target:a=null,sourceWidth:o,sourceHeight:u,sourceType:c}=t;const{framebuffer:l,deleteFramebuffer:h}=Ue(e);Z(l);const{gl:f,handle:_,attachments:E}=l;o=o||l.width,u=u||l.height,s===x.a.COLOR_ATTACHMENT0&&null===_&&(s=x.a.FRONT),Z(E[s]),c=c||E[s].type,a=function(e,t,r,n,i){if(e)return e;const s=oe(t=t||x.a.UNSIGNED_BYTE,{clamped:!1}),a=Le(r);return new s(n*i*a)}(a,c,i,o,u),c=c||ae(a);const d=f.bindFramebuffer(x.a.FRAMEBUFFER,_);return f.readPixels(r,n,o,u,i,c,a),f.bindFramebuffer(x.a.FRAMEBUFFER,d||null),h&&l.delete(),a}function De(e,{sourceAttachment:t=x.a.COLOR_ATTACHMENT0,targetMaxHeight:r=Number.MAX_SAFE_INTEGER}={}){let n=Pe(e,{sourceAttachment:t}),{width:i,height:s}=e;for(;s>r;)({data:n,width:i,height:s}=ue({data:n,width:i,height:s}));!function({data:e,width:t,height:r,bytesPerPixel:n=4,temp:i}){const s=t*n;i=i||new Uint8Array(s);for(let t=0;t<r/2;++t){const n=t*s,a=(r-t-1)*s;i.set(e.subarray(n,n+s)),e.copyWithin(n,a,a+s),e.set(i,a)}}({data:n,width:i,height:s});const a=document.createElement("canvas");a.width=i,a.height=s;const o=a.getContext("2d"),u=o.createImageData(i,s);return u.data.set(n),o.putImageData(u,0,0),a.toDataURL()}function Ue(e){return e instanceof xe?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:Be(e),deleteFramebuffer:!0}}class xe extends se{static isSupported(e,t={}){const{colorBufferFloat:r,colorBufferHalfFloat:n}=t;let i=!0;return r&&(i=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),n&&(i=i&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),i}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new xe(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Object(P.a)(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Object(P.a)(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e,t={}){super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=x.a.COLOR_ATTACHMENT0,this.drawBuffers=[x.a.COLOR_ATTACHMENT0],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[x.a.COLOR_ATTACHMENT0]||null}get texture(){return this.attachments[x.a.COLOR_ATTACHMENT0]||null}get depth(){return this.attachments[x.a.DEPTH_ATTACHMENT]||this.attachments[x.a.DEPTH_STENCIL_ATTACHMENT]||null}get stencil(){return this.attachments[x.a.STENCIL_ATTACHMENT]||this.attachments[x.a.DEPTH_STENCIL_ATTACHMENT]||null}initialize({width:e=1,height:t=1,attachments:r=null,color:n=!0,depth:i=!0,stencil:s=!1,check:a=!0,readBuffer:o,drawBuffers:u}){if(Z(e>=0&&t>=0,"Width and height need to be integers"),this.width=e,this.height=t,r)for(const n in r){const i=r[n];(Array.isArray(i)?i[0]:i).resize({width:e,height:t})}else r=this._createDefaultAttachments(n,i,s,e,t);this.update({clearAttachments:!0,attachments:r,readBuffer:o,drawBuffers:u}),r&&a&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update({attachments:e={},readBuffer:t,drawBuffers:r,clearAttachments:n=!1,resizeAttachments:i=!0}){this.attach(e,{clearAttachments:n,resizeAttachments:i});const{gl:s}=this,a=s.bindFramebuffer(x.a.FRAMEBUFFER,this.handle);return t&&this._setReadBuffer(t),r&&this._setDrawBuffers(r),s.bindFramebuffer(x.a.FRAMEBUFFER,a||null),this}resize(e={}){let{width:t,height:r}=e;if(null===this.handle)return Z(void 0===t&&void 0===r),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===t&&(t=this.gl.drawingBufferWidth),void 0===r&&(r=this.gl.drawingBufferHeight),t!==this.width&&r!==this.height&&B.log(2,`Resizing framebuffer ${this.id} to ${t}x${r}`)();for(const e in this.attachments)this.attachments[e].resize({width:t,height:r});return this.width=t,this.height=r,this}attach(e,{clearAttachments:t=!1,resizeAttachments:r=!0}={}){const n={};t&&Object.keys(this.attachments).forEach(e=>{n[e]=null}),Object.assign(n,e);const i=this.gl.bindFramebuffer(x.a.FRAMEBUFFER,this.handle);for(const e in n){Z(void 0!==e,"Misspelled framebuffer binding point?");const t=Number(e),i=n[t];let s=i;if(s)if(s instanceof Fe)this._attachRenderbuffer({attachment:t,renderbuffer:s});else if(Array.isArray(i)){const[e,r=0,n=0]=i;s=e,this._attachTexture({attachment:t,texture:e,layer:r,level:n})}else this._attachTexture({attachment:t,texture:s,layer:0,level:0});else this._unattach(t);r&&s&&s.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(x.a.FRAMEBUFFER,i||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(e=>!this.attachments[e]).forEach(e=>{delete this.attachments[e]})}checkStatus(){const{gl:e}=this,t=this.getStatus();if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error(function(e){return(xe.STATUS||{})[e]||"Framebuffer error "+e}(t));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(x.a.FRAMEBUFFER,this.handle),r=e.checkFramebufferStatus(x.a.FRAMEBUFFER);return e.bindFramebuffer(x.a.FRAMEBUFFER,t||null),r}clear(e={}){const{color:t,depth:r,stencil:n,drawBuffers:i=[]}=e,s=this.gl.bindFramebuffer(x.a.FRAMEBUFFER,this.handle);return(t||r||n)&&ye(this.gl,{color:t,depth:r,stencil:n}),i.forEach((e,t)=>{!function(e,{framebuffer:t=null,buffer:r=6144,drawBuffer:n=0,value:i=[0,0,0,0]}={}){Object(P.a)(e),Object(D.d)(e,{framebuffer:t},()=>{switch(r){case 6144:switch(i.constructor){case Int32Array:e.clearBufferiv(r,n,i);break;case Uint32Array:e.clearBufferuiv(r,n,i);break;case Float32Array:default:e.clearBufferfv(r,n,i)}break;case 6145:e.clearBufferfv(6145,0,[i]);break;case 6146:e.clearBufferiv(6146,0,[i]);break;case 34041:const[t,s]=i;e.clearBufferfi(34041,0,t,s);break;default:Z(!1,"clear: bad arguments")}})}({drawBuffer:t,value:e})}),this.gl.bindFramebuffer(x.a.FRAMEBUFFER,s||null),this}readPixels(e={}){return B.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(e={}){return B.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(e={}){return B.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(e={}){return B.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(e={}){return B.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(e={}){return B.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate({attachments:e=[],x:t=0,y:r=0,width:n,height:i}){const s=Object(P.a)(this.gl),a=s.bindFramebuffer(x.a.READ_FRAMEBUFFER,this.handle);return 0===t&&0===r&&void 0===n&&void 0===i?s.invalidateFramebuffer(x.a.READ_FRAMEBUFFER,e):s.invalidateFramebuffer(x.a.READ_FRAMEBUFFER,e,t,r,n,i),s.bindFramebuffer(x.a.READ_FRAMEBUFFER,a),this}getAttachmentParameter(e,t,r){let n=this._getAttachmentParameterFallback(t);return null===n&&(this.gl.bindFramebuffer(x.a.FRAMEBUFFER,this.handle),n=this.gl.getFramebufferAttachmentParameter(x.a.FRAMEBUFFER,e,t),this.gl.bindFramebuffer(x.a.FRAMEBUFFER,null)),r&&n>1e3&&(n=Q(this.gl,n)),n}getAttachmentParameters(e=x.a.COLOR_ATTACHMENT0,t,r=this.constructor.ATTACHMENT_PARAMETERS||[]){const n={};for(const i of r){n[t?Q(this.gl,i):i]=this.getAttachmentParameter(e,i,t)}return n}getParameters(e=!0){const t=Object.keys(this.attachments),r={};for(const n of t){const t=Number(n);r[e?Q(this.gl,t):t]=this.getAttachmentParameters(t,e)}return r}show(){return"undefined"!=typeof window&&window.open(De(this),"luma-debug-texture"),this}log(e=0,t=""){if(e>B.level||"undefined"==typeof window)return this;t=t||"Framebuffer "+this.id;const r=De(this,{targetMaxHeight:100});return B.image({logLevel:e,message:t,image:r},t)(),this}bind({target:e=x.a.FRAMEBUFFER}={}){return this.gl.bindFramebuffer(e,this.handle),this}unbind({target:e=x.a.FRAMEBUFFER}={}){return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,r,n,i){let s=null;return e&&(s=s||{},s[x.a.COLOR_ATTACHMENT0]=new Se(this.gl,{id:this.id+"-color0",pixels:null,format:x.a.RGBA,type:x.a.UNSIGNED_BYTE,width:n,height:i,mipmaps:!1,parameters:{[x.a.TEXTURE_MIN_FILTER]:x.a.LINEAR,[x.a.TEXTURE_MAG_FILTER]:x.a.LINEAR,[x.a.TEXTURE_WRAP_S]:x.a.CLAMP_TO_EDGE,[x.a.TEXTURE_WRAP_T]:x.a.CLAMP_TO_EDGE}}),this.ownResources.push(s[x.a.COLOR_ATTACHMENT0])),t&&r?(s=s||{},s[x.a.DEPTH_STENCIL_ATTACHMENT]=new Fe(this.gl,{id:this.id+"-depth-stencil",format:x.a.DEPTH24_STENCIL8,width:n,height:111}),this.ownResources.push(s[x.a.DEPTH_STENCIL_ATTACHMENT])):t?(s=s||{},s[x.a.DEPTH_ATTACHMENT]=new Fe(this.gl,{id:this.id+"-depth",format:x.a.DEPTH_COMPONENT16,width:n,height:i}),this.ownResources.push(s[x.a.DEPTH_ATTACHMENT])):r&&Z(!1),s}_unattach(e){const t=this.attachments[e];t&&(t instanceof Fe?this.gl.framebufferRenderbuffer(x.a.FRAMEBUFFER,e,x.a.RENDERBUFFER,null):this.gl.framebufferTexture2D(x.a.FRAMEBUFFER,e,x.a.TEXTURE_2D,null,0),delete this.attachments[e])}_attachRenderbuffer({attachment:e=x.a.COLOR_ATTACHMENT0,renderbuffer:t}){const{gl:r}=this;r.framebufferRenderbuffer(x.a.FRAMEBUFFER,e,x.a.RENDERBUFFER,t.handle),this.attachments[e]=t}_attachTexture({attachment:e=x.a.COLOR_ATTACHMENT0,texture:t,layer:r,level:n}){const{gl:i}=this;switch(i.bindTexture(t.target,t.handle),t.target){case x.a.TEXTURE_2D_ARRAY:case x.a.TEXTURE_3D:Object(P.a)(i).framebufferTextureLayer(x.a.FRAMEBUFFER,e,t.target,n,r);break;case x.a.TEXTURE_CUBE_MAP:const s=function(e){return e<x.a.TEXTURE_CUBE_MAP_POSITIVE_X?e+x.a.TEXTURE_CUBE_MAP_POSITIVE_X:e}(r);i.framebufferTexture2D(x.a.FRAMEBUFFER,e,s,t.handle,n);break;case x.a.TEXTURE_2D:i.framebufferTexture2D(x.a.FRAMEBUFFER,e,x.a.TEXTURE_2D,t.handle,n);break;default:Z(!1,"Illegal texture type")}i.bindTexture(t.target,null),this.attachments[e]=t}_setReadBuffer(e){const t=Object(P.c)(this.gl);t?t.readBuffer(e):Z(e===x.a.COLOR_ATTACHMENT0||e===x.a.BACK,"Multiple render targets not supported"),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,r=Object(P.a)(t);if(r)r.drawBuffers(e);else{const r=t.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(e):Z(1===e.length&&(e[0]===x.a.COLOR_ATTACHMENT0||e[0]===x.a.BACK),"Multiple render targets not supported")}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=function(e){e.luma=e.luma||{},e.luma.caps=e.luma.caps||{};for(const t in He)void 0===e.luma.caps[t]&&(e.luma.caps[t]=ke(e,t));return e.luma.caps}(this.gl);switch(e){case x.a.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:return t.WEBGL2?null:0;case x.a.FRAMEBUFFER_ATTACHMENT_RED_SIZE:case x.a.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:case x.a.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:case x.a.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:case x.a.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:case x.a.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:return t.WEBGL2?null:8;case x.a.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:return t.WEBGL2?null:x.a.UNSIGNED_INT;case x.a.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:return t.WEBGL2||t.EXT_sRGB?null:x.a.LINEAR;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(x.a.FRAMEBUFFER,e)}}const we=[x.a.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME,x.a.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE,x.a.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,x.a.FRAMEBUFFER_ATTACHMENT_RED_SIZE,x.a.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE,x.a.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE,x.a.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE,x.a.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE,x.a.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE];xe.ATTACHMENT_PARAMETERS=we;const Ge="TIMER_QUERY";var He={["WEBGL2"]:[!1,!0],["VERTEX_ARRAY_OBJECT"]:["OES_vertex_array_object",!0],[Ge]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],["INSTANCED_RENDERING"]:["ANGLE_instanced_arrays",!0],["MULTIPLE_RENDER_TARGETS"]:["WEBGL_draw_buffers",!0],["ELEMENT_INDEX_UINT32"]:["OES_element_index_uint",!0],["BLEND_EQUATION_MINMAX"]:["EXT_blend_minmax",!0],["FLOAT_BLEND"]:["EXT_float_blend"],["COLOR_ENCODING_SRGB"]:["EXT_sRGB",!0],["TEXTURE_DEPTH"]:["WEBGL_depth_texture",!0],["TEXTURE_FLOAT"]:["OES_texture_float",!0],["TEXTURE_HALF_FLOAT"]:["OES_texture_half_float",!0],["TEXTURE_FILTER_LINEAR_FLOAT"]:["OES_texture_float_linear"],["TEXTURE_FILTER_LINEAR_HALF_FLOAT"]:["OES_texture_half_float_linear"],["TEXTURE_FILTER_ANISOTROPIC"]:["EXT_texture_filter_anisotropic"],["COLOR_ATTACHMENT_RGBA32F"]:[function(e){const t=new Se(e,{format:e.RGBA,type:e.FLOAT,dataFormat:e.RGBA}),r=new xe(e,{id:"test-framebuffer",check:!1,attachments:{[e.COLOR_ATTACHMENT0]:t}}),n=r.getStatus();return t.delete(),r.delete(),n===e.FRAMEBUFFER_COMPLETE},"EXT_color_buffer_float"],["COLOR_ATTACHMENT_FLOAT"]:[!1,"EXT_color_buffer_float"],["COLOR_ATTACHMENT_HALF_FLOAT"]:["EXT_color_buffer_half_float"],["GLSL_FRAG_DATA"]:["WEBGL_draw_buffers",!0],["GLSL_FRAG_DEPTH"]:["EXT_frag_depth",!0],["GLSL_DERIVATIVES"]:["OES_standard_derivatives",!0],["GLSL_TEXTURE_LOD"]:["EXT_shader_texture_lod",!0]};function Ve(e,t){return(t=Array.isArray(t)?t:[t]).every(t=>ke(e,t))}function ke(e,t){return e.luma=e.luma||{},e.luma.caps=e.luma.caps||{},void 0===e.luma.caps[t]&&(e.luma.caps[t]=function(e,t){const r=He[t];let n;Z(r,t);const i=Object(P.e)(e)&&r[1]||r[0];if("function"==typeof i)n=i(e);else if(Array.isArray(i)){n=!0;for(const t of i)n=n&&Boolean(e.getExtension(t))}else"string"==typeof i?n=Boolean(e.getExtension(i)):"boolean"==typeof i?n=i:Z(!1);return n}(e,t)),e.luma.caps[t]||B.log(2,`Feature: ${t} not supported`)(),e.luma.caps[t]}class je extends se{static isSupported(e,t=[]){const r=Object(P.e)(e),n=Ve(e,Ge);let i=r||n;for(const e of t)switch(e){case"queries":i=i&&r;break;case"timers":i=i&&n;break;default:Z(!1)}return i}constructor(e,t={}){super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(35007)}beginOcclusionQuery({conservative:e=!1}={}){return this.begin(e?36202:35887)}beginTransformFeedbackQuery(){return this.begin(35976)}begin(e){return this._queryPending||(this.target=e,this.gl2.beginQuery(this.target,this.handle)),this}end(){return this._queryPending||this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(36795)}getResult(){return this.gl2.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,n)=>{const i=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(i)};requestAnimationFrame(i)}),this._pollingPromise}_createHandle(){return je.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}function Xe(e){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}const We=Object(w.isBrowser)()&&"undefined"!=typeof document;let ze=0;class Ke{constructor(e={}){const{onCreateContext:t=(e=>j(e)),onAddHTML:r=null,onInitialize:n=(()=>{}),onRender:i=(()=>{}),onFinalize:s=(()=>{}),onError:a,gl:o=null,glOptions:u={},debug:c=!1,createFramebuffer:l=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:f=!0,stats:_=$.get("animation-loop-"+ze++)}=e;let{useDevicePixels:E=!0}=e;"useDevicePixelRatio"in e&&(B.deprecated("useDevicePixelRatio","useDevicePixels")(),E=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:r,onInitialize:n,onRender:i,onFinalize:s,onError:a,gl:o,glOptions:u,debug:c,createFramebuffer:l},this.gl=o,this.needsRedraw=null,this.timeline=null,this.stats=_,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:f,useDevicePixels:E}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Z("string"==typeof e),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(e={}){if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=je.isSupported(this.gl,["timers"])?new je(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(e=>{this._running&&(this._addCallbackData(e||{}),!1!==e&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()||(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers()),this}stop(){return this._running&&(this._finalizeCallbackData(),Xe(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(...e){return this.props.onCreateContext(...e)}onInitialize(...e){return this.props.onInitialize(...e)}onRender(...e){return this.props.onRender(...e)}onFinalize(...e){return this.props.onFinalize(...e)}getHTMLControlValue(e,t=1){const r=document.getElementById(e);return r?Number(r.value):t}setViewParameters(){return B.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};Xe(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=We?new Promise((e,t)=>{We&&"complete"===document.readyState?e(document):window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(e){var t;this.display&&this.display.requestAnimationFrame(e)||(t=e,"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60))}_renderFrame(...e){this.display?this.display._renderFrame(...e):this.onRender(...e)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:r}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){"object"==typeof e&&null!==e&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&"undefined"!=typeof OffscreenCanvas&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?X(this.props.gl,e):this.onCreateContext(e),!Object(P.d)(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Object(D.b)(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let r=1;const{canvas:n}=this.gl;return n&&n.clientHeight?r=n.clientWidth/n.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&W(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new xe(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}function Ye(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const $e={number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},array:{validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function Ze(e){let t=qe(e);return"object"===t?e?"type"in e?Object.assign({},e,$e[e.type]):"value"in e?(t=qe(e.value),Object.assign({type:t},e,$e[t])):{type:"object",value:e}:{type:"object",value:null}:Object.assign({type:t,value:e},$e[t])}function qe(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}class Qe{constructor({name:e,vs:t,fs:r,dependencies:n=[],uniforms:i,getUniforms:s,deprecations:a=[],defines:o={},inject:u={},vertexShader:c,fragmentShader:l}){Ye("string"==typeof e),this.name=e,this.vs=t||c,this.fs=r||l,this.getModuleUniforms=s,this.dependencies=n,this.deprecations=this._parseDeprecationDefinitions(a),this.defines=o,this.injections=function(e){const t={vs:{},fs:{}};for(const r in e){let n=e[r];const i=r.slice(0,2);"string"==typeof n&&(n={order:0,injection:n}),t[i][r]=n}return t}(u),i&&(this.uniforms=function(e){const t={};for(const r in e){const n=Ze(e[r]);t[r]=n}return t}(i))}getModuleSource(e){let t;switch(e){case"vs":t=this.vs||"";break;case"fs":t=this.fs||"";break;default:Ye(!1)}return`#define MODULE_${this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_")}\n${t}// END MODULE_${this.name}\n\n`}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),e}_defaultGetUniforms(e={}){const t={},r=this.uniforms;for(const n in r){const i=r[n];n in e&&!i.private?(i.validate&&Ye(i.validate(e[n],i),`${this.name}: invalid ${n}`),t[n]=e[n]):t[n]=i.value}return t}}function Je(e){return et(function e(t,r){return t.map(t=>(t instanceof Qe||(Ye("string"!=typeof t,`Shader module use by name is deprecated. Import shader module '${t}' and use it directly.`),Ye(t.name,"shader module has no name"),(t=new Qe(t)).dependencies=e(t.dependencies)),t))}(e))}function et(e){const t={},r={};return tt({modules:e,level:0,moduleMap:t,moduleDepth:r}),Object.keys(r).sort((e,t)=>r[t]-r[e]).map(e=>t[e])}function tt({modules:e,level:t,moduleMap:r,moduleDepth:n}){if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const i of e)r[i.name]=i,(void 0===n[i.name]||n[i.name]<t)&&(n[i.name]=t);for(const i of e)i.dependencies&&tt({modules:i.dependencies,level:t+1,moduleMap:r,moduleDepth:n})}const rt={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},nt={};Object.keys(rt).forEach(e=>{nt[e]=e});const it={};function st(e,t,r={}){const n=rt[t];if(Ye(n,t),!function(e={}){const t="undefined"!=typeof window&&window.navigator||{},r=e.userAgent||t.userAgent||"",n=-1!==r.indexOf("MSIE "),i=-1!==r.indexOf("Trident/");return n||i}(r))return!0;if(t in it)return it[t];const i=`#extension GL_${n[0]} : ${r.behavior||"enable"}\nvoid main(void) {}`,s=e.createShader(e.VERTEX_SHADER);e.shaderSource(s,i),e.compileShader(s);const a=e.getShaderParameter(s,e.COMPILE_STATUS);return e.deleteShader(s),it[t]=a,a}function at(e,t){const r=rt[t];Ye(r,t);const n=function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}(e)&&r[1]||r[0],i="string"==typeof n?Boolean(e.getExtension(n)):n;return Ye(!1===i||!0===i),i}function ot(e,t){return(t=Array.isArray(t)?t:[t]).every(t=>at(e,t))}const ut={vs:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",fs:"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},ct=/void\s+main\s*\([^)]*\)\s*\{\n?/,lt=/}\n?[^{}]*$/,ht=[];function ft(e,t,r,n=!1){const i="vs"===t;for(const t in r){const n=r[t];n.sort((e,t)=>e.order-t.order),ht.length=n.length;for(let e=0,t=n.length;e<t;++e)ht[e]=n[e].injection;const s=ht.join("\n")+"\n";switch(t){case"vs:#decl":i&&(e=e.replace("__LUMA_INJECT_DECLARATIONS__",s));break;case"vs:#main-start":i&&(e=e.replace(ct,e=>e+s));break;case"vs:#main-end":i&&(e=e.replace(lt,e=>s+e));break;case"fs:#decl":i||(e=e.replace("__LUMA_INJECT_DECLARATIONS__",s));break;case"fs:#main-start":i||(e=e.replace(ct,e=>e+s));break;case"fs:#main-end":i||(e=e.replace(lt,e=>s+e));break;default:e=e.replace(t,e=>e+s)}}return e=e.replace("__LUMA_INJECT_DECLARATIONS__",""),n&&(e=e.replace(/\}\s*$/,e=>e+ut[t])),e}function _t(e){const t={};return Ye(Array.isArray(e)&&e.length>1),e.forEach(e=>{for(const r in e)t[r]=t[r]?`${t[r]}\n${e[r]}`:e[r]}),t}const Et=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],dt=[...Et,[/^[ \t]*attribute[ \t]+(.+;)/gm,"in $1"],[/^[ \t]*varying[ \t]+(.+;)/gm,"out $1"]],At=[...Et,[/^[ \t]*varying[ \t]+(.+;)/gm,"in $1"]],Tt=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],gt=[...Tt,[/^[ \t]*in[ \t]+(.+;)/gm,"attribute $1"],[/^[ \t]*out[ \t]+(.+;)/gm,"varying $1"]],mt=[...Tt,[/^[ \t]*in[ \t]+/gm,"varying "]],Rt=/^[ \t]*out[ \t]+vec4[ \t]+(\w+)[ \t]*;\s+/m;function bt(e,t,r){switch(t){case 300:return pt(e,r?dt:At);case 100:return r?pt(e,gt):function(e){const t=(e=pt(e,mt)).match(Rt);if(t){const r=t[1];e=e.replace(Rt,"").replace(new RegExp(`\\b${r}\\b`,"g"),"gl_FragColor")}return e}(e);default:throw new Error("unknown GLSL version "+t)}}function pt(e,t){for(const[r,n]of t)e=e.replace(r,n);return e}const Nt={vs:"vertex",fs:"fragment"};function St(e,{id:t,source:r,type:n,modules:i,defines:s={},hookFunctions:a=[],inject:o={},transpileToGLSL100:u=!1,prologue:c=!0,log:l}){Ye("string"==typeof r,"shader source must be a string");const h="vs"===n,f=r.split("\n");let _=100,E="",d=r;0===f[0].indexOf("#version ")?(_=300,E=f[0],d=f.slice(1).join("\n")):E="#version "+_;const A={};i.forEach(e=>{Object.assign(A,e.getDefines())}),Object.assign(A,s);let T=c?`${E}\n${function({id:e,source:t,type:r}){return e&&"string"==typeof e&&-1===t.indexOf("SHADER_NAME")?`\n#define SHADER_NAME ${e}_${Nt[r]}\n\n`:""}({id:t,source:r,type:n})}\n${function({type:e}){return`\n#define SHADER_TYPE_${Nt[e].toUpperCase()}\n`}({type:n})}\n${function(e){switch(function(e){const t=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||7936),n=e.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||7937);return{gpuVendor:function(e,t){if(e.match(/NVIDIA/i)||t.match(/NVIDIA/i))return"NVIDIA";if(e.match(/INTEL/i)||t.match(/INTEL/i))return"INTEL";if(e.match(/AMD/i)||t.match(/AMD/i)||e.match(/ATI/i)||t.match(/ATI/i))return"AMD";return"UNKNOWN GPU"}(r,n),vendor:r,renderer:n,version:e.getParameter(7938),shadingLanguageVersion:e.getParameter(35724)}}(e).gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${function(e,t,r){let n="#if (__VERSION__ > 120)\n\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n\n// DEPRECATED FLAGS, remove in v9\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return ot(e,nt.GLSL_FRAG_DEPTH)&&(n+="\n// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),ot(e,nt.GLSL_DERIVATIVES)&&st(e,nt.GLSL_DERIVATIVES)&&(n+="\n// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n# define DERIVATIVES\n#endif\n"),ot(e,nt.GLSL_FRAG_DATA)&&st(e,nt.GLSL_FRAG_DATA,{behavior:"require"})&&(n+="\n// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define FEATURE_GLSL_DRAW_BUFFERS\n#define DRAW_BUFFERS\n#endif\n"),ot(e,nt.GLSL_TEXTURE_LOD)&&(n+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n\n#endif\n"),n}(e)}\n${function(e={}){let t=0,r="";for(const n in e){0===t&&(r+="\n// APPLICATION DEFINES\n"),t++;const i=e[n];(i||Number.isFinite(i))&&(r+=`#define ${n.toUpperCase()} ${e[n]}\n`)}0===t&&(r+="\n");return r}(A)}\n${h?"":"precision highp float;\n\n"}\n`:E+"\n";const g=function(e){const t={vs:{},fs:{}};return e.forEach(e=>{let r;"string"!=typeof e?(r=e,e=r.hook):r={},e=e.trim();const[n,i]=e.split(":"),s=e.replace(/\(.+/,"");t[n][s]=Object.assign(r,{signature:i})}),t}(a),m={},R={},b={};for(const e in o){const t="string"==typeof o[e]?{injection:o[e],order:0}:o[e],r=e.match(/^(v|f)s:(#)?([\w-]+)$/);if(r){const n=r[2],i=r[3];n?"decl"===i?R[e]=[t]:b[e]=[t]:m[e]=[t]}else b[e]=[t]}for(const e of i){l&&e.checkDeprecations(d,l);T+=e.getModuleSource(n,_);const t=e.injections[n];for(const e in t){const r=e.match(/^(v|f)s:#([\w-]+)$/);if(r){const n="decl"===r[2]?R:b;n[e]=n[e]||[],n[e].push(t[e])}else m[e]=m[e]||[],m[e].push(t[e])}}return T+="\n\n__LUMA_INJECT_DECLARATIONS__\n\n",T=ft(T,n,R),T+=function(e,t){let r="";for(const n in e){const i=e[n];if(r+=`void ${i.signature} {\n`,i.header&&(r+="  "+i.header),t[n]){const e=t[n];e.sort((e,t)=>e.order-t.order);for(const t of e)r+=`  ${t.injection}\n`}i.footer&&(r+="  "+i.footer),r+="}\n"}return r}(g[n],m),T+=d,T=ft(T,n,b),T=bt(T,u?100:_,h),T}function Ot(e){return function(t){const r={};for(const n of e){const e=n.getUniforms(t,r);Object.assign(r,e)}return r}}const It={[x.a.FLOAT]:Ht.bind(null,"uniform1fv",vt,1,Vt),[x.a.FLOAT_VEC2]:Ht.bind(null,"uniform2fv",vt,2,Vt),[x.a.FLOAT_VEC3]:Ht.bind(null,"uniform3fv",vt,3,Vt),[x.a.FLOAT_VEC4]:Ht.bind(null,"uniform4fv",vt,4,Vt),[x.a.INT]:Ht.bind(null,"uniform1iv",Bt,1,Vt),[x.a.INT_VEC2]:Ht.bind(null,"uniform2iv",Bt,2,Vt),[x.a.INT_VEC3]:Ht.bind(null,"uniform3iv",Bt,3,Vt),[x.a.INT_VEC4]:Ht.bind(null,"uniform4iv",Bt,4,Vt),[x.a.BOOL]:Ht.bind(null,"uniform1iv",Bt,1,Vt),[x.a.BOOL_VEC2]:Ht.bind(null,"uniform2iv",Bt,2,Vt),[x.a.BOOL_VEC3]:Ht.bind(null,"uniform3iv",Bt,3,Vt),[x.a.BOOL_VEC4]:Ht.bind(null,"uniform4iv",Bt,4,Vt),[x.a.FLOAT_MAT2]:Ht.bind(null,"uniformMatrix2fv",vt,4,kt),[x.a.FLOAT_MAT3]:Ht.bind(null,"uniformMatrix3fv",vt,9,kt),[x.a.FLOAT_MAT4]:Ht.bind(null,"uniformMatrix4fv",vt,16,kt),[x.a.SAMPLER_2D]:Gt,[x.a.SAMPLER_CUBE]:Gt,[x.a.UNSIGNED_INT]:Ht.bind(null,"uniform1uiv",Pt,1,Vt),[x.a.UNSIGNED_INT_VEC2]:Ht.bind(null,"uniform2uiv",Pt,2,Vt),[x.a.UNSIGNED_INT_VEC3]:Ht.bind(null,"uniform3uiv",Pt,3,Vt),[x.a.UNSIGNED_INT_VEC4]:Ht.bind(null,"uniform4uiv",Pt,4,Vt),[x.a.FLOAT_MAT2x3]:Ht.bind(null,"uniformMatrix2x3fv",vt,6,kt),[x.a.FLOAT_MAT2x4]:Ht.bind(null,"uniformMatrix2x4fv",vt,8,kt),[x.a.FLOAT_MAT3x2]:Ht.bind(null,"uniformMatrix3x2fv",vt,6,kt),[x.a.FLOAT_MAT3x4]:Ht.bind(null,"uniformMatrix3x4fv",vt,12,kt),[x.a.FLOAT_MAT4x2]:Ht.bind(null,"uniformMatrix4x2fv",vt,8,kt),[x.a.FLOAT_MAT4x3]:Ht.bind(null,"uniformMatrix4x3fv",vt,12,kt),[x.a.SAMPLER_2D]:Gt,[x.a.SAMPLER_CUBE]:Gt,[x.a.SAMPLER_3D]:Gt,[x.a.SAMPLER_2D_SHADOW]:Gt,[x.a.SAMPLER_2D_ARRAY]:Gt,[x.a.SAMPLER_2D_ARRAY_SHADOW]:Gt,[x.a.SAMPLER_CUBE_SHADOW]:Gt,[x.a.INT_SAMPLER_2D]:Gt,[x.a.INT_SAMPLER_3D]:Gt,[x.a.INT_SAMPLER_CUBE]:Gt,[x.a.INT_SAMPLER_2D_ARRAY]:Gt,[x.a.UNSIGNED_INT_SAMPLER_2D]:Gt,[x.a.UNSIGNED_INT_SAMPLER_3D]:Gt,[x.a.UNSIGNED_INT_SAMPLER_CUBE]:Gt,[x.a.UNSIGNED_INT_SAMPLER_2D_ARRAY]:Gt},Ft={},yt={},Lt={},Ct=[0];function Mt(e,t,r,n){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(Ct[0]=e,e=Ct);const i=e.length;if(i%t&&B.warn("Uniform size should be multiples of "+t,e)(),e instanceof r)return e;let s=n[i];s||(s=new r(i),n[i]=s);for(let t=0;t<i;t++)s[t]=e[t];return s}function vt(e,t){return Mt(e,t,Float32Array,Ft)}function Bt(e,t){return Mt(e,t,Int32Array,yt)}function Pt(e,t){return Mt(e,t,Uint32Array,Lt)}function Dt(e,t,r){const n=It[r.type];if(!n)throw new Error("Unknown GLSL uniform type "+r.type);return n().bind(null,e,t)}function Ut(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=e.match(/([^[]*)(\[[0-9]+\])?/);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name "+e);return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}}function xt(e){return Array.isArray(e)||ArrayBuffer.isView(e)?function(e){if(0===e.length)return!1;const t=Math.min(e.length,16);for(let r=0;r<t;++r)if(!Number.isFinite(e[r]))return!1;return!0}(e):!!isFinite(e)||(!0===e||!1===e||(e instanceof pe||(e instanceof Fe||e instanceof xe&&Boolean(e.texture))))}function wt(e,t,r){if(Array.isArray(r)||ArrayBuffer.isView(r))if(e[t]){const n=e[t];for(let e=0,t=r.length;e<t;++e)n[e]=r[e]}else e[t]=r.slice();else e[t]=r}function Gt(){let e=null;return(t,r,n)=>{const i=e!==n;return i&&(t.uniform1i(r,n),e=n),i}}function Ht(e,t,r,n){let i=null,s=null;return(a,o,u)=>{const c=t(u,r),l=c.length;let h=!1;if(null===i)i=new Float32Array(l),s=l,h=!0;else{Z(s===l,"Uniform length cannot change.");for(let e=0;e<l;++e)if(c[e]!==i[e]){h=!0;break}}return h&&(n(a,e,o,c),i.set(c)),h}}function Vt(e,t,r,n){e[t](r,n)}function kt(e,t,r,n){e[t](r,!1,n)}function jt(e,t="unnamed"){const r=e.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return r?r[1]:t}function Xt(e,t,r,n){const i=e.split(/\r?\n/),s={},a={},o=n||jt(t)||"(unnamed)",u=`${function(e){switch(e){case 35632:return"fragment";case 35633:return"vertex";default:return"unknown type"}}(r)} shader ${o}`;for(let t=0;t<i.length;t++){const r=i[t];if(r.length<=1)continue;const n=r.split(":"),o=n[0],c=parseInt(n[2],10);if(isNaN(c))throw new Error(`GLSL compilation error in ${u}: ${e}`);"WARNING"!==o?s[c]=r:a[c]=r}const c=function(e,t=1,r=": "){const n=e.split(/\r?\n/),i=String(n.length+t-1).length;return n.map((e,n)=>{const s=String(n+t),a=s.length;return zt(s,i-a)+r+e})}(t);return{shaderName:u,errors:Wt(s,c),warnings:Wt(a,c)}}function Wt(e,t){let r="";for(let n=0;n<t.length;n++){const i=t[n];if((e[n+3]||e[n+2]||e[n+1])&&(r+=i+"\n",e[n+1])){const t=e[n+1],i=t.split(":",3),s=i[0],a=parseInt(i[1],10)||0;r+=zt(`^^^ ${s}: ${t.substring(i.join(":").length+1).trim()}\n\n`,a)}}return r}function zt(e,t){let r="";for(let e=0;e<t;++e)r+=" ";return`${r}${e}`}class Kt extends se{static getTypeName(e){switch(e){case x.a.VERTEX_SHADER:return"vertex-shader";case x.a.FRAGMENT_SHADER:return"fragment-shader";default:return Z(!1),"unknown"}}constructor(e,t){Object(P.b)(e),Z("string"==typeof t.source,"Shader: GLSL source code must be a JavaScript string");super(e,{id:jt(t.source,null)||t.id||ee("unnamed "+Kt.getTypeName(t.shaderType))}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize({source:e}){const t=jt(e,null);t&&(this.id=ee(t)),this._compile(e)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return`${Kt.getTypeName(this.shaderType)}:${this.id}`}getName(){return jt(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(e=this.source){e.startsWith("#version ")||(e="#version 100\n"+e),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle);if(!this.getParameter(x.a.COMPILE_STATUS)){const e=this.gl.getShaderInfoLog(this.handle),{shaderName:t,errors:r,warnings:n}=Xt(e,this.source,this.shaderType,this.id);throw B.error(`GLSL compilation errors in ${t}\n${r}`)(),B.warn(`GLSL compilation warnings in ${t}\n${n}`)(),new Error("GLSL compilation errors in "+t)}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(x.a.SHADER_TYPE),source:this.getSource()}}}class Yt extends Kt{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:x.a.VERTEX_SHADER}))}_createHandle(){return this.gl.createShader(x.a.VERTEX_SHADER)}}class $t extends Kt{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:x.a.FRAGMENT_SHADER}))}_createHandle(){return this.gl.createShader(x.a.FRAGMENT_SHADER)}}const Zt={5126:[5126,1,"float"],35664:[5126,2,"vec2"],35665:[5126,3,"vec3"],35666:[5126,4,"vec4"],5124:[5124,1,"int"],35667:[5124,2,"ivec2"],35668:[5124,3,"ivec3"],35669:[5124,4,"ivec4"],5125:[5125,1,"uint"],36294:[5125,2,"uvec2"],36295:[5125,3,"uvec3"],36296:[5125,4,"uvec4"],35670:[5126,1,"bool"],35671:[5126,2,"bvec2"],35672:[5126,3,"bvec3"],35673:[5126,4,"bvec4"],35674:[5126,8,"mat2"],35685:[5126,8,"mat2x3"],35686:[5126,8,"mat2x4"],35675:[5126,12,"mat3"],35687:[5126,12,"mat3x2"],35688:[5126,12,"mat3x4"],35676:[5126,16,"mat4"],35689:[5126,16,"mat4x2"],35690:[5126,16,"mat4x3"]};function qt(e){switch(e){case 0:return 0;case 1:case 3:case 2:return 1;case 4:case 5:case 6:return 4;default:return Z(!1),0}}function Qt(e){const t=Zt[e];if(!t)return null;const[r,n]=t;return{type:r,components:n}}function Jt(e,t){switch(e){case 5120:case 5121:case 5122:case 5123:e=5126}for(const r in Zt){const[n,i,s]=Zt[r];if(n===e&&i===t)return{glType:r,name:s}}return null}class er{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,r=t.getProgramParameter(e.handle,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const{name:r,type:i,size:s}=t.getActiveAttrib(e.handle,n),a=t.getAttribLocation(e.handle,r);a>=0&&this._addAttribute(a,r,i,s)}this.attributeInfos.sort((e,t)=>e.location-t.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!Object(P.e)(t))return;const r=t.getProgramParameter(e.handle,t.TRANSFORM_FEEDBACK_VARYINGS);for(let n=0;n<r;n++){const{name:r,type:i,size:s}=t.getTransformFeedbackVarying(e.handle,n);this._addVarying(n,r,i,s)}this.varyingInfos.sort((e,t)=>e.location-t.location)}_addAttribute(e,t,r,n){const{type:i,components:s}=Qt(r),a={type:i,size:n*s};this._inferProperties(e,t,a);const o={location:e,name:t,accessor:new fe(a)};this.attributeInfos.push(o),this.attributeInfosByLocation[e]=o,this.attributeInfosByName[o.name]=o}_inferProperties(e,t,r){/instance/i.test(t)&&(r.divisor=1)}_addVarying(e,t,r,n){const{type:i,components:s}=Qt(r),a={location:e,name:t,accessor:new fe({type:i,size:n*s})};this.varyingInfos.push(a),this.varyingInfosByName[a.name]=a}}const tr=35981,rr=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class nr extends se{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Program","v6.0",rr),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(e={}){const{hash:t,vs:r,fs:n,varyings:i,bufferMode:s=tr}=e;return this.hash=t||"",this.vs="string"==typeof r?new Yt(this.gl,{id:e.id+"-vs",source:r}):r,this.fs="string"==typeof n?new $t(this.gl,{id:e.id+"-fs",source:n}):n,Z(this.vs instanceof Yt),Z(this.fs instanceof $t),this.uniforms={},this._textureUniforms={},i&&i.length>0&&(Object(P.a)(this.gl),this.varyings=i,this.gl2.transformFeedbackVaryings(this.handle,i,s)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new er(this),this.setProps(e)}delete(e={}){return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw({logPriority:e,drawMode:t=x.a.TRIANGLES,vertexCount:r,offset:n=0,start:i,end:s,isIndexed:a=!1,indexType:o=x.a.UNSIGNED_SHORT,instanceCount:u=0,isInstanced:c=u>0,vertexArray:l=null,transformFeedback:h,framebuffer:f,parameters:_={},uniforms:E,samplers:d}){if((E||d)&&(B.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(E||{})),B.priority>=e){const n=f?f.id:"default",i=`mode=${Q(this.gl,t)} verts=${r} instances=${u} indexType=${Q(this.gl,o)} isInstanced=${c} isIndexed=${a} Framebuffer=`+n;B.log(e,i)()}return Z(l),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===r||c&&0===u)&&(l.bindForDraw(r,u,()=>{if(void 0!==f&&(_=Object.assign({},_,{framebuffer:f})),h){const e=qt(t);h.begin(e)}this._bindTextures(),Object(D.d)(this.gl,_,()=>{a&&c?this.gl2.drawElementsInstanced(t,r,o,n,u):a&&Object(P.e)(this.gl)&&!isNaN(i)&&!isNaN(s)?this.gl2.drawRangeElements(t,i,s,r,o,n):a?this.gl.drawElements(t,r,o,n):c?this.gl2.drawArraysInstanced(t,n,r,u):this.gl.drawArrays(t,n,r)}),h&&h.end()}),!0)}setUniforms(e={}){B.priority>=2&&function(e,t,r){for(const n in e){const i=e[n];if((!r||Boolean(r[n]))&&!xt(i))throw t=t?t+" ":"",console.error(`${t} Bad uniform ${n}`,i),new Error(`${t} Bad uniform ${n}`)}}(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const r=e[t],n=this._uniformSetters[t];if(n){let e=r,i=!1;if(e instanceof xe&&(e=e.texture),e instanceof pe)if(i=this.uniforms[t]!==r,i){void 0===n.textureIndex&&(n.textureIndex=this._textureIndexCounter++);const r=e,{textureIndex:i}=n;r.bind(i),e=i,this._textureUniforms[t]=r}else e=n.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(n(e)||i)&&wt(this.uniforms,t,r)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const r=this._textureUniforms[t];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),r={};for(const e of t){switch(this.gl.getShaderParameter(this.handle,x.a.SHADER_TYPE)){case x.a.VERTEX_SHADER:r.vs=new Yt({handle:e});break;case x.a.FRAGMENT_SHADER:r.fs=new $t({handle:e})}}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const e=this._getName();this.id=ee(e)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?e+"-program":"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),B.time(4,"linkProgram for "+this._getName())(),e.linkProgram(this.handle),B.timeEnd(4,"linkProgram for "+this._getName())(),e.debug||B.level>0){if(!e.getProgramParameter(this.handle,e.LINK_STATUS))throw new Error("Error linking: "+e.getProgramInfoLog(this.handle));e.validateProgram(this.handle);if(!e.getProgramParameter(this.handle,e.VALIDATE_STATUS))throw new Error("Error validating: "+e.getProgramInfoLog(this.handle))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(x.a.ACTIVE_UNIFORMS);for(let t=0;t<this._uniformCount;t++){const r=this.gl.getActiveUniform(this.handle,t),{name:n}=Ut(r.name);let i=e.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=Dt(e,i,r),r.size>1)for(let t=0;t<r.size;t++)i=e.getUniformLocation(this.handle,`${n}[${t}]`),this._uniformSetters[`${n}[${t}]`]=Dt(e,i,r)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}class ir{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new ir(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(e={}){const{vs:t="",fs:r="",defines:n={},inject:i={},varyings:s=[],bufferMode:a=35981,transpileToGLSL100:o=!1}=e,u=this._getModuleList(e.modules),c=this._getHash(t),l=this._getHash(r),h=u.map(e=>this._getHash(e.name)).sort(),f=s.map(e=>this._getHash(e)),_=Object.keys(n).sort(),E=Object.keys(i).sort(),d=[],A=[];for(const e of _)d.push(this._getHash(e)),d.push(this._getHash(n[e]));for(const e of E)A.push(this._getHash(e)),A.push(this._getHash(i[e]));const T=`${c}/${l}D${d.join("/")}M${h.join("/")}I${A.join("/")}V${f.join("/")}H${this.stateHash}B${a}${o?"T":""}`;if(!this._programCache[T]){const e=function(e,t){const{vs:r,fs:n}=t,i=Je(t.modules||[]);return{gl:e,vs:St(e,Object.assign({},t,{source:r,type:"vs",modules:i})),fs:St(e,Object.assign({},t,{source:n,type:"fs",modules:i})),getUniforms:Ot(i)}}(this.gl,{vs:t,fs:r,modules:u,inject:i,defines:n,hookFunctions:this._hookFunctions,transpileToGLSL100:o});this._programCache[T]=new nr(this.gl,{hash:T,vs:e.vs,fs:e.fs,varyings:s,bufferMode:a}),this._getUniforms[T]=e.getUniforms||(e=>{}),this._useCounts[T]=0}return this._useCounts[T]++,this._programCache[T]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,0===this._useCounts[t]&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let n=0;for(let e=0,i=this._defaultModules.length;e<i;++e){const i=this._defaultModules[e],s=i.name;t[n++]=i,r[s]=!0}for(let i=0,s=e.length;i<s;++i){const s=e[i],a=s.name;r[a]||(t[n++]=s,r[a]=!0)}return t.length=n,t}}let sr=null;function ar(e,t){var r;return new e((r=e.BYTES_PER_ELEMENT*t,(!sr||sr.byteLength<r)&&(sr=new ArrayBuffer(r)),sr),0,t)}var or=r(22);class ur extends se{static isSupported(e,t={}){return!t.constantAttributeZero||(Object(P.e)(e)||"Chrome"===function(e){if(!e&&!Object(l.a)())return"Node";if(Object(or.a)(e))return"Electron";var t="undefined"!=typeof navigator?navigator:{},r=e||t.userAgent||"";if(r.indexOf("Edge")>-1)return"Edge";var n=-1!==r.indexOf("MSIE "),i=-1!==r.indexOf("Trident/");return n||i?"IE":b.b.chrome?"Chrome":b.b.safari?"Safari":b.b.mozInnerScreenX?"Firefox":"Unknown"}())}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new ur(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return ur.MAX_ATTRIBUTES=ur.MAX_ATTRIBUTES||e.getParameter(e.MAX_VERTEX_ATTRIBS),ur.MAX_ATTRIBUTES}static setConstant(e,t,r){switch(r.constructor){case Float32Array:ur._setConstantFloatArray(e,t,r);break;case Int32Array:ur._setConstantIntArray(e,t,r);break;case Uint32Array:ur._setConstantUintArray(e,t,r);break;default:Z(!1)}}constructor(e,t={}){const r=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return ur.getMaxAttributes(this.gl)}initialize(e={}){return this.setProps(e)}setProps(e){return this}setElementBuffer(e=null,t={}){return Z(!e||e.target===x.a.ELEMENT_ARRAY_BUFFER,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind(()=>{this.gl.bindBuffer(x.a.ELEMENT_ARRAY_BUFFER,e?e.handle:null)}),this}setBuffer(e,t,r){if(t.target===x.a.ELEMENT_ARRAY_BUFFER)return this.setElementBuffer(t,r);const{size:n,type:i,stride:s,offset:a,normalized:o,integer:u,divisor:c}=r,{gl:l,gl2:h}=this;return e=Number(e),this.bind(()=>{l.bindBuffer(l.ARRAY_BUFFER,t.handle),u?(Z(Object(P.e)(l)),h.vertexAttribIPointer(e,n,i,s,a)):l.vertexAttribPointer(e,n,i,o,s,a),l.enableVertexAttribArray(e),h.vertexAttribDivisor(e,c||0)}),this}enable(e,t=!0){return!t&&0===e&&!ur.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){const r=this._normalizeConstantArrayValue(t),n=r.byteLength*e,i=r.length*e;let s=!this.buffer;if(this.buffer=this.buffer||new Ae(this.gl,n),s=s||this.buffer.reallocate(n),s=s||!this._compareConstantArrayValues(r,this.bufferValue),s){const e=ar(t.constructor,i);!function({target:e,source:t,start:r=0,count:n=1}){const i=t.length,s=n*i;let a=0;for(let n=r;a<i;a++)e[n++]=t[a];for(;a<s;)a<s-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+s-a),a=s)}({target:e,source:r,start:0,count:i}),this.buffer.subData(e),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}static _setConstantFloatArray(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:Z(!1)}}static _setConstantIntArray(e,t,r){switch(Z(Object(P.e)(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:Z(!1)}}static _setConstantUintArray(e,t,r){switch(Z(Object(P.e)(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:Z(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,{location:t}){return Z(Number.isFinite(t)),this.bind(()=>{switch(e){case x.a.VERTEX_ATTRIB_ARRAY_POINTER:return this.gl.getVertexAttribOffset(t,e);default:return this.gl.getVertexAttrib(t,e)}})}}const cr=/^(.+)__LOCATION_([0-9]+)$/,lr=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class hr{constructor(e,t={}){const r=t.id||t.program&&t.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new ur(e),ne(this,"VertexArray","v6.0",lr),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(e={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const r=e[t];this._setAttribute(t,r)}this.gl.bindBuffer(x.a.ARRAY_BUFFER,null)}),this}setElementBuffer(e=null,t={}){return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t,r={}){if(t.target===x.a.ELEMENT_ARRAY_BUFFER)return this.setElementBuffer(t,r);const{location:n,accessor:i}=this._resolveLocationAndAccessor(e,t,t.accessor,r);return n>=0&&(this.values[n]=t,this.accessors[n]=i,this.clearDrawParams(),this.vertexArrayObject.setBuffer(n,t,i)),this}setConstant(e,t,r={}){const{location:n,accessor:i}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},r));return n>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[n]=t,this.accessors[n]=i,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Ae(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Ae&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(x.a.ARRAY_BUFFER,this.buffer.handle),this.gl.vertexAttribPointer(e,1,x.a.FLOAT,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof Ae&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,r){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),n=r()}),n}_resolveLocationAndAccessor(e,t,r,n){const i={location:-1,accessor:null},{location:s,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(s)||s<0)return this.unused[e]=t,B.once(3,()=>`unused value ${e} in ${this.id}`)(),i;const o=this._getAttributeInfo(a||s);if(!o)return i;const u=this.accessors[s]||{},c=fe.resolve(o.accessor,u,r,n),{size:l,type:h}=c;return Z(Number.isFinite(l)&&Number.isFinite(h)),{location:s,accessor:c}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const r=cr.exec(e),n=r?r[1]:e,i=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+i,name:n}:{location:-1}}_setAttribute(e,t){if(t instanceof Ae)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof Ae){const r=t[0],n=t[1];this.setBuffer(e,r,n)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const r=t;this.setConstant(e,r)}else{if(!(t.buffer instanceof Ae))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");{const r=t;this.setBuffer(e,r.buffer,r)}}}_setConstantAttributes(e,t){const r=Math.max(0|e,0|t);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,r);for(let e=1;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)n=this.values[e],ArrayBuffer.isView(n)&&this._setConstantAttribute(e,n)}_setConstantAttributeZero(e,t){if(ur.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,e);const r=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,t){ur.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const r=this.values[t],n=this.accessors[t];if(!r)return;const{divisor:i}=n,s=i>0;if(e.isInstanced=e.isInstanced||s,r instanceof Ae){const t=r;if(s){const r=t.getVertexCount(n);e.instanceCount=Math.min(e.instanceCount,r)}else{const r=t.getVertexCount(n);e.vertexCount=Math.min(e.vertexCount,r)}}}setElements(e=null,t={}){return B.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}class fr extends se{static isSupported(e){return Object(P.e)(e)}constructor(e,t={}){Object(P.a)(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(e={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,re(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(e={}){return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:n,byteSize:i,byteOffset:s}=this._getBufferParams(t);return r<0?(this.unused[e]=n,B.warn(()=>`${this.id} unused varying buffer ${e}`)(),this):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,n,s,i),this)}begin(e=x.a.POINTS){return this.gl.bindTransformFeedback(x.a.TRANSFORM_FEEDBACK,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(x.a.TRANSFORM_FEEDBACK,null),this}_getBufferParams(e){let t,r,n;return e instanceof Ae==!1?(n=e.buffer,r=e.byteSize,t=e.byteOffset):n=e,void 0===t&&void 0===r||(t=t||0,r=r||n.byteLength-t),{buffer:n,byteOffset:t,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:r,byteOffset:n}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,n,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t,r=0,n){const i=t&&t.handle;return i&&void 0!==n?this.gl.bindBufferRange(x.a.TRANSFORM_FEEDBACK_BUFFER,e,i,r,n):this.gl.bindBufferBase(x.a.TRANSFORM_FEEDBACK_BUFFER,e,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(x.a.TRANSFORM_FEEDBACK,this.handle)}}function _r(e,t={}){const{isInteger:r=!1}=t;if(Array.isArray(e)||ArrayBuffer.isView(e))return function(e,t){const{maxElts:r=16,size:n=1}=t;let i="[";for(let s=0;s<e.length&&s<r;++s)s>0&&(i+=","+(s%n==0?" ":"")),i+=_r(e[s],t);return`${i}${e.length>r?"...":"]"}`}(e,t);if(!Number.isFinite(e))return String(e);if(Math.abs(e)<1e-16)return r?"0":"0.";if(r)return e.toFixed(0);if(Math.abs(e)>100&&Math.abs(e)<1e4)return e.toFixed(0);const n=e.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function Er(e,t,r,n){const{gl:i}=e;if(!t)return{[n]:"null","Format ":"N/A"};let s,a,o,u="NOT PROVIDED",c=1,l=0,h=0;if(r&&(u=r.type,c=r.size,u=String(u).replace("Array",""),s=-1!==u.indexOf("nt")),t instanceof Ae){const e=t,{data:f,changed:_}=e.getDebugData();let E;if(a=_?"*":"",o=f,h=e.byteLength,l=h/f.BYTES_PER_ELEMENT/c,r){E=`${r.divisor>0?"I ":"P "} ${l} (x${c}=${h} bytes ${Q(i,u)})`}else s=!0,E=h+" bytes";return{[n]:`${a}${_r(o,{size:c,isInteger:s})}`,"Format ":E}}return o=t,c=t.length,u=String(t.constructor.name).replace("Array",""),s=-1!==u.indexOf("nt"),{[n]:_r(o,{size:c,isInteger:s})+" (constant)","Format ":`${c}x${u} (constant)`}}function dr(e,t){const{type:r,size:n}=t,i=Jt(r,n);return i?`${e} (${i.name})`:e}function Ar({header:e="Uniforms",program:t,uniforms:r,undefinedOnly:n=!1}){Z(t);const i=t._uniformSetters,s={},a=Object.keys(i).sort();let o=0;for(const t of a)t.match(".*_.*")||t.match(".*Matrix")||Tr({table:s,header:e,uniforms:r,uniformName:t,undefinedOnly:n})&&o++;for(const t of a)t.match(".*Matrix")&&Tr({table:s,header:e,uniforms:r,uniformName:t,undefinedOnly:n})&&o++;for(const t of a)s[t]||Tr({table:s,header:e,uniforms:r,uniformName:t,undefinedOnly:n})&&o++;let u=0;const c={};if(!n)for(const t in r){const n=r[t];s[t]||(u++,c[t]={Type:"NOT USED: "+n,[e]:_r(n)})}return{table:s,count:o,unusedTable:c,unusedCount:u}}function Tr({table:e,header:t,uniforms:r,uniformName:n,undefinedOnly:i}){const s=r[n],a=function(e){return null!=e}(s);return(!i||!a)&&(e[n]={[t]:a?_r(s):"N/A","Uniform Type":a?s:"NOT PROVIDED"},!0)}function gr(e){const{type:t,size:r}=e.accessor,n=Jt(t,r);return n?`${n.name} ${e.name}`:e.name}const mr={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Rr(e,t){const{attributeMap:r=mr}=t||{};return r&&r[e]||e}function br(e,t){let r;switch(e){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":r="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":r="vectors"}switch(r){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2}Z(Number.isFinite(t.size),`attribute ${e} needs size`)}const pr=()=>{},Nr={};class Sr{constructor(e,t={}){const{id:r=ee("model")}=t;Z(Object(P.d)(e)),this.id=r,this.gl=e,this.id=t.id||ee("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||ir.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:r,fs:n,modules:i,defines:s,inject:a,varyings:o,bufferMode:u,transpileToGLSL100:c}=e;this.programProps={program:t,vs:r,fs:n,modules:i,defines:s,inject:a,varyings:o,bufferMode:u,transpileToGLSL100:c},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=void 0!==e.drawMode?e.drawMode:x.a.TRIANGLES,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Z(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:r,fs:n,modules:i,defines:s,inject:a,varyings:o,bufferMode:u,transpileToGLSL100:c}=e;this.programProps={program:t,vs:r,fs:n,modules:i,defines:s,inject:a,varyings:o,bufferMode:u,transpileToGLSL100:c},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Z(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Z(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(e,t,r){const n={};let i=t.indices;for(const s in t.attributes){const a=t.attributes[s],o=Rr(s,r);if("indices"===s)i=a;else if(a.constant)n[o]=a.value;else{const t=a.value,r={...a};delete r.value,n[o]=[new Ae(e,t),r],br(s,r)}}if(i){const t=i.value||i;Z(t instanceof Uint16Array||t instanceof Uint32Array,'attribute array for "indices" must be of integer type');const r={size:1,isIndexed:void 0===i.isIndexed||i.isIndexed};n.indices=[new Ae(e,{data:t,target:x.a.ELEMENT_ARRAY_BUFFER}),r]}return n}(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(e={}){if(re(e))return this;const t={};for(const r in e){const n=e[r];t[r]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(t),this}setUniforms(e={}){return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return ye(this.program.gl,e),this}draw(e={}){this._checkProgram();const{moduleSettings:t=null,framebuffer:r,uniforms:n={},attributes:i={},transformFeedback:s=this.transformFeedback,parameters:a={},vertexArray:o=this.vertexArray}=e;let u;this.setAttributes(i),this.updateModuleSettings(t),this.setUniforms(n),B.priority>=2&&(u=this._logDrawCallStart(2));const c=this.vertexArray.getDrawParams(),{isIndexed:l=c.isIndexed,indexType:h=c.indexType,indexOffset:f=c.indexOffset,vertexArrayInstanced:_=c.isInstanced}=this.props;_&&!this.isInstanced&&B.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:E,instanceCount:d}=this,{onBeforeRender:A=pr,onAfterRender:T=pr}=this.props;A(),this.program.setUniforms(this.uniforms);const g=this.program.draw(Object.assign(Nr,e,{logPriority:u,uniforms:null,framebuffer:r,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:o,transformFeedback:s,isIndexed:l,indexType:h,isInstanced:E,instanceCount:d,offset:l?f:0}));return T(),B.priority>=2&&this._logDrawCallEnd(u,o,r),g}transform(e={}){const{discard:t=!0,feedbackBuffers:r,unbindModels:n=[]}=e;let{parameters:i}=e;r&&this._setFeedbackBuffers(r),t&&(i=Object.assign({},i,{[x.a.RASTERIZER_DISCARD]:t})),n.forEach(e=>e.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:i}))}finally{n.forEach(e=>e.vertexArray.bindBuffers())}return this}render(e={}){return B.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:e}=this.programProps;if(e)this._managedProgram=!1;else{const{vs:t,fs:r,modules:n,inject:i,defines:s,varyings:a,bufferMode:o,transpileToGLSL100:u}=this.programProps;e=this.programManager.get({vs:t,fs:r,modules:n,inject:i,defines:s,varyings:a,bufferMode:o,transpileToGLSL100:u}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Z(e instanceof nr,"Model needs a program"),this._programDirty=!1,e!==this.program&&(this.program=e,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new hr(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof Ae&&t.delete()}}_setAnimationProps(e){this.animated&&Z(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(e={}){if(re(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new fr(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:1e4;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),B.group(2,">>> DRAWING MODEL "+this.id,{collapsed:B.level<=2})(),e}_logDrawCallEnd(e,t,r,n){if(void 0===e)return;const i=function({vertexArray:e,header:t="Attributes"}){if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=Er(e,e.elements,null,t));const n=e.values;for(const i in n){const s=e._getAttributeInfo(i);if(s){let a=`${i}: ${s.name}`;const o=e.accessors[s.location];o&&(a=`${i}: ${dr(s.name,o)}`),r[a]=Er(e,n[i],o,t)}}return r}({vertexArray:t,header:this.id+" attributes",attributes:this._attributes}),{table:s,unusedTable:a,unusedCount:o}=Ar({header:this.id+" uniforms",program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:u,count:c}=Ar({header:this.id+" uniforms",program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});c>0&&B.log("MISSING UNIFORMS",Object.keys(u))(),o>0&&B.log("UNUSED UNIFORMS",Object.keys(a))();const l=function(e){const t={},r="Accessors for "+e.id;for(const n of e.attributeInfos)if(n){t["in "+gr(n)]={[r]:JSON.stringify(n.accessor)}}for(const n of e.varyingInfos)if(n){t["out "+gr(n)]={[r]:JSON.stringify(n.accessor)}}return t}(this.vertexArray.configuration);B.table(e,i)(),B.table(e,s)(),B.table(e+1,l)(),n&&n.log({logLevel:2,message:"Rendered to "+n.id}),B.groupEnd(2,">>> DRAWING MODEL "+this.id)()}}const Or="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}";function Ir(e,t){t=Array.isArray(t)?t:[t];const r=e.replace(/^\s+/,"").split(/\s+/),[n,i,s]=r;if(!t.includes(n)||!i||!s)return null;return{qualifier:n,type:i,name:s.split(";")[0]}}function Fr(e={}){const{version:t=100,input:r,inputType:n,output:i}=e;if(!r)return 300===t?"#version 300 es\nout vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}":t>300?`#version ${t}\n${Or}`:"void main() {gl_FragColor = vec4(0);}";const s=function(e,t){switch(t){case"float":return`vec4(${e}, 0.0, 0.0, 1.0)`;case"vec2":return`vec4(${e}, 0.0, 1.0)`;case"vec3":return`vec4(${e}, 1.0)`;case"vec4":return e;default:return Ye(!1),null}}(r,n);return t>=300?`#version ${t} ${300===t?"es":""}\nin ${n} ${r};\nout vec4 ${i};\nvoid main() {\n  ${i} = ${s};\n}`:`varying ${n} ${r};\nvoid main() {\n  gl_FragColor = ${s};\n}`}class yr{constructor(e,t={}){this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(e={}){const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(e={}){const t=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:n}=t;return{attributes:Object.assign({},r,e.attributes),transformFeedback:n}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],r=e?t[e]:null;return r?r instanceof Ae?r:r.buffer:null}getData(e={}){const{varyingName:t}=e,r=this.getBuffer(t);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(e={}){this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Z(Object(P.e)(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const e in this.feedbackMap){const n=this.feedbackMap[e];e in t&&(r[n]=e)}Object.assign(r,e.feedbackBuffers);for(const e in r){const n=r[e];if("string"==typeof n){const i=t[n],{byteLength:s,usage:a,accessor:o}=i;r[e]=this._createNewBuffer(e,{byteLength:s,usage:a,accessor:o})}}return r}_setupBuffers(e={}){const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:r})}_setupTransformFeedback(e,{model:t}){const{program:r}=t;e.transformFeedback=new fr(this.gl,{program:r,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:t}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:e,feedbackBuffers:t})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const n in this.feedbackMap){const i=this.feedbackMap[n];t[n]=e.feedbackBuffers[i],r[i]=e.sourceBuffers[n],Z(r[i]instanceof Ae)}return{sourceBuffers:t,feedbackBuffers:r}}_createNewBuffer(e,t){const r=new Ae(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}function Lr(e){let t=100;const r=e.match(/[^\s]+/g);if(r.length>=2&&"#version"===r[0]){const e=parseInt(r[1],10);Number.isFinite(e)&&(t=e)}return t}const Cr={name:"transform",vs:"attribute float transform_elementID;\n\n// returns half of pixel size, used to move the pixel position to center of the pixel.\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\n// returns current elements pixel indeces [x, y],\n// where x ranges in [0 to texSize-1] and y ranges in [0 to texSize-1]\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  // Add safe offset (half of pixel height) before doing floor\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\n\n// returns current elementID's texture co-ordianate\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\n\n// returns current elementID's position\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  // Change from [0 1] range to [-1 1]\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\n\n// returns current elementID's pixel value\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null};function Mr({vs:e,sourceTextureMap:t,targetTextureVarying:r,targetTexture:n}){let i=Object.keys(t).length,s=null;const a={};let o=e,u={};if(i>0||r){const e=o.split("\n"),c=e.slice();if(e.forEach((e,n,o)=>{if(i>0){const r=function(e,t){const r={},n=function(e){return Ir(e,["attribute","in"])}(e);if(!n)return null;const{type:i,name:s}=n;if(s&&t[s]){const t=`// ${e} => Replaced by Transform with a sampler`,{samplerName:n,sizeName:a,uniformDeclerations:o}=function(e){const t="transform_uSampler_"+e,r="transform_uSize_"+e;return{samplerName:t,sizeName:r,uniformDeclerations:`  uniform sampler2D ${t};\n  uniform vec2 ${r};`}}(s),u=function(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Ye(!1),null}}(i),c=`  ${i} ${s} = transform_getInput(${n}, ${a}).${u};\n`;r[n]=s;return{updatedLine:t,inject:{"vs:#decl":o,"vs:#main-start":c},samplerTextureMap:r}}return null}(e,t);if(r){const{updatedLine:e,inject:t}=r;c[n]=e,u=_t([u,t]),Object.assign(a,r.samplerTextureMap),i--}}r&&!s&&(s=function(e,t){const r=Ir(e,["varying","out"]);if(!r)return null;return r.name===t?r.type:null}(e,r))}),r){Z(n);const e="transform_uSize_"+r;u=_t([u,{"vs:#decl":`uniform vec2 ${e};\n`,"vs:#main-start":`     vec2 transform_position = transform_getPos(${e});\n     gl_Position = vec4(transform_position, 0, 1.);\n`}])}o=c.join("\n")}return{vs:o,targetTextureType:s,inject:u,samplerTextureMap:a}}const vr={[x.a.TEXTURE_MIN_FILTER]:x.a.NEAREST,[x.a.TEXTURE_MAG_FILTER]:x.a.NEAREST,[x.a.TEXTURE_WRAP_S]:x.a.CLAMP_TO_EDGE,[x.a.TEXTURE_WRAP_T]:x.a.CLAMP_TO_EDGE};class Br{constructor(e,t={}){this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(e={}){const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(e={}){const{sourceBuffers:t,sourceTextures:r,framebuffer:n,targetTexture:i}=this.bindings[this.currentIndex],s=Object.assign({},t,e.attributes),a=Object.assign({},e.uniforms),o=Object.assign({},e.parameters);let u=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){s.transform_elementID=this.elementIDBuffer;for(const e in this.samplerTextureMap){const t=this.samplerTextureMap[e];a[e]=r[t]}this._setSourceTextureParameters();const e=function({sourceTextureMap:e,targetTextureVarying:t,targetTexture:r}){const n={};let i,s;t&&(({width:i,height:s}=r),n["transform_uSize_"+t]=[i,s]);for(const t in e)({width:i,height:s}=e[t]),n["transform_uSize_"+t]=[i,s];return n}({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:i});Object.assign(a,e)}return this.hasTargetTexture&&(u=!1,o.viewport=[0,0,n.width,n.height]),{attributes:s,framebuffer:n,uniforms:a,discard:u,parameters:o}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData({packed:e=!1}={}){const{framebuffer:t}=this.bindings[this.currentIndex],r=Pe(t);if(!e)return r;const n=r.constructor,i=function(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Ye(!1),null}}(this.targetTextureType),s=new n(r.length*i/4);let a=0;for(let e=0;e<r.length;e+=4)for(let t=0;t<i;t++)s[a++]=r[e+t];return s}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(e={}){const{_targetTextureVarying:t,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:r}=e;if(r instanceof Se)return r;const n=t[r];return n?(this._targetRefTexName=r,this._createNewTexture(n)):null}_setupTextures(e={}){const{sourceBuffers:t,_sourceTextures:r={},_targetTexture:n}=e,i=this._createTargetTexture({sourceTextures:r,textureOrReference:n});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:r,targetTexture:i}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if("number"!=typeof e||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((e,t,r)=>{r[t]=t}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new Ae(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:e,targetTexture:t}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:e,targetTexture:t})}}_updateBinding(e,t){const{sourceBuffers:r,sourceTextures:n,targetTexture:i}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,r),i){e.targetTexture=i;const{width:t,height:r}=i,{framebuffer:n}=e;n?(n.update({attachments:{[x.a.COLOR_ATTACHMENT0]:i},resizeAttachments:!1}),n.resize({width:t,height:r})):e.framebuffer=new xe(this.gl,{id:"transform-framebuffer",width:t,height:r,attachments:{[x.a.COLOR_ATTACHMENT0]:i}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const e in t)t[e].setParameters(vr)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;return{sourceTextures:t,targetTexture:e.sourceTextures[this._swapTexture]}}_createNewTexture(e){const t=function(e,t){Z(e instanceof Se||e instanceof Me||e instanceof ve);const r=e.constructor,{gl:n,width:i,height:s,format:a,type:o,dataFormat:u,border:c,mipmaps:l}=e;return new r(n,Object.assign({width:i,height:s,format:a,type:o,dataFormat:u,border:c,mipmaps:l},t))}(e,{parameters:{[x.a.TEXTURE_MIN_FILTER]:x.a.NEAREST,[x.a.TEXTURE_MAG_FILTER]:x.a.NEAREST,[x.a.TEXTURE_WRAP_S]:x.a.CLAMP_TO_EDGE,[x.a.TEXTURE_WRAP_T]:x.a.CLAMP_TO_EDGE},pixelStore:{[x.a.UNPACK_FLIP_Y_WEBGL]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(e={}){const{sourceTextures:t,targetTexture:r}=this.bindings[this.currentIndex],{vs:n,uniforms:i,targetTextureType:s,inject:a,samplerTextureMap:o}=Mr({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),u=_t([e.inject||{},a]);this.targetTextureType=s,this.samplerTextureMap=o;return{vs:n,fs:e._fs||Fr({version:Lr(n),input:this.targetTextureVarying,inputType:s,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[Cr].concat(e.modules||[]):e.modules,uniforms:i,inject:u}}}class Pr{static isSupported(e){return Object(P.e)(e)}constructor(e,t={}){this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:r}=this;e&&e.delete(),t&&t.delete(),r&&r.delete()}run(e={}){const{clearRenderTarget:t=!0}=e,r=this._updateDrawOptions(e);t&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)e=e||r.swap();Z(e,"Nothing to swap")}getBuffer(e=null){return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(e={}){const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t){const t=r.getData(e);if(t)return t}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(e={}){"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)r.update(e)}_initialize(e={}){const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new Sr(t,Object.assign({},e,{fs:e.fs||Fr({version:Lr(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||x.a.POINTS,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const e of r)t=e.updateModelProps(t);return t}_buildResourceTransforms(e,t){(function(e){if(!re(e.feedbackBuffers)||!re(e.feedbackMap)||e.varyings&&e.varyings.length>0)return!0;return!1})(t)&&(this.bufferTransform=new yr(e,t)),function(e){if(!re(e._sourceTextures)||e._targetTexture||e._targetTextureVarying)return!0;return!1}(t)&&(this.textureTransform=new Br(e,t)),Z(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const e of r)t=Object.assign(t,e.getDrawOptions(t));return t}}const Dr={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Ur{static get DRAW_MODE(){return Dr}constructor(e={}){const{id:t=ee("geometry"),drawMode:r=Dr.TRIANGLES,attributes:n={},indices:i=null,vertexCount:s=null}=e;this.id=t,this.drawMode=0|r,this.attributes={},this.userData={},this._setAttributes(n,i),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const t in e){let r=e[t];r=ArrayBuffer.isView(r)?{value:r}:r,Z(ArrayBuffer.isView(r.value),this._print(t)+": must be typed array or object with value as typed array"),"POSITION"!==t&&"positions"!==t||r.size||(r.size=3),"indices"===t?(Z(!this.indices),this.indices=r):this.attributes[t]=r}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const t in e){const n=e[t],{value:i,size:s,constant:a}=n;!a&&i&&s>=1&&(r=Math.min(r,i.length/s))}return Z(Number.isFinite(r)),r}}const xr={x:[2,0,1],y:[0,1,2],z:[1,2,0]};class wr extends Ur{constructor(e={}){const{id:t=ee("truncated-code-geometry")}=e,{indices:r,attributes:n}=function(e){const{bottomRadius:t=0,topRadius:r=0,height:n=1,nradial:i=10,nvertical:s=10,verticalAxis:a="y",topCap:o=!1,bottomCap:u=!1}=e,c=(o?2:0)+(u?2:0),l=(i+1)*(s+1+c),h=Math.atan2(t-r,n),f=Math.sin,_=Math.cos,E=Math.PI,d=_(h),A=f(h),T=o?-2:0,g=s+(u?2:0),m=i+1,R=new Uint16Array(i*(s+c)*6),b=xr[a],p=new Float32Array(3*l),N=new Float32Array(3*l),S=new Float32Array(2*l);let O=0,I=0;for(let e=T;e<=g;e++){let a,o=e/s,u=n*o;e<0?(u=0,o=1,a=t):e>s?(u=n,o=1,a=r):a=t+e/s*(r-t),-2!==e&&e!==s+2||(a=0,o=0),u-=n/2;for(let t=0;t<m;t++){const r=f(t*E*2/i),n=_(t*E*2/i);p[O+b[0]]=r*a,p[O+b[1]]=u,p[O+b[2]]=n*a,N[O+b[0]]=e<0||e>s?0:r*d,N[O+b[1]]=e<0?-1:e>s?1:A,N[O+b[2]]=e<0||e>s?0:n*d,S[I+0]=t/i,S[I+1]=o,I+=2,O+=3}}for(let e=0;e<s+c;e++)for(let t=0;t<i;t++){const r=6*(e*i+t);R[r+0]=m*(e+0)+0+t,R[r+1]=m*(e+0)+1+t,R[r+2]=m*(e+1)+1+t,R[r+3]=m*(e+0)+0+t,R[r+4]=m*(e+1)+1+t,R[r+5]=m*(e+1)+0+t}return{indices:R,attributes:{POSITION:{size:3,value:p},NORMAL:{size:3,value:N},TEXCOORD_0:{size:2,value:S}}}}(e);super({...e,id:t,indices:r,attributes:{...n,...e.attributes}})}}class Gr extends wr{constructor(e={}){const{id:t=ee("cone-geometry"),radius:r=1,cap:n=!0}=e;super({...e,id:t,topRadius:0,topCap:Boolean(n),bottomCap:Boolean(n),bottomRadius:r})}}const Hr=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Vr=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),kr=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),jr=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),Xr={POSITION:{size:3,value:new Float32Array(Vr)},NORMAL:{size:3,value:new Float32Array(kr)},TEXCOORD_0:{size:2,value:new Float32Array(jr)}};class Wr extends Ur{constructor(e={}){const{id:t=ee("cube-geometry")}=e;super({...e,id:t,indices:{size:1,value:new Uint16Array(Hr)},attributes:{...Xr,...e.attributes}})}}class zr extends wr{constructor(e={}){const{id:t=ee("cylinder-geometry"),radius:r=1}=e;super({...e,id:t,bottomRadius:r,topRadius:r})}}function Kr(e,t){return(Kr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Yr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kr(e,t)}function $r(e,t){return!t||"object"!==Object(n.a)(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Zr(e){return(Zr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qr(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Qr(e,t,r){return(Qr=qr()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&Kr(i,r.prototype),i}).apply(null,arguments)}function Jr(e){var t="function"==typeof Map?new Map:void 0;return(Jr=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Qr(e,arguments,Zr(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Kr(n,e)})(e)}function en(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}Math.PI,Math.PI;var tn={};function rn(e){return Math.round(e/tn.EPSILON)*tn.EPSILON}function nn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.precision,n=void 0===r?tn.precision||4:r;return e=rn(e),"".concat(parseFloat(e.toPrecision(n)))}function sn(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function an(e,t,r){var n=tn.EPSILON;r&&(tn.EPSILON=r);try{if(e===t)return!0;if(sn(e)&&sn(t)){if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(!an(e[i],t[i]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):!(!Number.isFinite(e)||!Number.isFinite(t))&&Math.abs(e-t)<=tn.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{tn.EPSILON=n}}function on(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Zr(e);if(t){var i=Zr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return $r(this,r)}}tn.EPSILON=1e-12,tn.debug=!1,tn.precision=4,tn.printTypes=!1,tn.printDegrees=!1,tn.printRowMajor=!0;var un=function(e){Yr(r,e);var t=on(r);function r(){return o(this,r),t.apply(this,arguments)}return c(r,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}},{key:"to",value:function(e){return e===this?this:sn(e)?this.toArray(e):this.toObject(e)}},{key:"toTarget",value:function(e){return e?this.to(e):this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(tn)}},{key:"formatString",value:function(e){for(var t="",r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+nn(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}},{key:"equals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(!an(this[t],e[t]))return!1;return!0}},{key:"exactEquals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}},{key:"negate",value:function(){for(var e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}},{key:"lerp",value:function(e,t,r){void 0===r&&(r=t,t=e,e=this);for(var n=0;n<this.ELEMENTS;++n){var i=e[n];this[n]=i+r*(t[n]-i)}return this.check()}},{key:"min",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}},{key:"max",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}},{key:"clamp",value:function(e,t){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var s=i[n],a=0;a<this.ELEMENTS;++a)this[a]+=s[a];return this.check()}},{key:"subtract",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var s=i[n],a=0;a<this.ELEMENTS;++a)this[a]-=s[a];return this.check()}},{key:"scale",value:function(e){if(Array.isArray(e))return this.multiply(e);for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}},{key:"sub",value:function(e){return this.subtract(e)}},{key:"setScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}},{key:"addScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}},{key:"subScalar",value:function(e){return this.addScalar(-e)}},{key:"multiplyScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}},{key:"divideScalar",value:function(e){return this.scale(1/e)}},{key:"clampScalar",value:function(e,t){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}},{key:"multiplyByScalar",value:function(e){return this.scale(e)}},{key:"check",value:function(){if(tn.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var e=this.length===this.ELEMENTS,t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}},{key:"ELEMENTS",get:function(){return en(!1),0}},{key:"RANK",get:function(){return en(!1),0}},{key:"elements",get:function(){return this}}]),r}(Jr(Array));function cn(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(e));return e}function ln(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Zr(e);if(t){var i=Zr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return $r(this,r)}}var hn=function(e){Yr(r,e);var t=ln(r);function r(){return o(this,r),t.apply(this,arguments)}return c(r,[{key:"copy",value:function(e){return en(!1),this}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var e=0,t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(e){return Math.sqrt(this.distanceSquared(e))}},{key:"distanceSquared",value:function(e){for(var t=0,r=0;r<this.ELEMENTS;++r){var n=this[r]-e[r];t+=n*n}return cn(t)}},{key:"dot",value:function(e){for(var t=0,r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return cn(t)}},{key:"normalize",value:function(){var e=this.magnitude();if(0!==e)for(var t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}},{key:"multiply",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var s=i[n],a=0;a<this.ELEMENTS;++a)this[a]*=s[a];return this.check()}},{key:"divide",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++)for(var s=i[n],a=0;a<this.ELEMENTS;++a)this[a]/=s[a];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(e){return this.distance(e)}},{key:"distanceToSquared",value:function(e){return this.distanceSquared(e)}},{key:"getComponent",value:function(e){return en(e>=0&&e<this.ELEMENTS,"index is out of range"),cn(this[e])}},{key:"setComponent",value:function(e,t){return en(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}},{key:"addVectors",value:function(e,t){return this.copy(e).add(t)}},{key:"subVectors",value:function(e,t){return this.copy(e).subtract(t)}},{key:"multiplyVectors",value:function(e,t){return this.copy(e).multiply(t)}},{key:"addScaledVector",value:function(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}},{key:"x",get:function(){return this[0]},set:function(e){this[0]=cn(e)}},{key:"y",get:function(){return this[1]},set:function(e){this[1]=cn(e)}}]),r}(un),fn="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var _n,En;_n=new fn(3),fn!=Float32Array&&(_n[0]=0,_n[1]=0,_n[2]=0),En=_n;function dn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Zr(e);if(t){var i=Zr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return $r(this,r)}}var An=[0,0,0],Tn={},gn=function(e){Yr(r,e);var t=dn(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return o(this,r),e=t.call(this,-0,-0,-0),1===arguments.length&&sn(n)?e.copy(n):(tn.debug&&(cn(n),cn(i),cn(s)),e[0]=n,e[1]=i,e[2]=s),e}return c(r,null,[{key:"ZERO",get:function(){return Tn.ZERO=Tn.ZERO||Object.freeze(new r(0,0,0,0))}}]),c(r,[{key:"set",value:function(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}},{key:"fromObject",value:function(e){return tn.debug&&(cn(e.x),cn(e.y),cn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}},{key:"toObject",value:function(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}},{key:"angle",value:function(e){return r=e,n=(t=this)[0],i=t[1],s=t[2],a=r[0],o=r[1],u=r[2],c=Math.sqrt(n*n+i*i+s*s)*Math.sqrt(a*a+o*o+u*u),l=c&&function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(t,r)/c,Math.acos(Math.min(Math.max(l,-1),1));var t,r,n,i,s,a,o,u,c,l}},{key:"cross",value:function(e){return function(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[0],o=r[1],u=r[2];e[0]=i*u-s*o,e[1]=s*a-n*u,e[2]=n*o-i*a}(this,this,e),this.check()}},{key:"rotateX",value:function(e){var t=e.radians,r=e.origin;return function(e,t,r,n){var i=[],s=[];i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2]}(this,this,void 0===r?An:r,t),this.check()}},{key:"rotateY",value:function(e){var t=e.radians,r=e.origin;return function(e,t,r,n){var i=[],s=[];i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2]}(this,this,void 0===r?An:r,t),this.check()}},{key:"rotateZ",value:function(e){var t=e.radians,r=e.origin;return function(e,t,r,n){var i=[],s=[];i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2]}(this,this,void 0===r?An:r,t),this.check()}},{key:"transform",value:function(e){return this.transformAsPoint(e)}},{key:"transformAsPoint",value:function(e){return function(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[3]*n+r[7]*i+r[11]*s+r[15];a=a||1,e[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/a,e[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/a,e[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/a}(this,this,e),this.check()}},{key:"transformAsVector",value:function(e){return function(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[3]*n+r[7]*i+r[11]*s||1;e[0]=(r[0]*n+r[4]*i+r[8]*s)/a,e[1]=(r[1]*n+r[5]*i+r[9]*s)/a,e[2]=(r[2]*n+r[6]*i+r[10]*s)/a}(this,this,e),this.check()}},{key:"transformByMatrix3",value:function(e){return function(e,t,r){var n=t[0],i=t[1],s=t[2];e[0]=n*r[0]+i*r[3]+s*r[6],e[1]=n*r[1]+i*r[4]+s*r[7],e[2]=n*r[2]+i*r[5]+s*r[8]}(this,this,e),this.check()}},{key:"transformByMatrix2",value:function(e){return function(e,t,r){var n=t[0],i=t[1];e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e[2]=t[2]}(this,this,e),this.check()}},{key:"transformByQuaternion",value:function(e){return function(e,t,r){var n=r[0],i=r[1],s=r[2],a=r[3],o=t[0],u=t[1],c=t[2],l=i*c-s*u,h=s*o-n*c,f=n*u-i*o,_=i*f-s*h,E=s*l-n*f,d=n*h-i*l,A=2*a;l*=A,h*=A,f*=A,_*=2,E*=2,d*=2,e[0]=o+l+_,e[1]=u+h+E,e[2]=c+f+d}(this,this,e),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(e){this[2]=cn(e)}}]),r}(hn);const mn=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],Rn=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1];class bn extends Ur{constructor(e={}){const{id:t=ee("ico-sphere-geometry")}=e,{indices:r,attributes:n}=function(e){const{iterations:t=0}=e,r=Math.PI,n=2*r,i=[...mn];let s=[...Rn];i.push(),s.push();const a=(()=>{const e={};return(t,r)=>{const n=`${(t*=3)<(r*=3)?t:r}|${t>r?t:r}`;if(n in e)return e[n];const s=i[t],a=i[t+1],o=i[t+2];let u=(s+i[r])/2,c=(a+i[r+1])/2,l=(o+i[r+2])/2;const h=Math.sqrt(u*u+c*c+l*l);return u/=h,c/=h,l/=h,i.push(u,c,l),e[n]=i.length/3-1}})();for(let e=0;e<t;e++){const e=[];for(let t=0;t<s.length;t+=3){const r=a(s[t+0],s[t+1]),n=a(s[t+1],s[t+2]),i=a(s[t+2],s[t+0]);e.push(i,s[t+0],r,r,s[t+1],n,n,s[t+2],i,r,n,i)}s=e}const o=new Array(i.length),u=new Array(i.length/3*2);for(let e=s.length-3;e>=0;e-=3){const t=s[e+0],a=s[e+1],c=s[e+2],l=3*t,h=3*a,f=3*c,_=2*t,E=2*a,d=2*c,A=i[l+0],T=i[l+1],g=i[l+2],m=Math.acos(g/Math.sqrt(A*A+T*T+g*g)),R=Math.atan2(T,A)+r,b=m/r,p=1-R/n,N=i[h+0],S=i[h+1],O=i[h+2],I=Math.acos(O/Math.sqrt(N*N+S*S+O*O)),F=Math.atan2(S,N)+r,y=I/r,L=1-F/n,C=i[f+0],M=i[f+1],v=i[f+2],B=Math.acos(v/Math.sqrt(C*C+M*M+v*v)),P=Math.atan2(M,C)+r,D=B/r,U=1-P/n,x=[A-N,T-S,g-O],w=new gn([C-N,M-S,v-O]).cross(x).normalize();let G;(0===p||0===L||0===U)&&(0===p||p>.5)&&(0===L||L>.5)&&(0===U||U>.5)&&(i.push(i[l+0],i[l+1],i[l+2]),G=i.length/3-1,s.push(G),u[2*G+0]=1,u[2*G+1]=b,o[3*G+0]=w.x,o[3*G+1]=w.y,o[3*G+2]=w.z,i.push(i[h+0],i[h+1],i[h+2]),G=i.length/3-1,s.push(G),u[2*G+0]=1,u[2*G+1]=y,o[3*G+0]=w.x,o[3*G+1]=w.y,o[3*G+2]=w.z,i.push(i[f+0],i[f+1],i[f+2]),G=i.length/3-1,s.push(G),u[2*G+0]=1,u[2*G+1]=D,o[3*G+0]=w.x,o[3*G+1]=w.y,o[3*G+2]=w.z),o[l+0]=o[h+0]=o[f+0]=w.x,o[l+1]=o[h+1]=o[f+1]=w.y,o[l+2]=o[h+2]=o[f+2]=w.z,u[_+0]=p,u[_+1]=b,u[E+0]=L,u[E+1]=y,u[d+0]=U,u[d+1]=D}return{indices:{size:1,value:new Uint16Array(s)},attributes:{POSITION:{size:3,value:new Float32Array(i)},NORMAL:{size:3,value:new Float32Array(o)},TEXCOORD_0:{size:2,value:new Float32Array(u)}}}}(e);super({...e,id:t,indices:r,attributes:{...n,...e.attributes}})}}class pn extends Ur{constructor(e={}){const{id:t=ee("plane-geometry")}=e,{indices:r,attributes:n}=function(e){const{type:t="x,y",offset:r=0,flipCull:n=!1,unpack:i=!1}=e,s=t.split(",");let a=e[s[0]+"len"]||1;const o=e[s[1]+"len"]||1,u=e["n"+s[0]]||1,c=e["n"+s[1]]||1,l=(u+1)*(c+1),h=new Float32Array(3*l),f=new Float32Array(3*l),_=new Float32Array(2*l);n&&(a=-a);let E=0,d=0;for(let e=0;e<=c;e++)for(let i=0;i<=u;i++){const s=i/u,l=e/c;switch(_[E+0]=n?1-s:s,_[E+1]=l,t){case"x,y":h[d+0]=a*s-.5*a,h[d+1]=o*l-.5*o,h[d+2]=r,f[d+0]=0,f[d+1]=0,f[d+2]=n?1:-1;break;case"x,z":h[d+0]=a*s-.5*a,h[d+1]=r,h[d+2]=o*l-.5*o,f[d+0]=0,f[d+1]=n?1:-1,f[d+2]=0;break;case"y,z":h[d+0]=r,h[d+1]=a*s-.5*a,h[d+2]=o*l-.5*o,f[d+0]=n?1:-1,f[d+1]=0,f[d+2]=0;break;default:throw new Error("PlaneGeometry: unknown type")}E+=2,d+=3}const A=u+1,T=new Uint16Array(u*c*6);for(let e=0;e<c;e++)for(let t=0;t<u;t++){const r=6*(e*u+t);T[r+0]=(e+0)*A+t,T[r+1]=(e+1)*A+t,T[r+2]=(e+0)*A+t+1,T[r+3]=(e+1)*A+t,T[r+4]=(e+1)*A+t+1,T[r+5]=(e+0)*A+t+1}const g={indices:{size:1,value:T},attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:f},TEXCOORD_0:{size:2,value:_}}};return i?function(e){const{indices:t,attributes:r}=e;if(!t)return e;const n=t.value.length,i={};for(const e in r){const s=r[e],{constant:a,value:o,size:u}=s;if(a||!u)continue;const c=new o.constructor(n*u);for(let e=0;e<n;++e){const r=t.value[e];for(let t=0;t<u;t++)c[e*u+t]=o[r*u+t]}i[e]={size:u,value:c}}return{attributes:Object.assign({},r,i)}}(g):g}(e);super({...e,id:t,indices:r,attributes:{...n,...e.attributes}})}}class Nn extends Ur{constructor(e={}){const{id:t=ee("sphere-geometry")}=e,{indices:r,attributes:n}=function(e){const{nlat:t=10,nlong:r=10}=e;let{radius:n=1}=e;const i=Math.PI-0,s=2*Math.PI-0,a=(t+1)*(r+1);if("number"==typeof n){const e=n;n=(t,r,n,i,s)=>e}const o=new Float32Array(3*a),u=new Float32Array(3*a),c=new Float32Array(2*a),l=new(a>65535?Uint32Array:Uint16Array)(t*r*6);for(let e=0;e<=t;e++)for(let a=0;a<=r;a++){const l=a/r,h=e/t,f=a+e*(r+1),_=2*f,E=3*f,d=s*l,A=i*h,T=Math.sin(d),g=Math.cos(d),m=Math.sin(A),R=Math.cos(A),b=g*m,p=R,N=T*m,S=n(b,p,N,l,h);o[E+0]=S*b,o[E+1]=S*p,o[E+2]=S*N,u[E+0]=b,u[E+1]=p,u[E+2]=N,c[_+0]=l,c[_+1]=1-h}const h=r+1;for(let e=0;e<r;e++)for(let r=0;r<t;r++){const n=6*(e*t+r);l[n+0]=r*h+e,l[n+1]=r*h+e+1,l[n+2]=(r+1)*h+e,l[n+3]=(r+1)*h+e,l[n+4]=r*h+e+1,l[n+5]=(r+1)*h+e+1}return{indices:{size:1,value:l},attributes:{POSITION:{size:3,value:o},NORMAL:{size:3,value:u},TEXCOORD_0:{size:2,value:c}}}}(e);super({...e,id:t,indices:r,attributes:{...n,...e.attributes}})}}let Sn=1,On=1;class In{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:n=1,repeat:i=1}=e,s=Sn++,a={time:0,delay:t,duration:r,rate:n,repeat:i};return this._setChannelTime(a,this.time),this.channels.set(s,a),s}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const e of t)this._setChannelTime(e,this.time);const r=this.animations.values();for(const e of r){const{animation:t,channel:r}=e;t.setTime(this.getTime(r))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=On++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay;r>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}class Fn{constructor(e){this._lastTime=-1,this.startIndex=-1,this.endIndex=-1,this.factor=0,this.times=[],this.values=[],this.setKeyFrames(e),this.setTime(0)}setKeyFrames(e){const t=e.length;this.times.length=t,this.values.length=t;for(let r=0;r<t;++r)this.times[r]=e[r][0],this.values[r]=e[r][1];this._calculateKeys(this._lastTime)}setTime(e){(e=Math.max(0,e))!==this._lastTime&&(this._calculateKeys(e),this._lastTime=e)}getStartTime(){return this.times[this.startIndex]}getEndTime(){return this.times[this.endIndex]}getStartData(){return this.values[this.startIndex]}getEndData(){return this.values[this.endIndex]}_calculateKeys(e){let t=0;const r=this.times.length;for(t=0;t<r-2&&!(this.times[t+1]>e);++t);this.startIndex=t,this.endIndex=t+1;const n=this.times[this.startIndex],i=this.times[this.endIndex];this.factor=Math.min(Math.max(0,(e-n)/(i-n)),1)}}const yn=[-1,-1,1,-1,-1,1,1,1];class Ln extends Sr{constructor(e,t){const r=yn.map(e=>-1===e?0:e);super(e,Object.assign({},t,{vs:"attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n",geometry:new Ur({drawMode:x.a.TRIANGLE_STRIP,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(yn)},aTexCoord:{size:2,value:new Float32Array(r)},aCoordinate:{size:2,value:new Float32Array(r)}}})})),this.setVertexCount(4)}}}])}));