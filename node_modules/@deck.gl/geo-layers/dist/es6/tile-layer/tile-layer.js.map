{"version":3,"sources":["../../../src/tile-layer/tile-layer.js"],"names":["CompositeLayer","_flatten","flatten","GeoJsonLayer","load","Tileset2D","STRATEGY_DEFAULT","urlType","getURLFromTemplate","defaultProps","data","dataComparator","equals","renderSubLayers","type","value","props","compare","getTileData","optional","onViewportLoad","onTileLoad","tile","onTileUnload","onTileError","err","console","error","extent","tileSize","maxZoom","minZoom","maxCacheSize","maxCacheByteSize","refinementStrategy","zRange","fetch","url","layer","signal","loadOptions","getLoadOptions","maxRequests","TileLayer","initializeState","state","tileset","isLoaded","finalizeState","finalize","selectedTiles","every","layers","shouldUpdateState","changeFlags","somethingChanged","updateState","oldProps","context","createTileCache","dataChanged","updateTriggersChanged","all","Number","isFinite","bind","_onTileLoad","_onTileError","_onTileUnload","setState","propsChanged","setOptions","tiles","forEach","_updateTileset","modelMatrix","frameNumber","update","viewport","loadingStateChanged","tilesetChanged","_onViewportLoad","getCurrentLayer","isVisible","setNeedsUpdate","getHighlightedObjectIndex","getPickingInfo","info","sourceLayer","renderLayers","visible","map","highlightedObjectIndex","Object","assign","id","x","y","z","_offset","Boolean","clone","layerName"],"mappings":"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","sourcesContent":["import {CompositeLayer, _flatten as flatten} from '@deck.gl/core';\nimport {GeoJsonLayer} from '@deck.gl/layers';\nimport {load} from '@loaders.gl/core';\n\nimport Tileset2D, {STRATEGY_DEFAULT} from './tileset-2d';\nimport {urlType, getURLFromTemplate} from './utils';\n\nconst defaultProps = {\n  data: [],\n  dataComparator: urlType.equals,\n  renderSubLayers: {type: 'function', value: props => new GeoJsonLayer(props), compare: false},\n  getTileData: {type: 'function', optional: true, value: null, compare: false},\n  // TODO - change to onViewportLoad to align with Tile3DLayer\n  onViewportLoad: {type: 'function', optional: true, value: null, compare: false},\n  onTileLoad: {type: 'function', value: tile => {}, compare: false},\n  onTileUnload: {type: 'function', value: tile => {}, compare: false},\n  // eslint-disable-next-line\n  onTileError: {type: 'function', value: err => console.error(err), compare: false},\n  extent: {type: 'array', optional: true, value: null, compare: true},\n  tileSize: 512,\n  maxZoom: null,\n  minZoom: 0,\n  maxCacheSize: null,\n  maxCacheByteSize: null,\n  refinementStrategy: STRATEGY_DEFAULT,\n  zRange: null,\n  // Use load directly so we don't use ResourceManager\n  fetch: {\n    type: 'function',\n    value: (url, {layer, signal}) => {\n      const loadOptions = {...layer.getLoadOptions()};\n      loadOptions.fetch = {\n        ...loadOptions.fetch,\n        signal\n      };\n\n      return load(url, loadOptions);\n    },\n    compare: false\n  },\n  maxRequests: 6\n};\n\nexport default class TileLayer extends CompositeLayer {\n  initializeState() {\n    this.state = {\n      tileset: null,\n      isLoaded: false\n    };\n  }\n\n  finalizeState() {\n    const {tileset} = this.state;\n    if (tileset) {\n      tileset.finalize();\n    }\n  }\n\n  get isLoaded() {\n    const {tileset} = this.state;\n    return tileset.selectedTiles.every(\n      tile => tile.layers && tile.layers.every(layer => layer.isLoaded)\n    );\n  }\n\n  shouldUpdateState({changeFlags}) {\n    return changeFlags.somethingChanged;\n  }\n\n  updateState({props, oldProps, context, changeFlags}) {\n    let {tileset} = this.state;\n    const createTileCache =\n      !tileset ||\n      changeFlags.dataChanged ||\n      (changeFlags.updateTriggersChanged &&\n        (changeFlags.updateTriggersChanged.all || changeFlags.updateTriggersChanged.getTileData));\n\n    if (createTileCache) {\n      if (tileset) {\n        tileset.finalize();\n      }\n      const maxZoom = Number.isFinite(this.state.maxZoom) ? this.state.maxZoom : props.maxZoom;\n      const minZoom = Number.isFinite(this.state.minZoom) ? this.state.minZoom : props.minZoom;\n      const {\n        tileSize,\n        maxCacheSize,\n        maxCacheByteSize,\n        refinementStrategy,\n        extent,\n        maxRequests\n      } = props;\n      tileset = new Tileset2D({\n        getTileData: this.getTileData.bind(this),\n        maxCacheSize,\n        maxCacheByteSize,\n        maxZoom,\n        minZoom,\n        tileSize,\n        refinementStrategy,\n        extent,\n        onTileLoad: this._onTileLoad.bind(this),\n        onTileError: this._onTileError.bind(this),\n        onTileUnload: this._onTileUnload.bind(this),\n        maxRequests\n      });\n      this.setState({tileset});\n    } else if (changeFlags.propsChanged || changeFlags.updateTriggersChanged) {\n      tileset.setOptions(props);\n      // if any props changed, delete the cached layers\n      this.state.tileset.tiles.forEach(tile => {\n        tile.layers = null;\n      });\n    }\n\n    this._updateTileset();\n  }\n\n  _updateTileset() {\n    const {tileset} = this.state;\n    const {zRange, modelMatrix} = this.props;\n    const frameNumber = tileset.update(this.context.viewport, {zRange, modelMatrix});\n    const {isLoaded} = tileset;\n\n    const loadingStateChanged = this.state.isLoaded !== isLoaded;\n    const tilesetChanged = this.state.frameNumber !== frameNumber;\n\n    if (isLoaded && (loadingStateChanged || tilesetChanged)) {\n      this._onViewportLoad();\n    }\n\n    if (tilesetChanged) {\n      // Save the tileset frame number - trigger a rerender\n      this.setState({frameNumber});\n    }\n    // Save the loaded state - should not trigger a rerender\n    this.state.isLoaded = isLoaded;\n  }\n\n  _onViewportLoad() {\n    const {tileset} = this.state;\n    const {onViewportLoad} = this.props;\n\n    if (onViewportLoad) {\n      onViewportLoad(tileset.selectedTiles);\n    }\n  }\n\n  _onTileLoad(tile) {\n    const layer = this.getCurrentLayer();\n    layer.props.onTileLoad(tile);\n\n    if (tile.isVisible) {\n      this.setNeedsUpdate();\n    }\n  }\n\n  _onTileError(error, tile) {\n    const layer = this.getCurrentLayer();\n    layer.props.onTileError(error);\n    // errorred tiles should not block rendering, are considered \"loaded\" with empty data\n    layer._updateTileset();\n\n    if (tile.isVisible) {\n      this.setNeedsUpdate();\n    }\n  }\n\n  _onTileUnload(tile) {\n    const layer = this.getCurrentLayer();\n    layer.props.onTileUnload(tile);\n  }\n\n  // Methods for subclass to override\n\n  getTileData(tile) {\n    const {data} = this.props;\n    const {getTileData, fetch} = this.getCurrentLayer().props;\n    const {signal} = tile;\n\n    tile.url = getURLFromTemplate(data, tile);\n\n    if (getTileData) {\n      return getTileData(tile);\n    }\n    if (tile.url) {\n      return fetch(tile.url, {layer: this, signal});\n    }\n    return null;\n  }\n\n  renderSubLayers(props) {\n    return this.props.renderSubLayers(props);\n  }\n\n  getHighlightedObjectIndex() {\n    return -1;\n  }\n\n  getPickingInfo({info, sourceLayer}) {\n    info.sourceLayer = sourceLayer;\n    info.tile = sourceLayer.props.tile;\n    return info;\n  }\n\n  renderLayers() {\n    const {visible} = this.props;\n    return this.state.tileset.tiles.map(tile => {\n      // For a tile to be visible:\n      // - parent layer must be visible\n      // - tile must be visible in the current viewport\n      const isVisible = visible && tile.isVisible;\n      const highlightedObjectIndex = this.getHighlightedObjectIndex(tile);\n      // cache the rendered layer in the tile\n      if (!tile.isLoaded) {\n        // no op\n      } else if (!tile.layers) {\n        const layers = this.renderSubLayers(\n          Object.assign({}, this.props, {\n            id: `${this.id}-${tile.x}-${tile.y}-${tile.z}`,\n            data: tile.data,\n            visible: isVisible,\n            _offset: 0,\n            tile,\n            highlightedObjectIndex\n          })\n        );\n        tile.layers = flatten(layers, Boolean);\n      } else if (\n        tile.layers[0] &&\n        (tile.layers[0].props.visible !== isVisible ||\n          tile.layers[0].props.highlightedObjectIndex !== highlightedObjectIndex)\n      ) {\n        tile.layers = tile.layers.map(layer =>\n          layer.clone({visible: isVisible, highlightedObjectIndex})\n        );\n      }\n      return tile.layers;\n    });\n  }\n}\n\nTileLayer.layerName = 'TileLayer';\nTileLayer.defaultProps = defaultProps;\n"],"file":"tile-layer.js"}