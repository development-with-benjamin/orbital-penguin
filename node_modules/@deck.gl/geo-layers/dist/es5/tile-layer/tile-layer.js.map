{"version":3,"sources":["../../../src/tile-layer/tile-layer.js"],"names":["defaultProps","data","dataComparator","urlType","equals","renderSubLayers","type","value","props","GeoJsonLayer","compare","getTileData","optional","onViewportLoad","onTileLoad","tile","onTileUnload","onTileError","err","console","error","extent","tileSize","maxZoom","minZoom","maxCacheSize","maxCacheByteSize","refinementStrategy","STRATEGY_DEFAULT","zRange","fetch","url","layer","signal","loadOptions","getLoadOptions","maxRequests","TileLayer","state","tileset","isLoaded","finalize","changeFlags","somethingChanged","oldProps","context","createTileCache","dataChanged","updateTriggersChanged","all","Number","isFinite","Tileset2D","bind","_onTileLoad","_onTileError","_onTileUnload","setState","propsChanged","setOptions","tiles","forEach","layers","_updateTileset","modelMatrix","frameNumber","update","viewport","loadingStateChanged","tilesetChanged","_onViewportLoad","selectedTiles","getCurrentLayer","isVisible","setNeedsUpdate","info","sourceLayer","visible","map","highlightedObjectIndex","getHighlightedObjectIndex","Object","assign","id","x","y","z","_offset","Boolean","clone","every","CompositeLayer","layerName"],"mappings":"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","sourcesContent":["import {CompositeLayer, _flatten as flatten} from '@deck.gl/core';\nimport {GeoJsonLayer} from '@deck.gl/layers';\nimport {load} from '@loaders.gl/core';\n\nimport Tileset2D, {STRATEGY_DEFAULT} from './tileset-2d';\nimport {urlType, getURLFromTemplate} from './utils';\n\nconst defaultProps = {\n  data: [],\n  dataComparator: urlType.equals,\n  renderSubLayers: {type: 'function', value: props => new GeoJsonLayer(props), compare: false},\n  getTileData: {type: 'function', optional: true, value: null, compare: false},\n  // TODO - change to onViewportLoad to align with Tile3DLayer\n  onViewportLoad: {type: 'function', optional: true, value: null, compare: false},\n  onTileLoad: {type: 'function', value: tile => {}, compare: false},\n  onTileUnload: {type: 'function', value: tile => {}, compare: false},\n  // eslint-disable-next-line\n  onTileError: {type: 'function', value: err => console.error(err), compare: false},\n  extent: {type: 'array', optional: true, value: null, compare: true},\n  tileSize: 512,\n  maxZoom: null,\n  minZoom: 0,\n  maxCacheSize: null,\n  maxCacheByteSize: null,\n  refinementStrategy: STRATEGY_DEFAULT,\n  zRange: null,\n  // Use load directly so we don't use ResourceManager\n  fetch: {\n    type: 'function',\n    value: (url, {layer, signal}) => {\n      const loadOptions = {...layer.getLoadOptions()};\n      loadOptions.fetch = {\n        ...loadOptions.fetch,\n        signal\n      };\n\n      return load(url, loadOptions);\n    },\n    compare: false\n  },\n  maxRequests: 6\n};\n\nexport default class TileLayer extends CompositeLayer {\n  initializeState() {\n    this.state = {\n      tileset: null,\n      isLoaded: false\n    };\n  }\n\n  finalizeState() {\n    const {tileset} = this.state;\n    if (tileset) {\n      tileset.finalize();\n    }\n  }\n\n  get isLoaded() {\n    const {tileset} = this.state;\n    return tileset.selectedTiles.every(\n      tile => tile.layers && tile.layers.every(layer => layer.isLoaded)\n    );\n  }\n\n  shouldUpdateState({changeFlags}) {\n    return changeFlags.somethingChanged;\n  }\n\n  updateState({props, oldProps, context, changeFlags}) {\n    let {tileset} = this.state;\n    const createTileCache =\n      !tileset ||\n      changeFlags.dataChanged ||\n      (changeFlags.updateTriggersChanged &&\n        (changeFlags.updateTriggersChanged.all || changeFlags.updateTriggersChanged.getTileData));\n\n    if (createTileCache) {\n      if (tileset) {\n        tileset.finalize();\n      }\n      const maxZoom = Number.isFinite(this.state.maxZoom) ? this.state.maxZoom : props.maxZoom;\n      const minZoom = Number.isFinite(this.state.minZoom) ? this.state.minZoom : props.minZoom;\n      const {\n        tileSize,\n        maxCacheSize,\n        maxCacheByteSize,\n        refinementStrategy,\n        extent,\n        maxRequests\n      } = props;\n      tileset = new Tileset2D({\n        getTileData: this.getTileData.bind(this),\n        maxCacheSize,\n        maxCacheByteSize,\n        maxZoom,\n        minZoom,\n        tileSize,\n        refinementStrategy,\n        extent,\n        onTileLoad: this._onTileLoad.bind(this),\n        onTileError: this._onTileError.bind(this),\n        onTileUnload: this._onTileUnload.bind(this),\n        maxRequests\n      });\n      this.setState({tileset});\n    } else if (changeFlags.propsChanged || changeFlags.updateTriggersChanged) {\n      tileset.setOptions(props);\n      // if any props changed, delete the cached layers\n      this.state.tileset.tiles.forEach(tile => {\n        tile.layers = null;\n      });\n    }\n\n    this._updateTileset();\n  }\n\n  _updateTileset() {\n    const {tileset} = this.state;\n    const {zRange, modelMatrix} = this.props;\n    const frameNumber = tileset.update(this.context.viewport, {zRange, modelMatrix});\n    const {isLoaded} = tileset;\n\n    const loadingStateChanged = this.state.isLoaded !== isLoaded;\n    const tilesetChanged = this.state.frameNumber !== frameNumber;\n\n    if (isLoaded && (loadingStateChanged || tilesetChanged)) {\n      this._onViewportLoad();\n    }\n\n    if (tilesetChanged) {\n      // Save the tileset frame number - trigger a rerender\n      this.setState({frameNumber});\n    }\n    // Save the loaded state - should not trigger a rerender\n    this.state.isLoaded = isLoaded;\n  }\n\n  _onViewportLoad() {\n    const {tileset} = this.state;\n    const {onViewportLoad} = this.props;\n\n    if (onViewportLoad) {\n      onViewportLoad(tileset.selectedTiles);\n    }\n  }\n\n  _onTileLoad(tile) {\n    const layer = this.getCurrentLayer();\n    layer.props.onTileLoad(tile);\n\n    if (tile.isVisible) {\n      this.setNeedsUpdate();\n    }\n  }\n\n  _onTileError(error, tile) {\n    const layer = this.getCurrentLayer();\n    layer.props.onTileError(error);\n    // errorred tiles should not block rendering, are considered \"loaded\" with empty data\n    layer._updateTileset();\n\n    if (tile.isVisible) {\n      this.setNeedsUpdate();\n    }\n  }\n\n  _onTileUnload(tile) {\n    const layer = this.getCurrentLayer();\n    layer.props.onTileUnload(tile);\n  }\n\n  // Methods for subclass to override\n\n  getTileData(tile) {\n    const {data} = this.props;\n    const {getTileData, fetch} = this.getCurrentLayer().props;\n    const {signal} = tile;\n\n    tile.url = getURLFromTemplate(data, tile);\n\n    if (getTileData) {\n      return getTileData(tile);\n    }\n    if (tile.url) {\n      return fetch(tile.url, {layer: this, signal});\n    }\n    return null;\n  }\n\n  renderSubLayers(props) {\n    return this.props.renderSubLayers(props);\n  }\n\n  getHighlightedObjectIndex() {\n    return -1;\n  }\n\n  getPickingInfo({info, sourceLayer}) {\n    info.sourceLayer = sourceLayer;\n    info.tile = sourceLayer.props.tile;\n    return info;\n  }\n\n  renderLayers() {\n    const {visible} = this.props;\n    return this.state.tileset.tiles.map(tile => {\n      // For a tile to be visible:\n      // - parent layer must be visible\n      // - tile must be visible in the current viewport\n      const isVisible = visible && tile.isVisible;\n      const highlightedObjectIndex = this.getHighlightedObjectIndex(tile);\n      // cache the rendered layer in the tile\n      if (!tile.isLoaded) {\n        // no op\n      } else if (!tile.layers) {\n        const layers = this.renderSubLayers(\n          Object.assign({}, this.props, {\n            id: `${this.id}-${tile.x}-${tile.y}-${tile.z}`,\n            data: tile.data,\n            visible: isVisible,\n            _offset: 0,\n            tile,\n            highlightedObjectIndex\n          })\n        );\n        tile.layers = flatten(layers, Boolean);\n      } else if (\n        tile.layers[0] &&\n        (tile.layers[0].props.visible !== isVisible ||\n          tile.layers[0].props.highlightedObjectIndex !== highlightedObjectIndex)\n      ) {\n        tile.layers = tile.layers.map(layer =>\n          layer.clone({visible: isVisible, highlightedObjectIndex})\n        );\n      }\n      return tile.layers;\n    });\n  }\n}\n\nTileLayer.layerName = 'TileLayer';\nTileLayer.defaultProps = defaultProps;\n"],"file":"tile-layer.js"}